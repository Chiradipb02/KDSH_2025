Nonlocal Attention Operator: Materializing Hidden
Knowledge Towards Interpretable Physics Discovery
Yue Yu∗
Department of Mathematics,
Lehigh University,
Bethlehem, PA 18015, USA
yuy214@lehigh.eduNing Liu
Global Engineering and
Materials, Inc.,
Princeton, NJ 08540, USAFei Lu
Department of Mathematics,
Johns Hopkins University,
Baltimore, MD 21218, USA
Tian Gao
IBM Research,
Yorktown Heights,
NY 10598, USASiavash Jafarzadeh
Department of Mathematics,
Lehigh University,
Bethlehem, PA 18015, USAStewart Silling
Center for Computing Research,
Sandia National Laboratories,
Albuquerque, NM 87123, USA
Abstract
Despite the recent popularity of attention-based neural architectures in core AI
ﬁelds like natural language processing (NLP) and computer vision (CV), their po-
tential in modeling complex physical systems remains under-explored. Learning
problems in physical systems are often characterized as discovering operators that
map between function spaces based on a few instances of function pairs. This task
frequently presents a severely ill-posed PDE inverse problem. In this work, we
propose a novel neural operator architecture based on the attention mechanism,
which we coin Nonlocal Attention Operator (NAO), and explore its capability to-
wards developing a foundation physical model. In particular, we show that the at-
tention mechanism is equivalent to a double integral operator that enables nonlocal
interactions among spatial tokens, with a data-dependent kernel characterizing the
inverse mapping from data to the hidden parameter ﬁeld of the underlying operator.
As such, the attention mechanism extracts global prior information from training
data generated by multiple systems, and suggests the exploratory space in the form
of a nonlinear kernel map. Consequently, NAO can address ill-posedness and rank
deﬁciency in inverse PDE problems by encoding regularization and achieving gen-
eralizability. We empirically demonstrate the advantages of NAO over baseline
neural models in terms of generalizability to unseen data resolutions and system
states. Our work not only suggests a novel neural operator architecture for learning
interpretable foundation models of physical systems, but also offers a new perspec-
tive towards understanding the attention mechanism. Our code and data accompa-
nying this paper are available at https://github.com/fishmoon1234/NAO .
1 Introduction
The interpretability of machine learning (ML) models has become increasingly important from the
security and robustness standpoints [ Rudin et al. ,2022 ,Molnar ,2020 ]. This is particularly true in
physics modeling problems that can affect human lives, where not only the accuracy but also the
transparency of data-driven models are essential in making decisions [ Coorey et al. ,2022 ,Ferrari
and Willcox ,2024 ]. Nevertheless, it remains challenging to discover the underlying physical system
and the governing mechanism from data. Taking the material modeling task for instance, given that
only the deformation ﬁeld is observable, the goal of discovering the underlying material parame-
∗Corresponding Author
38th Conference on Neural Information Processing Systems (NeurIPS 2024).ter ﬁeld and mechanism presents an ill-posed unsupervised learning task. That means, even if an
ML model can serve as a good surrogate to predict the corresponding loading ﬁeld from a given
deformation ﬁeld, its inference of the material parameters can still drastically deteriorate.
(u1, f1)
(u2, f2)
     .     .     .
(un, fn)WQKKernel space of 
identifiability IntegrateTraining
Downstream applicationutestKernel (mechanism)
K[u1:n, f1:n]
ftest
WP,u    WP,f
Figure 1: Illustration of NAO’s architecture.To discover an interpretable mechanism for phys-
ical systems, a major challenge is to infer the
governing laws of these systems that are often
high- or inﬁnite-dimensional, from data that are
comprised of discrete measurements of continu-
ous functions. Therefore, a data-driven surrogate
model needs to learn not only the mapping be-
tween input and output function pairs, but also the
mapping from given function pairs to the hidden
state. From the PDE-based modeling standpoint,
learning a surrogate model corresponds to a for-
ward problem, whereas inferring the underlying
mechanism is an inverse problem. The latter is generally an enduring ill-posed problem, especially
when the measurements are scarce. Unfortunately, such an ill-posedness issue may become even
more severe in neural network models, due to the inherent bias of neural network approximations
[Xu et al. ,2019 ]. To tackle this challenge, many deep learning methods have recently been proposed
as inverse PDE solvers [ Fan and Ying ,2023 ,Molinaro et al. ,2023 ,Jiang et al. ,2022 ,Chen et al. ,
2023 ]. The central idea is to incorporate prior information into the learning scheme, in the form of
governing PDEs [ Yang et al. ,2021 ,Li et al. ,2021 ], regularizers [ Dittmer et al. ,2020 ,Obmann et al. ,
2020 ,Ding et al. ,2022 ,Chen et al. ,2023 ], or additional operator structures [ Uhlmann ,2009 ,Lai
et al. ,2019 ,Yilmaz ,2001 ]. However, such prior information is often either unavailable or problem-
speciﬁc in complex systems. As a result, these methods can only solve the inverse problem for a
particular system, and one has to start from scratch when the system varies (e.g., when the material
of the specimen undergoes degradation in a material modeling task).
In this work, we propose Nonlocal Attention Operator (NAO) , a novel attention-based neural op-
erator architecture to simultaneously solve both forward and inverse modeling problems. Neural
operators (NOs) [ Li et al. ,2020a ,c] learn mappings between inﬁnite-dimensional function spaces in
the form of integral operators, hence they provide promising tools for the discovery of continuum
physical laws by manifesting the mapping between spatial and/or spatiotemporal data; see You et al.
[2022 ],Liu et al. [2024a ,b,2023 ],Ong et al. [2022 ],Cao[2021 ],Lu et al. [2019 ,2021 ],Goswami
et al. [2022 ],Gupta et al. [2021 ] and references therein. However, most NOs focus on providing
an efﬁcient surrogate for the underlying physical system as a forward solver. They are often em-
ployed as black-box universal approximators but lack interpretability of the underlying physical
laws. In contrast, the key innovation of NAO is that it introduces a kernel map based on the atten-
tion mechanism for simultaneous learning of the operator and the kernel map. As such, the kernel
map automatically infers the context of the underlying physical system in an unsupervised manner.
Intuitively, the attention mechanism extracts hidden knowledge from multiple systems by providing
a function space of identiﬁability for the kernels, which acts as an automatic data-driven regularizer
and endows the learned model’s generalizability to new and unseen system states.
In this context, NAO learns a kernel map using the attention mechanism and simultaneously solves
both the forward and inverse problems. The kernel map, whose parameters extract the global infor-
mation about the kernel from multiple systems, efﬁciently infers resolution-invariant kernels from
new datasets. As a consequence, NAO can achieve interpretability of the nonlocal operator and
enable the discovery of hidden physical laws. Our key contributions include:
•We bridge the divide between inverse PDE modeling and physics discovery tasks, and
present a method to simultaneously perform physics modeling (forward PDE) and mecha-
nism discovery (inverse PDE).
•We propose a novel neural operator architecture NAO, based on the principle of contextual
discovery from input/output function pairs through a kernel map constructed from multiple
physical systems. As such, NAO is generalizable to new and unseen physical systems, and
offers meaningful physical interpretation through the discovered kernel.
•We provide theoretical analysis to show that the attention mechanism in NAO acts to pro-
vide the space of identiﬁability for the kernels from the training data, which reveals its
ability to resolve ill-posed inverse PDE problems.
2•We conduct experiments on zero-shot learning to new and unseen physical systems, demon-
strating the generalizability of NAO in both forward and inverse PDE problems.
2 Background and related work
Our work resides at the intersection of operator learning, attention-based models, and forward and
inverse problems of PDEs. The ultimate goal is to model multiple physical systems from data while
simultaneously discovering the hidden mechanism.
Neural operator for hidden physics. Learning complex physical systems directly from data is ubiq-
uitous in scientiﬁc and engineering applications [ Ghaboussi et al. ,1998 ,Liu et al. ,2024c ,Ghaboussi
et al. ,1991 ,Carleo et al. ,2019 ,Karniadakis et al. ,2021 ,Zhang et al. ,2018 ,Cai et al. ,2022 ,Pfau
et al. ,2020 ,He et al. ,2021 ,Besnard et al. ,2006 ]. In many applications, the underlying govern-
ing laws are unknown, hidden in data to be revealed by physical models. Ideally, these models
should be interpretable for domain experts, who can then use these models to make further predic-
tions and expand the understanding of the target physical system. Also, these models should be
resolution-invariant . Neural operators are designed to learn mappings between inﬁnite-dimensional
function spaces [ Li et al. ,2020a ,b,c,You et al. ,2022 ,Ong et al. ,2022 ,Cao,2021 ,Lu et al. ,2019 ,
2021 ,Goswami et al. ,2022 ,Gupta et al. ,2021 ]. As a result, NOs provide a promising tool for the
discovery of physical laws by manifesting the mapping between spatial and/or spatio-temporal data.
Forward and inverse PDE problems. Most current NOs focus on providing an efﬁcient surrogate
for the underlying physical system as a forward PDE solver. They are often employed as black-
box universal approximators without interpretability of the underlying physical laws. Conversely,
several deep learning methods have been proposed as inverse PDE solvers [ Fan and Ying ,2023 ,
Molinaro et al. ,2023 ,Jiang et al. ,2022 ,Chen et al. ,2023 ], aiming to reconstruct the parameters
in the PDE from solution data. Compared to the forward problem, the inverse problem is typically
more challenging due to its ill-posed nature. To tackle the ill-posedness, many NOs incorporate
prior information, in the form of governing PDEs [ Yang et al. ,2021 ,Li et al. ,2021 ], regularizers
[Dittmer et al. ,2020 ,Obmann et al. ,2020 ,Ding et al. ,2022 ,Chen et al. ,2023 ], or additional operator
structures [ Uhlmann ,2009 ,Lai et al. ,2019 ,Yilmaz ,2001 ]. To our knowledge, our NO architecture
is the ﬁrst that solves both the forward (prediction) and inverse (discovery) problems simultaneously.
Attention mechanism. Since 2017, the attention mechanism has become the backbone of state-of-
the-art deep learning models on many core AI tasks like NLP and CV. By calculating the similarity
among tokens, the attention mechanism captures long-range dependencies between tokens [ Vaswani
et al. ,2017 ]. Then, the tokens are spatially mixed to obtain the layer output. Based on the choice of
mixers, attention-based models can be divided into three main categories: discrete graph-based atten-
tions [ Child et al. ,2019 ,Ho et al. ,2019 ,Wang et al. ,2020 ,Katharopoulos et al. ,2020 ], MLP-based
attentions [ Tolstikhin et al. ,2021 ,Touvron et al. ,2022 ,Liu et al. ,2021 ], and convolution-based atten-
tions [ Lee-Thorp et al. ,2021 ,Rao et al. ,2021 ,Guibas et al. ,2021 ,Nekoozadeh et al. ,2023 ]. While
most attention models focus on discrete mixers, it is proposed in Guibas et al. [2021 ],Nekoozadeh
et al. [2023 ],Tsai et al. [2019 ],Cao[2021 ],Wei and Zhang [2023 ] to frame token mixing as a kernel
integration, with the goal of obtaining predictions independent of the input resolution.
Along the line of PDE-solving tasks, various attention mechanisms have been used to enlarge model
capacity. To improve the accuracy of forward PDE solvers, Cao [2021 ] removes the softmax nor-
malization in the attention mechanism and employs linear attention as a learnable kernel in NOs.
Further developments include the Galerkin-type linear attention in an encoder-decoder architecture
in OFormer [ Li et al. ,2022 ], a hierarchical transformer for learning multiscale problems [ Liu et al. ,
2022 ], and a heterogeneous normalized attention with a geometric gating mechanism [ Hao et al. ,
2023 ] to handle multiple input features. In particular, going beyond solving a single PDE, the foun-
dation model feature of attention mechanisms has been applied towards solving multiple types of
PDEs within a speciﬁed context in Yang and Osher [2024 ],Ye et al. [2024 ],Sun et al. [2024 ],Zhang
[2024 ]. However, none of the existing work discovers hidden physics from data, nor do they discuss
the connections between the attention mechanism and the inverse PDE problem.
3 Nonlocal Attention Operator
Consider multiple physical systems that are described by a class of operators mapping from input
functions u∈Xto output functions f∈Y. Our goal is to learn the common physical law, in the
form of operators LK:X→Ywith system-dependent kernels K:
LK[u] +ϵ=f. (1)
3HereXandYare Banach spaces, ϵdenotes an additive noise describing the discrepancy between the
ground-truth operator and the optimal surrogate operator, and Kis a kernel function representing
the nonlocal spatial interaction. As such, the kernel provides the knowledge of its corresponding
system, while ( 1) offers a zero-shot prediction model for new and unseen systems.
To formulate the learning, we consider ntrain training datasets from different systems, with each
dataset containing dufunction pairs (u, f):
Dtr={{(uη
i(x), fη
i(x))}du
i=1}ntrain
η=1. (2)
In practice, the data of the input and output functions are on a spatial mesh {xk}nx
k=1⊂Ω⊂Rdx.
Thentrain models with kernels {Kη}ntrain
η=1 correspond to different material micro-structures or
different parametric settings. As a demonstration, we consider models for heterogeneous materials
with operators in the form
LK[u](x) =Z
ΩK(x, y)g[u](y)dy, x ∈Ω, (3)
where g[u](y)is a functional of udetermined by the operator; for example g[u](y) = u(y)in
Section 5.3. Our approach extends naturally to other forms of operators, such as those with ra-
dial interaction kernels in Section 5.1and heterogeneous interaction in the form of LK[u](x) = R
ΩK(x, y)g[u](x, y)dy. Additionally, for simplicity, we consider scalar-valued functions uandf
and note that the extension to vector-valued functions is trivial.
Remark: Such an operator learning problem arises in many applications in forward and inverse
PDE-solving problems. The inference of the kernel Kis an inverse problem, and the learning of the
nonlocal operator is a forward problem. When considering a single physical system and taking Kin
(3) as an input-independent kernel, classical NOs can be obtained for forward PDE-solving tasks [ Li
et al.,2020c ,Guibas et al. ,2021 ] and governing law learning tasks [ You et al. ,2021 ,Jafarzadeh et al. ,
2024 ]. Different from existing work, we consider the operator learning across multiple systems.
3.1 Kernel map with attention mechanism
The key ingredient in NAO is a kernel map constructed using the attention mechanism. It maps from
data pairs to an estimation of the underlying kernel. The kernel map
{(ui, fi)}du
i=1→K[u1:d,f1:d;θ] (4)
has parameters θestimated from the training dataset ( 2). As such, it maps from the token (u1:d,f1:d)
of the dataset {(ui, fi)}du
i=1to a kernel estimator, acting as an inverse PDE solver.
A major innovation of this kernel map is its dependence on both uandfthrough their tokens. Thus,
our approach distinguishes itself from the forward problem-solving NOs in the related work section,
where the attention depends only on u.
We ﬁrst transfer the data {(ui, fi)}du
i=1to tokens (u1:d,f1:d)according to the operator in ( 3) by
u1:d= (u1, . . . ,ud) = 
g[uj](yk)
1≤j≤d,1≤k≤N∈RN×d,
f1:d= (fj(xk))1≤j≤d,1≤k≤N∈RN×d,(5)
where d=duandN=nx, assuming that g[u]has a spatial mesh {yk=xk}N
k=1.
Then, our discrete (L+ 1)-layer attention model for the inverse PDE problem writes:
Xin=X(0)= (U(0),F(0)) := ( u1:d;f1:d)∈R2N×d,
X(l)=Attn[X(l−1);θl]X(l−1)+X(l−1)=: (U(l),F(l))∈R2N×d,1≤l < L,
Xout=XL=K[u1:d,f1:d;θ]u1:d≈f1:d∈RN×d.(6)
Here, θl= (WQ
l∈Rd×dk,WK
l∈Rd×dk)and the attention function is
Attn[X;θl] =σ1√dkXWQ
lWK
l⊤X⊤
∈R2N×2N.
The kernel map is deﬁned as
K[u1:d,f1:d;θ] =WP,uσ1√dk(U(L−1))⊤WQ
L(WK
L)⊤U(L−1)
+WP,fσ1√dk(F(L−1))⊤WQ
L(WK
L)⊤U(L−1)
,(7)
4where θ:={WP,u∈RN×N, WP,f∈RN×N,{WQ
l,WK
l}L
l=1}are learnable parameters. Here,
we note that dkonly controls the rank bound when lifting each point-wise feature via WQ
l(WK
l)⊤.
In the following, we denote WQK
l:=1√dkWQ
l(WK
l)⊤, which characterizes the (trainable) inter-
action of dinput function pair instances.
3.2 Nonlocal Attention Operator in continuum limit
As suggested by Cao[2021 ], we take the activation function σas a linear operator. Then, noting that
the matrix multiplication in ( 6) is a Riemann sum approximation of an integral (with a full derivation
in Appendix A), we propose the nonlocal attention operator as the continuum limit of ( 6):
g(0)
j(x) :=g[uj](x), f(0)
j(x) :=fj(x),
 
g(l)
j(x)
f(l)
j(x)!
=Z
ΩK(l)(x, y) 
g(l−1)
j (y)
f(l−1)
j (y)!
dy+ 
g(l−1)
j (x)
f(l−1)
j (x)!
,1≤l < L,
LK[u1:d,f1:d;θ][u](x) =Z
ΩK[u1:d,f1:d;θ](x, y)g[u](y)dy, (8)
in which the integration is approximated by the Riemann sum in our implementation. Here,
K(l)(x, y) :=2
4Pd
ω,ν=1
g(l−1)
ω (x)WQK
l[ω, ν]g(l−1)
ν (y)Pd
ω,ν=1
g(l−1)
ω (x)WQK
l[ω, ν]f(l−1)
ν (y)
Pd
ω,ν=1
f(l−1)
ω (x)WQK
l[ω, ν]g(l−1)
ν (y)Pd
ω,ν=1
f(l−1)
ω (x)WQK
l[ω, ν]f(l−1)
ν (y)3
5
K[u1:d,f1:d;θ](x, y) :=dX
ω,ν=1Z
ΩWP,u(x, z)
g(L−1)
ω (z)WQK
L[ω, ν]g(L−1)
ν (y)
dz
+dX
ω,ν=1Z
ΩWP,f(x, z)
f(L−1)
ω (z)WQK
L[ω, ν]g(L−1)
ν (y)
dz.
We learn the parameters θby minimizing the following mean squared error loss function:
E(θ) :=1
ntrainntrainX
η=1dX
i=1Z
ΩLK[uη
1:d,fη
1:d;θ][uη
i](x)−fη
i(x)2
dx. (9)
The performance of the model is evaluated on test tasks with new and unseen kernels Dtest=
{(utest
i(x), ftest
i(x))}d
i=1based on the following two criteria:
Operator (forward PDE) Error: Ef:=1
ddX
i=1LK[utest
1:d,ftest
1:d;θ][utest
i](x)−ftest
i(x)
L2(Ω)
||ftest
i(x))||L2(Ω),(10)
Kernel (inverse PDE) Error: EK:=K[utest
1:d,ftest
1:d;θ]−Ktest
L2(ρ)/|Ktest|L2(ρ). (11)
Here, L2(ρ)is the empirical measure in the kernel space as deﬁned in Lu et al. [2023 ]. Note that
θare trained using multiple datasets. Intuitively speaking, the attention mechanism helps encode
the prior information from other tasks for learning the nonlocal kernel, and leads to estimators
signiﬁcantly better than those using a single dataset. To formally understand this mechanism, we
analyze a shallow 2-layer NAO in the next section.
4 Understanding the attention mechanism
To facilitate further understanding of the attention mechanism, we analyze the limit of the two-
layer attention-parameterized kernel in ( 7) and the range of the kernel map, which falls in the space
of identiﬁability for the kernels from the training data. We also connect the kernel map with the
regularized estimators. For simplicity, we consider operators of the form
LK[u](x) =Zδ
0K(r)g[u](r, x)dr, x∈Ω, (12)
which is the radial nonlocal kernel in Sec. 5.1.
4.1 Limit of the two-layer attention-parameterized kernel
We show that, as the number Nand the spatial mesh nxapproach inﬁnity, the limit of the two-layer
attention-parameterized kernel is a double integral. Its proof is in Appendix B.1.
5For simplicity, we assume that the dataset in ( 2) has du= 1 andntrain = 1 with a uniform mesh
{xj}nx
j=1. We deﬁne the tokens by
u1:d= (u1, . . . ,ud) = ( g[u](rk, xj))1≤j≤d,1≤k≤N∈RN×d,f1:d= (f(xj))1≤j≤d∈R1×d,
(13)
where d=nxand{rk}N
k=1is the spatial mesh for K’s independent variable r∈[0, δ].
Lemma 4.1. Consider the two-layer attention model in (6)–(7)with bounded parameters. For
each dandN, let{xj}d
j=1and{rk}N
k=1be uniform meshes of the compact sets Ωand[0, δ], and let
{Aj}d
j=1be the resulting uniform partition of Ω. Assume that g[u]in(12)is continuous on [0, δ]×Ω.
Then,
lim
N→∞lim
d→∞NX
k=1K[u1:d,f1:d;θ](rk)1[rk−1,rk)(r)(rk−rk−1)
=K[u, f](r) :=Zδ
0WP,u(|r′|)σZ Zh
g[u](r′, x)WQK(x, y)g[u](r, y)dxdyi
dr′
+WP,fσZ Zh
f(x)WQK(x, y)g[u](r, y)i
dxdy
,(14)
where WQK(x, y) = lim d→∞Pd
j,j′=1WQK[j, j′]1Aj×Aj′(x, y)is the scaled L2(Ω×Ω)
limit of the parameter matrix WQK[j′, j] =Pdk
l=1WQ[j, l]·WK[j′, l]andWP,u(r) =
limN→∞PN
k=1WP,u[k]1[rk−1,rk)(r).
4.2 Space of identiﬁability for the kernels
For a given training dataset, we show that the function space in which the kernels can be identiﬁed
is the closure of a data-adaptive reproducing kernel Hilbert space (RKHS). This space contains the
range of the kernel map and hence provides the ground for analyzing the inverse problem.
Lemma 4.2 (Space of Identiﬁability) .Assume that the training data pairs in (2)are sampled from
continuous functions {uη
i}du,ntrain
i,η=1 with a compact support. Then, the function space the loss func-
tion in (9)has a unique minimizer K(s) = K[uη
1:d,fη
1:d;θ](s)is the closure of a data-adaptive
RKHS HGwith a reproducing kernel ¯Gdetermined by the training data:
¯G(r, s) = [ρ′(r)ρ′(s)]−1G(r, s),
where ρ′is the density of the empirical measure ρdeﬁned by
ρ′(r) :=1
ZntrainX
η=1duX
i=1Z
Ω|g[uη
i](r, x)|dx, (15)
and the function Gis deﬁned by G(r, s) :=1
ntraindPntrain
η=1Pdu
i=1R
Ωg[uη
i](r, x)g[uη
i](s, x)dx.
The above space is data-adaptive since the integral kernel ¯Gdepends on data. It characterizes the
information in the training data for estimating the nonlocal kernel K(s) =K[uη
1:d,fη
1:d;θ](s). In
general, the more data, the larger the space is. On the other hand, note that the loss function’s
minimizer with respect to K(s)is not the kernel map. The minimizer is a ﬁxed estimator for the
training dataset and does not provide any information for estimating the kernel from another dataset.
Comparison with regularized estimators. The kernel map solves the ill-posed inverse problem
using prior information from the training dataset of multiple systems, which is not used in classi-
cal inverse problem solvers. To illustrate this mechanism, consider the extreme case of estimating
the kernel in the nonlocal operator from a dataset consisting of only a single function pair (u, f).
This inverse problem is severely ill-posed because of the small dataset and the need for deconvolu-
tion to estimate the kernel. Thus, regularization is necessary, where two main challenges present:
(i) the selection of a proper regularization with limited prior information, and (ii) the prohibitive
computational cost of solving the resulting large linear systems many times.
In contrast, our kernel map K[u1:d,f1:d;θ](s), with the parameter θestimated from the training
datasets, acts on the token (u1:d,f1:d)of(u, f)to provide an estimator. It passes the prior infor-
mation about the kernel from the training dataset to the estimation for new datasets. Importantly,
6it captures the nonlinear dependence of the estimator on the data (u, f). Computationally, it can
be applied directly to multiple new datasets without solving the linear systems. In Section B.2, we
further show that a regularized estimator depends nonlinearly on the data pair (u, f). In particular,
similar to Lemma 4.1, there is an RKHS determined by the data pair (u, f). The regularized estima-
tor suggests that the kernel map can involve a component quadratic in the feature g[u], similar to the
limit form of the attention model in Lemma 4.1.
5 Experiments
We assess the performance of NAO on a wide range of physics modeling and discovery datasets.
Our evaluation focuses on several key aspects: 1) we demonstrate the merits of the continuous and
linear attention mechanism, compare the performance with the baseline discrete attention model (de-
noted as Discrete-NAO), the softmax attention mechanism (denoted as Softmax-NAO), NAO with
input on uonly (denoted as NAO-u), the convolution-based attention mechanism (denoted as AFNO
[Guibas et al. ,2021 ]), and an MLP-based encoder architecture that maps the datum [u1:d,f1:d]di-
rectly to a latent kernel (denoted as Autoencoder); 2) we measure the generalizability, in particular,
the zero-shot prediction performance in modeling a new physical system with unseen governing
equations, and across different resolutions; 3) we evaluate the data efﬁciency-accuracy trade-off in
ill-posed inverse PDE learning tasks, as well as the interpretability of the learned kernels. In all
experiments, the optimization is performed with the Adam optimizer. To conduct fair comparison
across different methods, we tune the hyperparameters, including the learning rates, the decay rates,
and the regularization parameters, to minimize the training loss. In all examples, we use 3-layer
models, and parameterize the kernel network WP,uandWP,fwith a 3-layer MLP with hidden
dimensions (32,64)and LeakyReLU activation. Experiments are conducted on a single NVIDIA
GeForce RTX 3090 GPU with 24 GB memory. Additional results and details on data generation and
training strategies are provided in Appendix C.
5.1 Radial kernel learning
Table 1: Test errors and the number of trainable parameters for the radial kernel problem, where bold
numbers highlight the best methods. The small operator errors and large kernel errors of discrete-
NAO highlight the ill-posedness of the inverse problem. NAO overcomes the ill-posedness and
yields resolution-invariant estimators.
Case model #param Operator test error Kernel test error
ID OOD1 ID OOD1
Discrete-NAO 16526 1.33% 25.81% 29.02% 28.80%
Softmax-NAO 18843 13.45% 66.06% 67.55% 85.80%
d= 302, dk=10 AFNO 19605 22.62% 68.76% - -
NAO 18843 1.48% 8.10% 5.40% 10.02%
NAO-u 18842 13.68% 66.68% 20.46% 74.03%
Autoencoder 16424 12.97% 1041.49% 22.56% 136.79%
d= 302, dk=5 Discrete-NAO 10465 1.63% 15.80% 33.21% 30.39%
NAO 12783 2.34% 9.23% 6.87% 14.62%
d= 302, dk=20 Discrete-NAO 28645 1.35% 18.70% 35.49% 30.81%
NAO 30963 1.33% 9.12% 4.63% 9.14%
d= 100, dk=10 Discrete-NAO 8446 1.73% 14.92% 34.52% 35.20%
NAO 10763 1.07% 6.35% 7.41% 17.02%
d= 50, dk=10 Discrete-NAO 6446 2.29% 10.31% 41.80% 45.30%
NAO 8763 1.56% 7.19% 15.95% 29.47%
d= 30, dk=10 Discrete-NAO 5646 5.60% 11.31% 58.24% 64.23%
NAO 7963 2.94% 8.04% 22.65% 33.77%
In this example, we consider the learning of nonlocal diffusion operators, in the form:
Lγη[u](x) =Z
Ωγη(|y−x|)[u(y)−u(x)]dy=f(x),∀x∈Ω. (16)
Unlike a (local) differential operator, this operator depends on the function unonlocally through
the convolution of u(y)−u(x), and the operator is characterized by a radial kernel γη. It ﬁnds
broad physical applications in describing fracture mechanics [ Silling ,2000 ], anomalous diffusion
behaviors [ Bucur et al. ,2016 ], and the homogenization of multiscale systems [ Du et al. ,2020 ].
70 2 4 6 8|x-y|00.10.20.30.4K(|x-y|)Ground-truth in-distribution test kernel
Discrete-NAO: kernel error =55.24%
NAO, same resolution: kernel error=22.65%
NAO, cross resolution: kernel error=20.79%
0 2 4 6 8|x-y|00.20.40.60.811.2K(|x-y|)Ground-truth out-of-distribution test kernel
Discrete-NAO: kernel error =64.23%
NAO: kernel error=33.77%Figure 2: Results on radial kernel learning, when learning the test kernel from a small ( d= 30 )
number of data pairs: test on an ID task (left), and test on an OOD task (right).
In this context, our goal is to learn the operator Las well as to discover the hidden mechanism,
namely the kernel K[u1:d,f1:d;θ](x, y) =γη(|y−x|). In the form of the operator in ( 12), we have
K(r) =γη(r)andg[u](r, x) =u(x+r) +u(x−r)−2u(x)forr∈[0, δ].
To generate the training data, we consider 7sine-type kernels
γη(|y−x|) := exp( −η(|y−x|)) sin(6 |y−x|)1[0,11](|y−x|), η= 1,2,3,4,6,7,8. (17)
Here, ηdenotes task index. We generate 4530 data pairs (gη[u], fη)with a ﬁxed resolution ∆x=
0.0125 for each task, where the loading function Lγη[uη] =fηis computed by the adaptive Gauss-
Kronrod quadrature method. Then, we form a training sample of each task by taking dpairs from
this task. When taking the token size d= 302 , each task contains4530
302= 15 samples. We consider
two test kernels: one following the same rule of ( 17) with η= 5 (denoted as the “in-distribution
(ID) test” system), and the other following a different rule (denoted as the “out-of-distribution (OOD)
test1” system):
γood1(|y−x|) :=|y−x|(11− |y−x|) exp( −5(|y−x|)) sin(6 |y−x|)1[0,11](|y−x|).(18)
Both the operator error ( 10) and the kernel error ( 11) are provided in Table 1. While the former
measures the error of the learned forward PDE solver (i.e., learning a physical model), the latter
demonstrates the capability of serving as an inverse PDE solver (i.e., physics discovery).
Ablation study. We ﬁrst perform an ablation study on NAO, by comparing its performance with its
variants (Discrete-NAO, Softmax-NAO, and NAO-u), AFNO, and Autoencoder, with a ﬁxed token
dimension d= 302 , query-key feature size dk= 10 , and data resolution ∆x= 0.0125 . When
comparing the operator errors, both Discrete-NAO and NAO serve as good surrogate models for
the ID task with relative errors of 1.33% and1.48%, respectively, while the other three baselines
show >10% errors. Therefore, we focus more on the comparison between Discrete-NAO and NAO.
This gap becomes more pronounced in the OOD task: only NAO is able to provide a surrogate of
Lγoodwith<10% error, who outperforms its discrete mixer counterpart by 68.62%, indicating that
NAO learns a more generalizable mechanism. This argument is further afﬁrmed when comparing
the kernel errors, where NAO substantially outperforms all baselines by at least 81.39% in the ID
test and 65.21% in the OOD test. This study veriﬁes our analysis in Section 4: NAO learns the
kernel map in the space of identiﬁability, and hence possesses advantages in solving the challenging
ill-posed inverse problem. Additionally, we vary the query-key feature size from dk= 10 todk= 5
anddk= 20 . Note that dkdetermines the rank bound of WQK, the matrix that characterizes the
interaction between different data pairs. Discrete-NAO again performs well only in approximating
the operator for the ID test, while NAO achieves consistent results in both tests and criteria, showing
that it has successfully discovered the intrinsic low-dimension in the kernel space.
Alleviating ill-posedness. To further understand NAO’s capability as an inverse PDE solver, we
reduce the number of data pairs for each sample from d= 302 tod= 30 , making it more ill-
posed as an inverse PDE problem. NAO again outperforms its discrete mixer counterpart in all
aspects. Interestingly, the errors in NAO increase almost monotonically, showing its robustness. For
Discrete-NAO, the error also increases monotonically in the ID operator test, but there exists no
consistent pattern in other test criteria. Figure 2shows the learned test kernels in both the ID and
OOD tasks. It shows that Discrete-NAO learns highly oscillatory kernels, while our continuous NAO
only has a discrepancy near |x−y|= 0. Note that when |x−y|= 0, we have u(y)−u(x) = 0 in
the ground-truth operator ( 16), and hence the kernel value at this point does not change the operator
8Figure 3: Kernel visualization in experiment 2, where the kernels correspond to the inverse of stiff-
ness matrix: ground truth (left), test kernel from Discrete-NAO (middle), kernel from NAO (right).
value. That means, our data provides almost no information at this point. This again veriﬁes our
analysis: continuous NAO learns the kernel map structure from small data based on prior knowledge
from other task datasets.
Cross-resolution. We test the NAO model trained with ∆x= 0.0125 on a dataset corresponding
to∆x= 0.025, and plot the results in Figure 2Left. The predicted kernel is very similar to the one
learned from the same resolution, and the error is also on-par ( 22.65% versus 20.79%).
5.2 Solution operator learning
We consider the modeling of 2D sub-surface ﬂows through a porous medium with a heterogeneous
permeability ﬁeld. Following the settings in Li et al. [2020a ], the high-ﬁdelity synthetic simulation
data for this example are described by the Darcy ﬂow. Here, the physical domain is Ω = [0 ,1]2,
b(x)is the permeability ﬁeld, and the Darcy’s equation has the form:
−∇ · (b(x)∇p(x)) = g(x),x∈Ω; p(x) = 0 ,x∈∂Ω. (19)
In this context, we aim to learn the solution operator of Darcy’s equation and compute the pressure
ﬁeldp(x). We consider two study scenarios. 1) g→p: each task has a ﬁxed microstructure b(x),
and our goal is to learn the (linear) solution operator mapping from each loading ﬁeld gto the
corresponding solution ﬁeld p. In this case, the kernel Kacts as the Green’s function of ( 19), and
can be approximated by the inverse of the stiffness matrix. 2) b→p: each task has a ﬁxed loading
ﬁeldg(x), and our goal is to learn the (nonlinear) solution operator mapping from the permeability
ﬁeldbto the corresponding solution ﬁeld p.
Table 2: Test errors and the number of trainable parameters in solution operator learning.
Case model #param Linear Operator: g→pNonlinear Operator: b→p
d= 20, dk=20 Discrete-NAO 161991 8.61% 10.84%
900samples NAO 89778 8.33% 11.40%
d= 50, dk=40 Discrete-NAO 662163 3.28% 5.61%
9000 samples NAO 189234 3.19% 5.28%
We report the operator learning results in Table 2, where NAO slightly outperforms Discrete-NAO
in most cases, using only 1/2 or 1/3 the number of trainable parameters. On the other hand, we also
verify the kernel learning results by comparing the learned kernels in a test case with the ground-
truth inverse of stiffness matrix in Figure 3. Although both Discrete-NAO and NAO capture the
major pattern, the kernel from Discrete-NAO again shows a spurious oscillation in regions where
the ground-truth kernel has zero value. On the other hand, by exploring the kernel map in the
integrated knowledge space, the learned kernel from NAO does not exhibit such spurious modes.
To demonstrate the physical interpretability of the learned kernel, in the ﬁrst row of Figure 4we
show the ground-truth microstructure b(x), a test loading ﬁeld instance g(x), and the corresponding
solution p(x). By taking the summation of the kernel strength on each row, one can discover the
interaction strength of each material point xwith its neighbors. As this strength is related to the per-
meability ﬁeld b(x), the underlying microstructure can be recovered accordingly. In the bottom row
of Figure 4, we demonstrate the discovered microstructure of this test task. We note that the discov-
ered microstructure is smoothed out due to the continuous setting of our learned kernel (as shown
in the bottom left plot), and a thresholding step is performed to discover the two-phase microstruc-
ture. The discovered microstructure (bottom right plot) matches well with the hidden ground-truth
microstructure (left plot), except for regions near the domain boundary. This mismatch is due to
9Figure 4: Demonstration of the generated data and the recovered microstructure from the learned
kernel in Example 2. Top row: the ground-truth two-phase material microstructure from a test task
(left), an exemplar loading ﬁeld instance (middle), and the corresponding solution ﬁeld instance
(right). Bottom row: summation of the learned kernel for each line, corresponding to the total
interaction of all material points (left), and the discovered two-phase material microstructure after
thresholding (right).
the applied Dirichlet-type boundary condition ( p(x) = 0 on∂Ω) in all samples, which leads to the
measurement pairs (p(x), g(x))containing no information near the domain boundary ∂Ωand makes
it impossible to identify the kernel on boundaries.
5.3 Heterogeneous material learning
In this example, we investigate the learning of heterogeneous and nonlinear material responses us-
ing the Mechanical MNIST benchmark [ Lejeune ,2020 ]. For training and testing, we take 500
heterogeneous material specimens, where each specimen is governed by a Neo-Hookean material
with a varying modulus converted from the MNIST bitmap images. On each specimen, 200 load-
ing/response data pairs are provided. Two generalization scenarios are considered. 1) We mix the
data from all numbers and randomly take 10% of specimens for testing. This scenario corresponds
to an ID test. 2) We leave all specimens corresponding to the number ‘9’ for testing, and use the
rest for training. This scenario corresponds to an OOD test. The corresponding results are listed in
Table 3, where NAO again outperforms its discrete counterpart.
Table 3: Test errors and the number of trainable parameters in heterogeneous material learning.
Case model #param ID test OOD test
d= 40, dk=40 Discrete-NAO 5,469,528 7.21% 7.95%
22500 samples NAO 142,534 6.57% 6.26%
d= 100, dk=100 Discrete-NAO 7,353,768 6.34% 6.01%
45000 samples NAO 303,814 4.75% 5.58%
6 Conclusion
We propose Nonlocal Attention Operator (NAO), a novel NO architecture to simultaneously learn
both the forward (modeling) and inverse (discovery) solvers in physical systems from data. In par-
ticular, NAO learns the function-to-function mapping based on an integral NO architecture and pro-
vides a surrogate forward solution predictor. In the meantime, the attention mechanism is crafted in
building a kernel map from input-output function pairs to the system’s function parameters, offering
zero-shot generalizability to new and unseen physical systems. As such, the kernel map explores in
the function space of identiﬁability, resolving the enduring ill-posedness in inverse PDE problems.
In our empirical demonstrations, NAO outperforms all selected baselines on multiple datasets of
inverse PDE problems and out-of-distribution generalizability tasks.
Broader Impacts: Beyond its merits in forward/inverse PDE modeling, our work represents an
initial exploration in understanding the attention mechanism in physics modeling, and paves a theo-
retical path towards building a foundation model in scientiﬁc ML.
Limitations: Due to limited computational resource, our experiments focus on learning from a
small to medium number ( <500) of similar physical systems. It would be beneﬁcial to expand the
coverage and enable learning across different types of physical systems.
10Acknowledgments and Disclosure of Funding
S. Jafarzadeh would like to acknowledge support by the AFOSR grant FA9550-22-1-0197, and Y. Yu
would like to acknowledge support by the National Science Foundation (NSF) under award DMS-
1753031 and the National Institute of Health under award 1R01GM157589-01. Portions of this
research were conducted on Lehigh University’s Research Computing infrastructure partially sup-
ported by NSF Award 2019035. F. Lu would like to acknowledge support by NSF DMS-2238486.
This article has been authored by an employee of National Technology and Engineering Solutions
of Sandia, LLC under Contract No. DE-NA0003525 with the U.S. Department of Energy (DOE).
The employee owns all right, title and interest in and to the article and is solely responsible for
its contents. The United States Government retains and the publisher, by accepting the article for
publication, acknowledges that the United States Government retains a non-exclusive, paid-up, ir-
revocable, worldwide license to publish or reproduce the published form of this article or allow
others to do so, for United States Government purposes. The DOE will provide public access
to these results of federally sponsored research in accordance with the DOE Public Access Plan
https://www.energy.gov/downloads/doe-public-access-plan.
References
Gilles Besnard, François Hild, and Stéphane Roux. ﬁnite-element displacement ﬁelds analysis from
digital images: application to portevin–le châtelier bands. Experimental mechanics , 46(6):789–
803, 2006.
Claudia Bucur, Enrico Valdinoci, et al. Nonlocal diffusion and applications , volume 20. Springer,
2016.
Shengze Cai, Zhiping Mao, Zhicheng Wang, Minglang Yin, and George Em Karniadakis. Physics-
informed neural networks (PINNs) for ﬂuid mechanics: A review. Acta Mechanica Sinica , pages
1–12, 2022.
Shuhao Cao. Choose a transformer: Fourier or galerkin. Advances in neural information processing
systems , 34:24924–24940, 2021.
Giuseppe Carleo, Ignacio Cirac, Kyle Cranmer, Laurent Daudet, Maria Schuld, Naftali Tishby,
Leslie Vogt-Maranto, and Lenka Zdeborová. Machine learning and the physical sciences. Re-
views of Modern Physics , 91(4):045002, 2019.
Ke Chen, Chunmei Wang, and Haizhao Yang. let data talk: data-regularized operator learning theory
for inverse problems. arXiv preprint arXiv:2310.09854 , 2023.
Rewon Child, Scott Gray, Alec Radford, and Ilya Sutskever. Generating long sequences with sparse
transformers. arXiv preprint arXiv:1904.10509 , 2019.
Genevieve Coorey, Gemma A Figtree, David F Fletcher, Victoria J Snelson, Stephen Thomas Ver-
non, David Winlaw, Stuart M Grieve, Alistair McEwan, Jean Yee Hwa Yang, Pierre Qian, Kieran
O’Brien, Jessica Orchard, Jinman Kim, Sanjay Patel, and Julie Redfern. The health digital twin
to tackle cardiovascular diseaseA review of an emerging interdisciplinary ﬁeld. NPJ Digital
Medicine , 5:126, 2022.
Wen Ding, Kui Ren, and Lu Zhang. Coupling deep learning with full waveform inversion. arXiv
preprint arXiv:2203.01799 , 2022.
Sören Dittmer, Tobias Kluth, Peter Maass, and Daniel Otero Baguer. Regularization by architecture:
A deep prior approach for inverse problems. Journal of Mathematical Imaging and Vision , 62:
456–470, 2020.
Qiang Du, Bjorn Engquist, and Xiaochuan Tian. Multiscale modeling, homogenization and nonlo-
cal effects: Mathematical and computational issues. Contemporary mathematics , 754:115–140,
2020.
Yuwei Fan and Lexing Ying. Solving traveltime tomography with deep learning. Communications
in Mathematics and Statistics , 11(1):3–19, 2023.
11Alberto Ferrari and Karen Willcox. Digital twins in mechanical and aerospace engineering. Nature
Computational Science , 4(3):178–183, 2024.
J Ghaboussi, JH Garrett Jr, and Xiping Wu. Knowledge-based modeling of material behavior with
neural networks. Journal of engineering mechanics , 117(1):132–153, 1991.
Jamshid Ghaboussi, David A Pecknold, Mingfu Zhang, and Rami M Haj-Ali. Autoprogressive
training of neural network constitutive models. International Journal for Numerical Methods in
Engineering , 42(1):105–126, 1998.
Somdatta Goswami, Aniruddha Bora, Yue Yu, and George Em Karniadakis. Physics-informed neu-
ral operators. 2022 arXiv preprint arXiv:2207.05748 , 2022.
John Guibas, Morteza Mardani, Zongyi Li, Andrew Tao, Anima Anandkumar, and Bryan Catan-
zaro. Adaptive fourier neural operators: Efﬁcient token mixers for transformers. arXiv preprint
arXiv:2111.13587 , 2021.
Gaurav Gupta, Xiongye Xiao, and Paul Bogdan. Multiwavelet-based operator learning for differen-
tial equations. Advances in neural information processing systems , 34:24048–24062, 2021.
Zhongkai Hao, Zhengyi Wang, Hang Su, Chengyang Ying, Yinpeng Dong, Songming Liu,
Ze Cheng, Jian Song, and Jun Zhu. Gnot: A general neural operator transformer for operator
learning. In International Conference on Machine Learning , pages 12556–12569. PMLR, 2023.
Qizhi He, Devin W Laurence, Chung-Hao Lee, and Jiun-Shyan Chen. Manifold learning based
data-driven modeling for soft biological tissues. Journal of Biomechanics , 117:110124, 2021.
Jonathan Ho, Nal Kalchbrenner, Dirk Weissenborn, and Tim Salimans. Axial attention in multidi-
mensional transformers. arXiv preprint arXiv:1912.12180 , 2019.
Siavash Jafarzadeh, Stewart Silling, Ning Liu, Zhongqiang Zhang, and Yue Yu. Peridynamic neural
operators: A data-driven nonlocal constitutive model for complex material responses. Computer
Methods in Applied Mechanics and Engineering , 425:116914, 2024.
Hanyang Jiang, Yuehaw Khoo, and Haizhao Yang. Reinforced inverse scattering. arXiv preprint
arXiv:2206.04186 , 2022.
George Em Karniadakis, Ioannis G Kevrekidis, Lu Lu, Paris Perdikaris, Sifan Wang, and Liu Yang.
Physics-informed machine learning. Nature Reviews Physics , 3(6):422–440, 2021.
Angelos Katharopoulos, Apoorv Vyas, Nikolaos Pappas, and François Fleuret. Transformers are
rnns: Fast autoregressive transformers with linear attention. In International conference on ma-
chine learning , pages 5156–5165. PMLR, 2020.
Ru-Yu Lai, Qin Li, and Gunther Uhlmann. Inverse problems for the stationary transport equation in
the diffusion scaling. SIAM Journal on Applied Mathematics , 79(6):2340–2358, 2019.
James Lee-Thorp, Joshua Ainslie, Ilya Eckstein, and Santiago Ontanon. Fnet: Mixing tokens with
fourier transforms. arXiv preprint arXiv:2105.03824 , 2021.
Emma Lejeune. Mechanical mnist: A benchmark dataset for mechanical metamodels. Extreme
Mechanics Letters , 36:100659, 2020.
Zijie Li, Kazem Meidani, and Amir Barati Farimani. Transformer for partial differential equations’
operator learning. arXiv preprint arXiv:2205.13671 , 2022.
Zongyi Li, Nikola Kovachki, Kamyar Azizzadenesheli, Burigede Liu, Kaushik Bhattacharya, An-
drew Stuart, and Anima Anandkumar. Neural operator: Graph kernel network for partial differen-
tial equations. arXiv preprint arXiv:2003.03485 , 2020a.
Zongyi Li, Nikola Kovachki, Kamyar Azizzadenesheli, Burigede Liu, Andrew Stuart, Kaushik Bhat-
tacharya, and Anima Anandkumar. Multipole graph neural operator for parametric partial differ-
ential equations. Advances in Neural Information Processing Systems , 33:NeurIPS 2020, 2020b.
12Zongyi Li, Nikola Borislavov Kovachki, Kamyar Azizzadenesheli, Kaushik Bhattacharya, Andrew
Stuart, and Anima Anandkumar. Fourier NeuralOperator for Parametric Partial Differential Equa-
tions. In International Conference on Learning Representations , 2020c.
Zongyi Li, Hongkai Zheng, Nikola Kovachki, David Jin, Haoxuan Chen, Burigede Liu, Kamyar
Azizzadenesheli, and Anima Anandkumar. Physics-informed neural operator for learning partial
differential equations. 2021 arXiv preprint arXiv:2111.03794 , 2021.
Hanxiao Liu, Zihang Dai, David So, and Quoc V Le. Pay attention to mlps. Advances in neural
information processing systems , 34:9204–9215, 2021.
Ning Liu, Yue Yu, Huaiqian You, and Neeraj Tatikola. Ino: Invariant neural operators for learning
complex physical systems with momentum conservation. In International Conference on Artiﬁ-
cial Intelligence and Statistics , pages 6822–6838. PMLR, 2023.
Ning Liu, Yiming Fan, Xianyi Zeng, Milan Klöwer, LU ZHANG, and Yue Yu. Harnessing the power
of neural operators with automatically encoded conservation laws. In Forty-ﬁrst International
Conference on Machine Learning , 2024a.
Ning Liu, Siavash Jafarzadeh, and Yue Yu. Domain agnostic fourier neural operators. Advances in
Neural Information Processing Systems , 36, 2024b.
Ning Liu, Xuxiao Li, Manoj R Rajanna, Edward W Reutzel, Brady Sawyer, Prahalada Rao, Jim
Lua, Nam Phan, and Yue Yu. Deep neural operator enabled digital twin modeling for additive
manufacturing. arXiv preprint arXiv:2405.09572 , 2024c.
Xinliang Liu, Bo Xu, and Lei Zhang. Ht-net: Hierarchical transformer based operator learning
model for multiscale pdes. 2022.
Fei Lu, Quanjun Lang, and Qingci An. Data adaptive rkhs tikhonov regularization for learning
kernels in operators. In Mathematical and Scientiﬁc Machine Learning , pages 158–172. PMLR,
2022.
Fei Lu, Qingci An, and Yue Yu. Nonparametric learning of kernels in nonlocal operators. Journal
of Peridynamics and Nonlocal Modeling , pages 1–24, 2023.
Lu Lu, Pengzhan Jin, and George Em Karniadakis. Deeponet: Learning nonlinear operators for iden-
tifying differential equations based on the universal approximation theorem of operators. arXiv
preprint arXiv:1910.03193 , 2019.
Lu Lu, Pengzhan Jin, Guofei Pang, Zhongqiang Zhang, and George Em Karniadakis. Learning
nonlinear operators via DeepONet based on the universal approximation theorem of operators.
Nature Machine Intelligence , 3(3):218–229, 2021.
Roberto Molinaro, Yunan Yang, Björn Engquist, and Siddhartha Mishra. Neural inverse operators
for solving pde inverse problems. arXiv preprint arXiv:2301.11167 , 2023.
Christoph Molnar. Interpretable machine learning . 2020.
Anahita Nekoozadeh, Mohammad Reza Ahmadzadeh, and Zahra Mardani. Multiscale attention via
wavelet neural operators for vision transformers. arXiv preprint arXiv:2303.12398 , 2023.
Daniel Obmann, Johannes Schwab, and Markus Haltmeier. Deep synthesis regularization of inverse
problems. arXiv preprint arXiv:2002.00155 , 2020.
Yong Zheng Ong, Zuowei Shen, and Haizhao Yang. IAE-Net: integral autoencoders for
discretization-invariant learning. arXiv preprint arXiv:2203.05142 , 2022.
David Pfau, James S Spencer, Alexander GDG Matthews, and W Matthew C Foulkes. Ab initio
solution of the many-electron schrödinger equation with deep neural networks. Physical Review
Research , 2(3):033429, 2020.
Yongming Rao, Wenliang Zhao, Zheng Zhu, Jiwen Lu, and Jie Zhou. Global ﬁlter networks for
image classiﬁcation. Advances in neural information processing systems , 34:980–993, 2021.
13Cynthia Rudin, Chaofan Chen, Zhi Chen, Haiyang Huang, Lesia Semenova, and Chudi Zhong. In-
terpretable machine learning: Fundamental principles and 10 grand challenges. Statistic Surveys ,
16:1–85, 2022.
Stewart A Silling. Reformulation of elasticity theory for discontinuities and long-range forces. Jour-
nal of the Mechanics and Physics of Solids , 48(1):175–209, 2000.
Jingmin Sun, Yuxuan Liu, Zecheng Zhang, and Hayden Schaeffer. Towards a foundation model
for partial differential equation: Multi-operator learning and extrapolation. arXiv preprint
arXiv:2404.12355 , 2024.
Ilya O Tolstikhin, Neil Houlsby, Alexander Kolesnikov, Lucas Beyer, Xiaohua Zhai, Thomas Un-
terthiner, Jessica Yung, Andreas Steiner, Daniel Keysers, Jakob Uszkoreit, et al. Mlp-mixer: An
all-mlp architecture for vision. Advances in neural information processing systems , 34:24261–
24272, 2021.
Hugo Touvron, Piotr Bojanowski, Mathilde Caron, Matthieu Cord, Alaaeldin El-Nouby, Edouard
Grave, Gautier Izacard, Armand Joulin, Gabriel Synnaeve, Jakob Verbeek, et al. Resmlp: Feed-
forward networks for image classiﬁcation with data-efﬁcient training. IEEE Transactions on
Pattern Analysis and Machine Intelligence , 45(4):5314–5321, 2022.
Yao-Hung Hubert Tsai, Shaojie Bai, Makoto Yamada, Louis-Philippe Morency, and Ruslan
Salakhutdinov. Transformer dissection: a uniﬁed understanding of transformer’s attention via
the lens of kernel. arXiv preprint arXiv:1908.11775 , 2019.
Gunther Uhlmann. Electrical impedance tomography and calderón’s problem. Inverse problems , 25
(12):123011, 2009.
Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez,
Łukasz Kaiser, and Illia Polosukhin. Attention is all you need. Advances in neural information
processing systems , 30, 2017.
Sinong Wang, Belinda Z Li, Madian Khabsa, Han Fang, and Hao Ma. Linformer: Self-attention
with linear complexity. arXiv preprint arXiv:2006.04768 , 2020.
Min Wei and Xuesong Zhang. Super-resolution neural operator. In Proceedings of the IEEE/CVF
Conference on Computer Vision and Pattern Recognition , pages 18247–18256, 2023.
Zhi-Qin John Xu, Yaoyu Zhang, Tao Luo, Yanyang Xiao, and Zheng Ma. Frequency principle:
Fourier analysis sheds light on deep neural networks. arXiv preprint arXiv:1901.06523 , 2019.
Liu Yang and Stanley J Osher. Pde generalization of in-context operator networks: A study on 1d
scalar nonlinear conservation laws. arXiv preprint arXiv:2401.07364 , 2024.
Liu Yang, Xuhui Meng, and George Em Karniadakis. B-pinns: Bayesian physics-informed neu-
ral networks for forward and inverse pde problems with noisy data. Journal of Computational
Physics , 425:109913, 2021.
Zhanhong Ye, Xiang Huang, Leheng Chen, Hongsheng Liu, Zidong Wang, and Bin Dong. Pde-
former: Towards a foundation model for one-dimensional partial differential equations. arXiv
preprint arXiv:2402.12652 , 2024.
Özdo ˘gan Yilmaz. Seismic data analysis , volume 1. Society of exploration geophysicists Tulsa,
2001.
Huaiqian You, Yue Yu, Nathaniel Trask, Mamikon Gulian, and Marta DElia. Data-driven learning
of nonlocal physics from high-ﬁdelity synthetic data. Computer Methods in Applied Mechanics
and Engineering , 374:113553, 2021.
Huaiqian You, Yue Yu, Marta D’Elia, Tian Gao, and Stewart Silling. Nonlocal kernel network
(NKN): A stable and resolution-independent deep neural network. Journal of Computational
Physics , page arXiv preprint arXiv:2201.02217, 2022.
14Linfeng Zhang, Jiequn Han, Han Wang, Roberto Car, and E Weinan. Deep potential molecular
dynamics: a scalable model with the accuracy of quantum mechanics. Physical Review Letters ,
120(14):143001, 2018.
Zecheng Zhang. Modno: Multi operator learning with distributed neural operators. arXiv preprint
arXiv:2404.02892 , 2024.
15A Riemann sum approximation derivations
In this section, we show that the discrete attention operator ( 6) can be seen as the Riemann sum
approximation of the nonlocal attention operator in ( 8), in the continuous limit. Without loss of
generality, we consider a uniform discretization with grid size ∆x. Denoting the l−th layer out-
put asU(l)=
g(l)
j(xk)
1≤j≤d,1≤k≤N,F(l)=
f(l)
j(xk)
1≤j≤d,1≤k≤N, and1√dkWQ
lWK
las
WQK
l∈Rd×d, for the l−th (l < L ) layer update in ( 6) writes:
X(l)[α, β] =2NX
γ=1dX
ω,ν=1dkX
λ=11√dkX(l−1)[α, ω]WQ
l[ω, λ]WK
l[ν, λ]X(l−1)[γ, ν]
X(l−1)[γ, β] +X(l−1)[α, β]
=2NX
γ=1dX
ω,ν=1
X(l−1)[α, ω]WQK
l[ω, ν]X(l−1)[γ, ν]
X(l−1)[γ, β] +X(l−1)[α, β].
That means, dkonly controls the rank bound when lifting each point-wise feature via WQK
l, while
WQK
lcharacterizes the (trainable) interaction of dinput function pair instances. Moreover, when
α≤N,X(l)[α, β] =g(l)
β(xα). When α > N ,X(l)[α, β] =f(l)
β(xα−N). Then,
g(l)
β(xα) =NX
γ=1dX
ω,ν=1
X(l−1)[α, ω]WQK
l[ω, ν]X(l−1)[γ, ν]
X(l−1)[γ, β]
+2NX
γ=N+1dX
ω,ν=1
X(l−1)[α, ω]WQK
l[ω, ν]X(l−1)[γ, ν]
X(l−1)[γ, β] +g(l−1)
β (xα)
=NX
γ=1dX
ω,ν=1
g(l−1)
ω (xα)WQK
l[ω, ν]g(l−1)
ν (xγ)
g(l−1)
β (xγ)
+NX
˜γ=1dX
ω,ν=1
g(l−1)
ω (xα)WQK
l[ω, ν]f(l−1)
ν (x˜γ)
f(l−1)
β (x˜γ) +g(l−1)
β (xα).
Similarly,
f(l)
β(xα) =NX
γ=1dX
ω,ν=1
X(l−1)[α, ω]WQK
l[ω, ν]X(l−1)[γ, ν]
X(l−1)[γ, β]
+2NX
γ=N+1dX
ω,ν=1
X(l−1)[α, ω]WQK
l[ω, ν]X(l−1)[γ, ν]
X(l−1)[γ, β] +f(l−1)
β (xα)
=NX
γ=1dX
ω,ν=1
f(l−1)
ω (xα)WQK
l[ω, ν]g(l−1)
ν (xγ)
g(l−1)
β (xγ)
+NX
˜γ=1dX
ω,ν=1
f(l−1)
ω (xα)WQK
l[ω, ν]f(l−1)
ν (x˜γ)
f(l−1)
β (x˜γ) +f(l−1)
β (xα).
With the Riemann sum approximation:R
Ωp(x)dx≈∆xDPNx
k=1p(xk), one can further reformu-
late above derivations as:
g(l)
β(x)≈1
∆xDZ
ΩdX
ω,ν=1
g(l−1)
ω (x)WQK
l[ω, ν]g(l−1)
ν (y)
g(l−1)
β (y)dy
+1
∆xDZ
ΩdX
ω,ν=1
g(l−1)
ω (x)WQK
l[ω, ν]f(l−1)
ν (y)
f(l−1)
β (y)dy+g(l−1)
β (x),
f(l)
β(x)≈1
∆xDZ
ΩdX
ω,ν=1
f(l−1)
ω (x)WQK
l[ω, ν]g(l−1)
ν (y)
g(l−1)
β (y)dy
+1
∆xDZ
ΩdX
ω,ν=1
f(l−1)
ω (x)WQK
l[ω, ν]f(l−1)
ν (y)
f(l−1)
β (y)dy+f(l−1)
β (x).
16Therefore, the attention mechanism of each layer is in fact an integral operator after a rescaling:

g(l)(x)
f(l)(x)
=Z
ΩK(l)(x, y)
g(l−1)(y)
f(l−1)(y)
dy+
g(l−1)(x)
f(l−1)(x)
, (20)
with the kernel K(l)(x, y)deﬁned as:
2
4Pd
ω,ν=1
g(l−1)
ω (x)WQK
l[ω, ν]g(l−1)
ν (y)Pd
ω,ν=1
g(l−1)
ω (x)WQK
l[ω, ν]f(l−1)
ν (y)
Pd
ω,ν=1
f(l−1)
ω (x)WQK
l[ω, ν]g(l−1)
ν (y)Pd
ω,ν=1
f(l−1)
ω (x)WQK
l[ω, ν]f(l−1)
ν (y)3
5.(21)
For the L−th layer update, we denote the approximated value of fβ(xα)as˜fβ(xα) :=Xout[α, β],
then
˜fβ(xα) =NX
γ=1K[u1:d,f1:d;θ][α, γ]g[uβ](xγ)
=NX
λ,γ=1dX
ω,ν=1WP,u[α, λ]
U(L−1)[λ, ω]WQK
L[ω, ν]U(L−1)[γ, ν]
g[uβ](xγ)
+NX
λ,γ=1dX
ω,ν=1WP,f[α, λ]
F(L−1)[λ, ω]WQK
L[ω, ν]U(L−1)[γ, ν]
g[uβ](xγ)
=NX
λ,γ=1dX
ω,ν=1WP,u[α, λ]
g(L−1)
ω (xλ)WQK
L[ω, ν]g(L−1)
ν (xγ)
g[uβ](xγ)
+NX
λ,γ=1dX
ω,ν=1WP,f[α, λ]
f(L−1)
ω (xλ)WQK
L[ω, ν]g(L−1)
ν (xγ)
g[uβ](xγ)
≈1
∆x2DZ
ΩZ
ΩdX
ω,ν=1WP,u(xα, z)
g(L−1)
ω (z)WQK
L[ω, ν]g(L−1)
ν (y)
dz g[uβ](y)dy
+1
∆x2DZ
ΩZ
ΩdX
ω,ν=1WP,f(xα, z)
f(L−1)
ω (z)WQK
L[ω, ν]g(L−1)
ν (y)
dz g[uβ](y)dy.
Hence, a (rescaled) continuous limit of the kernel writes:
K[u1:d,f1:d;θ](x, y) =Z
ΩdX
ω,ν=1WP,u(x, z)
g(L−1)
ω (z)WQK
L[ω, ν]g(L−1)
ν (y)
dz
+Z
ΩdX
ω,ν=1WP,f(x, z)
f(L−1)
ω (z)WQK
L[ω, ν]g(L−1)
ν (y)
dz.
B Proofs and connection with regularized estimator
B.1 Proofs
Proof of Lemma 4.1.With{rk}N
k=1, we can write the attention-based kernel in ( 7) as
K[u1:d,f1:d;θ](rk) =NX
k′=1WP,u(rk′)σ0
@dkX
l=1dX
j=1dX
j=1uj(rk′)WQ[j, l]·WK[j′, l]uj′(rk)1
A
+WP,fσ0
@dkX
l=1dX
j=1dX
j′=1
fjWQ[j, l]·WK[j′, l]uj′(rk)1
A.(22)
17Denoting WQK[j′, j] =Pdk
l=1WQ[j, l]·WK[j′, l], we write the kernel in ( 22) as
K[u1:d,f1:d;θ](r) =NX
r′=1WP,u(|r′|)σ0
@dX
j=1dX
j′=1h
g[u](r′, xij)WQK[j, j′]g[u](r, xij′)i1
A
+WP,fσ0
@dX
i=1dX
j=1h
f(xij′)WQK[j, j′]g[u](r, xij)i1
A.
Then, as d→ ∞ is achieved by reﬁning the spatial mesh, viewing the summation in jas Riemann
sum,
lim
d→∞dX
j=1dX
j′=1g[u](r′, xij)WQK[j, j′]g[u](r, xij′) =Z Z
g[u](r, x)WQK(x, y)g[u](s, y)dxdy,
where the integral exists since g[u](r, x)WQK(x, y)is bounded. Sending also the number of tokens,
N, to inﬁnity, we obtain the limit attention model in ( 14).
Proof of Lemma 4.2.The proof is adapted from Lu et al. [2023 ,2022 ]. Write K(r) =
K[uη
1:d,fη
1:d](r). Notice that the loss function in ( 9) can be expanded as
E(K) =1
ntrainntrainX
η=1duX
i=1Z
Ω"Zδ
0K(r)g[uη
i](r, x))dr−fη
i(x)#2
dx
=1
ntrainntrainX
η=1duX
i=1Zδ
0Zδ
0K(s)K(r)Z
Ωg[uη
i](s, x))g[uη
i](r, x))dxdrds
−2
ntrainntrainX
η=1duX
i=1Zδ
0K(r)Z
Ωg[uη
i](r, x)fη
i(x)dxdr +Const.
=⟨L¯GK, K⟩L2ρ−2⟨K, KD⟩L2ρ+Const.,
where L¯G:L2
ρ→L2
ρis the integral operator
L¯GK(s) :=Zδ
0K(r)¯G(r, s)dr
andKDis the Riesz representation of the bounded linear functional
⟨K, KD⟩L2ρ=1
ntrainntrainX
η=1duX
i=1Zδ
0K(r)Z
Ωg[uη
i](r, x)fη
i(x)dxdr.
Thus, the quadratic loss function has a unique minimizer in Null(L¯G)⊥.
Meanwhile, since the data pairs are continuous with compact support, the function ¯Gis a square-
integrable reproducing kernel. Thus, the operator L¯Gis compact and HG=L1/2
¯GL2
ρ. Then,
Null(L¯G)⊥=HG, where the closure is with respect to L2
ρ.
B.2 Connection with regularized estimator
Consider the inverse problem of estimating the nonlocal kernel Kgiven a data pair (u, f). In the
classical variational approach, one seeks the minimizer of the following loss function
E(K) =Z
Ω"Zδ
0K(r)g[u](r, x)dr−f(x)#2
dx (23)
The inverse problem is ill-posed in the sense that the minimizer can often be non-unique or sensitive
to the noise or measurement error in data (u, f). Thus, regularization is crucial to produce a stable
solution.
18To connect with the attention-based model, we consider regularizing using an RKHS HWwith a
square-integrable reproducing kernel W. One seeks an estimator in HWby regularizing the loss
with the ∥K∥2
HW, and minimizes the regularized loss function
Eλ,W(K) =E(K) +λZ∞
0Z∞
0K(s)K(r)W(r, s)drds. (24)
The next lemma shows that the regularized estimator is a nonlinear function of the data pair (u, f),
where the nonlinearity comes from the kernel Guand the parameter λ∗.
Lemma B.1. The regularized loss function in Eλ,W(K)in(24)is
Eλ,W(K) =Z∞
0Z∞
0K(r)K(s)[Gu(r, s) +λW(r, s)]drds−2Z∞
0K(r)Ku,f(r)dr+Const.,
(25)
where Guis deﬁned in (27). Its minimizer is
bK= (LGu+λ∗LW)−1Ku,f, (26)
where LGuandLWare integral operators with integral kernels Gudeﬁned in (27)andW,
LGuK(s) :=Z∞
0K(r)Gu(r, s)dr,LWK(s) :=Z∞
0K(r)W(r, s)dr,
λ∗is the optimal hyper-parameter controlling the strength of regularization, and Ku,f(r) = R
Ωg[u](r, x)f(x)dxis a function determined by the data (u, f).
When there is no prior information on the regularization, which happens often for the learning of
the kernel, one can use the data-adaptive RKHS HGuwith the reproducing kernel Gudetermined
by data:
Gu(r, s) =Z
Ωg[u](r, x)g[u](s, x)dx. (27)
Lu et al. [2023 ] shows that this regularizer can lead to consistent convergent estimators.
Remark B.2 (Discrete data and discrete inverse problem) .In practice, the datasets are discrete. One
can view the discrete inverse problem as a discretization of the continuous inverse problem. Assume
that the integrands are compactly supported and when the integrals are approximated by Riemann
sums, we can write loss function for discrete K= (K(r1), . . . , K (rN))⊤∈RN×1as
Eλ,W(K)≈N,NX
k,k′=1K(rk)K(rk′)[Gu(rk, rk′) +λW(rk, rk′)](∆r)2−2NX
k=1K(rk)Ku,f(rk)∆r+Const..
=K⊤[Gu+λW]K−2K⊤Ku,f+Const., (28)
where, recalling the deﬁnition of the token u1:din (5),
Gu= (Gu(rk, rk′))1≤k,k′≤K= (Z
Ωg[u](x, rk)g[u](x, rk′)dx)1≤k,k′≤K≈u1:du⊤
1:d,
W= (W(rk, rk′))1≤k,k′≤KandKu,f= R
Ωg[u](rk, x)f(x)dx
1≤k≤N.
The minimizer of this discrete loss function with the optimal hyper-parameter λ∗is
bK= (Gu+λ∗W)−1Ku,f.
In particular, when taking W =Guand using the Neumann series (λ−1
∗G2
u+I)−1=P∞
k=0(−1)kλ−k
∗G2k
u, we have
bK= (λ−1
∗G2
u+I)−1λ−1
∗GuKu,f=λ−1
∗GuKu,f−λ−2
∗G3
uKu,f+∞X
k=2(−1)kλ−k
∗G2k
uGuKu,f.
In particular, λ∗depends on both GuandKu,f. Hence, the estimator bKis nonlinear in Guand
Ku,f, and it is important to make the attention depend nonlinearly on the token u1:d, as in ( 7).
19Proof of Lemma B.1.Since Kis radial and noticing that
Z
|ξ|=1(u(x+rξ)−u(x))dξ=u(x+r) +u(x−r)−2u(x) =g[u](r, x)
since ξ∈R1, we can write
Z∞
−∞Z∞
−∞K(|s|)K(|r|)Z
Ω(u(x+s)−u(x))(u(x+r)−u(x))dxdrds
=Z∞
0Z∞
0K(r)K(s)Z
|ξ′|=1Z
|ξ|=1Z
Ω(u(x+sξ′)−u(x))(u(x+rξ)−u(x))dxdξdξ′
=Z∞
0Z∞
0K(r)K(s)Z
Ωg[u](r, x)g[u](s, x)dxdrds
=Z∞
0Z∞
0K(r)K(s)Gu(r, s)drds.
Meanwhile, by the Riesz representation theorem, there exists a function Ku,f∈L2(0,∞)such that
Z∞
−∞K(|r|)Z
Ω(u(x+r)−u(x))f(x)dxdr
=Z∞
0K(r)Z
|ξ|=1Z
Ω(u(x+r)−u(x))f(x)dxdξdr
=Z∞
0K(r)Z
Ωg[u](r, x)f(x)dxdr =Z∞
0K(r)Ku,f(r)dr.
Combining these two equations, we can write the loss function as
E(K) =Z
ΩZ∞
−∞K(|s|)(u(x+s)−u(x))ds−f(x)2
dx
=Z∞
−∞Z∞
−∞K(|s|)K(|r|)Z
Ω(u(x+s)−u(x))(u(x+r)−u(x))dxdrds
−Z∞
−∞K(|s|)Z
Ω(u(x+s)−u(x))f(x)dxds +Const.
=Z∞
0Z∞
0K(r)K(s)Gu(r, s)drds−2Z∞
0K(r)Ku,f(r)dr+Const..
Then, we can write the regularized loss function Eλ,W(K)as
Eλ,W(K) =Z∞
0Z∞
0K(r)K(s)[Gu(r, s) +λW(r, s)]drds−2Z∞
0K(r)Ku,f(r)dr+Const.
=⟨(LGu+λLW)K, K⟩L2(0,∞)−2⟨K, Ku,f⟩L2(0,∞)+Const.
Selecting the optimal hyper-parameter λ∗, which depends on both (u, f)andW, and setting the
Fréchet derivative of Eλ,WoverL2(0,∞)to be zero, we obtain the regularized estimator in ( 26).
C Data generation and additional discussion
C.1 Example 1: radial kernel learning
In all settings except the “single task” one, all kernels act on the same set of functions {ui}i=1,2
withu1= cos( x)1[−π,π](x)andu2(x) = sin(2 x)1[−π,π](x). In the “single task” setting, to create
more diverse samples, the single kernel acts on a set of 14 functions: uk= cos( kx)1[−π,π](x),
k= 1,· · ·,7anduk(x) = sin( kx)1[−π,π](x),k= 8,· · ·,14. In the ground-truth model, the
integral Lγη[ui]is computed by the adaptive Gauss-Kronrod quadrature method, which is much
more accurate than the Riemann sum integrator that we use in the learning stage. To create discrete
datasets with different resolutions, for each ∆x∈0.0125× {1,2}, we take values {ui, fi}N
i=1=
200 1 2 3 4 5 6 7|x-y|00.20.40.60.8K(|x-y|)Ground-truth out-of-distribution test1 kernel
NAO (sin only): kernel error =12.16%
NAO (sin+cos+poly): kernel error =6.92%
NAO (sin+cos+poly, less samples): kernel error =24.04%
0 1 2 3 4 5 6 7|x-y|00.511.5K(|x-y|)Ground-truth out-of-distribution test2 kernel
VAE (sin+cos+poly): kernel error=128.08%
NAO (sin+cos+poly, less parameter): kernel error =94.38%
NAO (sin+cos+poly): kernel error =10.48%
NAO (sin+cos+poly, less sample): kernel error =25.58%Figure 5: OOD test results on radial kernel learning, with diverse training tasks and d= 302 .
OOD1 (left): true kernel γ(r) =r(11−r) exp( −5r) sin(6 r)1[0,11](r); OOD2 (right): true kernel
γ(r) =exp(−0.5r2)√
2π, a Gaussian kernel which is very different from all training tasks.
{ui(xj), fi(xj) :xj∈[−40,40], j= 1, . . . , J }N
i=1, where xjis the grid point on the uniform mesh
of size ∆x. We form a training sample of each task by taking dpairs from this task. When taking
the token size dandkfunction pairs, each task contains ⌊2265
d⌋ ×ksamples.
More diverse tasks. To further evaluate the generalization capability of NAO as a foundation model,
we add another two types of kernels into the training dataset. The training dataset is now constructed
based on 21 kernels of three groups, with 15samples on each kernel:
•sine-type kernels: γsin
η(r) = exp( −ηr) sin(6 r)1[0,11](r),η= 1,2,3,4,6,7,8.
•cosine-type kernels: γcos
η(r) =10−r
20cos(ηr)(10−r)1[0,10](r),η= 0,1,2,3,4,5,6.
•polynomial-type kernels: γpoly
η(r) = exp( −0.1r)pη r−10
10
1[0,10](r),η =
1,2,3,4,5,6,7, where pηis the degree- ηLegendre polynomial.
Based on this enriched dataset, besides the original “sine only” setting, three additional settings
are considered to compare the generalizability across different settings. The results are reported in
Table 4and Figure 5. In addition to the original setting corresponding to all “sine” kernels, in part
II of Table 4(denoted as “sine+cosine+polyn”), we consider a “diverse task” setting, where all 315
samples are employed in training. In part III, we consider a “single task” setting, where only the
ﬁrst sine-type kernel, γ(r) = exp( −r) sin(6 r)1[0,11](r), is considered as the training task, with 105
samples on this task. Lastly, in part IV we demonstrate a “fewer samples” setting, where the training
dataset still consists of all 21tasks but with only 5samples on each task. For testing, besides the ID
and OOD tasks in the ablation study, we add an additional OOD task with a Gaussian-type kernel
γood2(r) =exp(−0.5r2)√
2π, which is substantially different from all training tasks.
As shown in Table 4, considering diverse datasets helps in both OOD tests (the kernel error is
reduced from 9.14% to6.92% in OOD test 1, and from 329.66% to10.48% in OOD test 2), but
not for the ID test (the kernel error is slightly increased from 4.03% to5.04%). We also note that
since the “sine only” setting only sees systems with the same kernel frequency in training, it does
not generalize to OOD test 2, where it becomes necessary to include more diverse training tasks. As
the training tasks become more diverse, the intrinsic dimension of kernel space increases, requiring
a larger rank size dkof the weight matrices. When comparing the “fewer samples” setting with the
“sine only” setting, the former exhibits better task diversity but fewer samples per task. One can
see that the performance deteriorates on the ID test but improves on OOD test 2. This observation
emphasizes the balance between the diversity of tasks and the number of training samples per task.
C.2 Example 2: solution operator learning
For one example, we generate the synthetic data based on the Darcy ﬂow in a square domain of size
1×1subjected to Dirichlet boundary conditions. The problem setting is: −∇(b(x)∇p(x)) = g(x)
subjected to p(x) = 0 on all boundaries. This equation describes the diffusion in heterogeneous
ﬁelds, such as the subsurface ﬂow of underground water in porous media. The heterogeneity is
represented by the location-dependent conductivity b(x).p(x)is the source term, and the hydraulic
21Table 4: Training and test for the radial kernel problem with more diverse tasks with ﬁxed d=
302, where bold numbers highlight the best methods across different data settings. These results
emphasize the balance between task diversity and the number of samples per task.
dk model #param Operator test error Kernel test error
ID OOD1 OOD2 ID OOD1 OOD2
sine only: Train on sine dataset, 105 samples in total
10 Discrete-NAO 16526 1.33% 25.81% 138.00% 29.02% 28.80% 97.14%
NAO 18843 1.48% 8.10% 221.04% 5.40% 10.02% 420.60%
20 Discrete-NAO 28645 1.35% 18.70% 99.50% 35.49% 30.81% 101.08%
NAO 30963 1.33% 9.12% 211.78% 4.63% 9.14% 329.66%
40 Discrete-NAO 52886 1.30% 31.37% 49.83% 38.89% 30.02% 129.84%
NAO 55203 0.67% 7.34% 234.43% 4.03% 12.16% 1062.3%
Autoencoder 16424 12.97% 1041.49% 698.72% 22.56% 136.79% 304.37%
sine+cosine+polyn: Train on diverse (sine, cosine and polynomial) dataset, 315 samples in total
10 Discrete-NAO 16526 2.27% 13.02% 11.50% 10.41% 30.79% 77.80%
NAO 18843 2.34% 14.37% 10.05% 7.26% 28.23% 94.38%
20 Discrete-NAO 28645 1.60% 6.03% 19.73% 21.83% 21.29% 18.97%
NAO 30963 1.64% 3.25% 3.58% 5.45% 8.87% 15.82%
40 Discrete-NAO 52886 1.45% 5.49% 18.26% 20.07% 19.46% 18.44%
NAO 55203 1.54% 3.09% 7.69% 5.04% 6.92% 10.48%
Autoencoder 56486 12.67% 341.96% 211.61% 27.06% 52.43% 128.08%
Single task: Train on a single sine dataset, 105 samples in total
10 NAO 18843 104.49% 104.37% 56.64% 100.31% 100.00% 94.98%
20 NAO 30963 116.89% 105.52% 85.40% 99.02% 99.55% 98.37%
40 NAO 55203 111.33% 104.12% 76.78% 101.61% 100.33% 95.90%
Fewer samples: Train on diverse (sine, cosine and polynomial) dataset, 105 samples in total
10 NAO 18843 4.23% 15.34% 11.13% 10.11% 25.23% 97.63%
20 NAO 30963 4.15% 10.15% 9.59% 8.84% 23.08% 20.05%
40 NAO 55203 3.69% 11.67% 6.08% 9.19% 24.04% 25.58%
height g(x)is the solution. For each data instance, we solve the equation on a 21×21grid using an
in-house ﬁnite difference code. We consider 500 random microstructures consisting of two distinct
phases. For each microstructure, the square domain is randomly divided into two subdomains with
different conductivity of either 12 or 3. Additionally, we consider 100 different g(x)functions ob-
tained via a Gaussian random ﬁeld generator. For each microstructure, we solve the Darcy problem
considering all 100 source terms, resulting in a dataset of N= 10 ,000function pairs in the form
of{pi(xj), gi(xj)}N
i=1, and j= 1,2,· · ·,441where xj’s are the discretization points on the square
domain.
In operator learning settings, we note that the permutation of function pairs in each sample should
not change the learned kernel, i.e., one should have K[u1:d,f1:d] =K[uσ(1:d),fσ(1:d)], where σis
the permutation operator. Hence, we augment the training dataset by permuting the function pairs
in each task. Speciﬁcally, with 100microstructures (tasks) and 100function pairs per task, we
randomly permut the function pairs and take 100function pairs for 100times per task. As a result,
we can generate a total of 10000 samples (9000 for training and 1000 for testing) in the form of
{uη
1:100,fη
1:100}10000
η=1.
C.3 Example 3: heterogeneous material learning
In the Mechanical MNIST dataset, we generate a large set of heterogeneous material responses
subjected to mechanical forces. This is similar to the approach in Lejeune [2020 ]. The material
property (stiffness) of the heterogeneous medium is constructed assuming a linear scaling between
1 and 100, according to the gray-scale bitmap of the MNIST images, which results in a set of 2D
square domains with properties that vary according to MNIST digit patterns. The problem setting
for this data set is the equilibrium equation: −∇ · P(x) = f(x)subjected to Dirichlet boundary
condition of zero displacement and nonzero variable external forces: f(x).P(x) = ˆP(I+∇u(x))
is the stress tensor and is a nonlinear function of displacement u(x). The choice of material models
determines the stress function, and here we employ the Neo-Hookean material model as in Lejeune
22[2020 ]. From MNIST, we took 50 samples of each digit resulting in a total of 500 microstructures.
We consider 200 different external forces f(x)obtained via a Gaussian random ﬁeld, and solve
the problem for each pair of microstructure and external force, resulting in N= 100 ,000samples.
To solve each sample, we use FEniCS ﬁnite element package considering a 140×140uniform
mesh. We then downsample from the ﬁnite element nodes to get values for the solution u(x)and
external force f(x)on a the coarser 29×29equi-spaced grid. The resulting dataset is of the form:
{ui(xj), fi(xj)}N
i=1, and j= 1,2, ...,841where xj’s are the equi-spaced sampled spatial points.
Similar to Example 2, we perform the permutation trick to augment the training data. In particular,
with 500microstructures (tasks) and 200function pairs per task, we randomly permute the function
pairs and take 100function pairs for 100times per task. As a result, we can generate a total of 50000
samples, where 45000 are used for training and 5000 for testing.
D Computational complexity
Denote (N, d, d k, L, n train )as the size of the spatial mesh, the number of data pairs in each training
model, the column width of the query/key weight matrices WQandWK, the number of layers, and
the number of training models. The number of trainable parameters in a discrete NAO is of size
O(L×d×dk+N2). For continuous-kernel NAO, taking a three-layer MLP as a dense net of size
(d, h 1, h2,1)for the trainable kernels WP,uandWP,ffor example, its the corresponding number of
trainable parameters is O(d×h1+h1×h2). Thus, the total number of trainable parameters for a
continuous-kernel NAO is O(L×d×dk+d×h1+h1×h2).
The computational complexity of NAO is quadratic in the length of the input and linear in the
data size, with O([d2(3N+dk) + 6 N2d]Lntrain )ﬂops in each epoch in the optimization. It is
computed as follows for each layer and the data of each training model: the attention function takes
O(d2dk+ 2Nd2+ 4N2d)ﬂops, and the kernel map takes O(d2dk+Nd2+ 2N2d)ﬂops; thus, the
total is O(d2(3N+dk) + 6 N2d)ﬂops. In inverse PDE problems, we generally have d≪N, and
hence the complexity of NAO is O(N2d)per layer per sample.
Compared with other methods, it is important to note that NAO solves both forward and ill-posed
inverse problems using multi-model data. Thus, we don’t compare it with methods that solve the
problems for a single model data, for instance, the regularized estimator in Appendix B. Methods
solving similar problems are the original attention model [ Vaswani et al. ,2017 ], convolution neural
network (CNN), and graph neural network (GNN). As discussed in Vaswani et al. [2017 ], these
models have a similar computational complexity, if not any higher. In particular, the complexity of
the original attention model is O(N2d), and the complexity of CNN is O(kNd2)withkbeing the
kernel size, and a full GNN is of complexity O(N2d2).
23NeurIPS Paper Checklist
1.Claims
Question: Do the main claims made in the abstract and introduction accurately reﬂect the
paper’s contributions and scope?
Answer: [Yes]
Justiﬁcation: We have clearly stated our claims in the abstract and introduction, includ-
ing the key contributions that our proposed model NAO provides a novel input-dependent
kernel for context extraction, integrates forward and inverse PDE predictions in one frame-
work, and offers the capability in solving ill-posed inverse PDE problems.
2.Limitations
Question: Does the paper discuss the limitations of the work performed by the authors?
Answer: [Yes]
Justiﬁcation: The limitations of the work is discussed in the Conclusion section.
3.Theory Assumptions and Proofs
Question: For each theoretical result, does the paper provide the full set of assumptions and
a complete (and correct) proof?
Answer: [Yes]
Justiﬁcation: We have provided the full set of assumptions and corresponding complete
proofs under each proposed Lemma with detailed derivations included in the Appendix A
and B.
4.Experimental Result Reproducibility
Question: Does the paper fully disclose all the information needed to reproduce the main
experimental results of the paper to the extent that it affects the main claims and/or conclu-
sions of the paper (regardless of whether the code and data are provided or not)?
Answer: [Yes]
Justiﬁcation: We have elaborated the detailed architectures of the proposed model in the
main body of the paper as well as data generation details in Appendix C. The code and
accompanying data have been released at https://github.com/fishmoon1234/NAO .
5.Open access to data and code
Question: Does the paper provide open access to the data and code, with sufﬁcient instruc-
tions to faithfully reproduce the main experimental results, as described in supplemental
material?
Answer: [Yes]
Justiﬁcation: The code and accompanying data have been released at https://github.
com/fishmoon1234/NAO .
6.Experimental Setting/Details
Question: Does the paper specify all the training and test details (e.g., data splits, hyper-
parameters, how they were chosen, type of optimizer, etc.) necessary to understand the
results?
Answer: [Yes]
Justiﬁcation: We brieﬂy state the training and test strategies at the beginning of the Experi-
ments section, with the full details provided in Appendix C.
7.Experiment Statistical Signiﬁcance
Question: Does the paper report error bars suitably and correctly deﬁned or other appropri-
ate information about the statistical signiﬁcance of the experiments?
Answer: [No]
Justiﬁcation: Error bars are not reported due to the limited computational resource. Nev-
ertheless, we have tuned the hyperparameters of all the considered models and reported
extensive results in a large variety of settings, and they all support our claim.
248.Experiments Compute Resources
Question: For each experiment, does the paper provide sufﬁcient information on the com-
puter resources (type of compute workers, memory, time of execution) needed to reproduce
the experiments?
Answer: [Yes]
Justiﬁcation: The computing resources are reported in the ﬁrst paragraph of the Exper-
iments section. In particular, all the experiments are conducted on a single NVIDIA
GeForce RTX 3090 GPU with 24 GB memory.
9.Code Of Ethics
Question: Does the research conducted in the paper conform, in every respect, with the
NeurIPS Code of Ethics https://neurips.cc/public/EthicsGuidelines ?
Answer: [Yes]
Justiﬁcation: The research conducted in the paper conform with the NeurIPS Code of
Ethics.
10.Broader Impacts
Question: Does the paper discuss both potential positive societal impacts and negative
societal impacts of the work performed?
Answer: [Yes]
Justiﬁcation: The discussion on the societal impacts can be found in the Conclusion section.
11.Safeguards
Question: Does the paper describe safeguards that have been put in place for responsible
release of data or models that have a high risk for misuse (e.g., pretrained language models,
image generators, or scraped datasets)?
Answer: [NA]
Justiﬁcation: The paper poses no such risks.
12.Licenses for existing assets
Question: Are the creators or original owners of assets (e.g., code, data, models), used in
the paper, properly credited and are the license and terms of use explicitly mentioned and
properly respected?
Answer: [Yes]
Justiﬁcation: We have cited the original papers that produced the code package or dataset
where appropriate.
13.New Assets
Question: Are new assets introduced in the paper well documented and is the documenta-
tion provided alongside the assets?
Answer: [Yes]
Justiﬁcation: The code and accompanying data have been released at https://github.
com/fishmoon1234/NAO , with instructions and pretrained models provided.
14.Crowdsourcing and Research with Human Subjects
Question: For crowdsourcing experiments and research with human subjects, does the pa-
per include the full text of instructions given to participants and screenshots, if applicable,
as well as details about compensation (if any)?
Answer: [NA]
Justiﬁcation: The paper does not involve crowdsourcing nor research with human subjects.
15.Institutional Review Board (IRB) Approvals or Equivalent for Research with Human
Subjects
Question: Does the paper describe potential risks incurred by study participants, whether
such risks were disclosed to the subjects, and whether Institutional Review Board (IRB)
approvals (or an equivalent approval/review based on the requirements of your country or
institution) were obtained?
25Answer: [NA]
Justiﬁcation: The paper does not involve crowdsourcing nor research with human subjects.
26