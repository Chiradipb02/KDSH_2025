Under review as submission to TMLR
Application of Referenced Thermodynamic Integration to
Bayesian Model Selection
Anonymous authors
Paper under double-blind review
Abstract
Evaluating normalising constants is important across a range of topics in statistical learning,
notably Bayesian model selection. However, in many realistic problems this involves the in-
tegration of analytically intractable, high-dimensional distributions, and therefore requires
the use of stochastic methods such as thermodynamic integration (TI). In this paper we
apply a simple but under-appreciated variation of the TI method, here referred to as refer-
enced TI , which computes a single model’s normalising constant in an efficient way by using
a judiciously chosen reference density. The advantages of the approach and theoretical con-
siderations are set out, along with pedagogical 1 and 2D examples. The approach is shown
to be useful in practice when applied to a real problem — to perform model selection for
a semi-mechanistic hierarchical Bayesian model of COVID-19 transmission in South Korea
involving the integration of a 200D density.
1 Introduction
The marginalised likelihood, or normalising constant of a model, is a feature central to the principles and
pathology of Bayesian statistics. For example — given two models representing two competing hypotheses,
the ratio of the normalising constants (known as the Bayes factor), describes the relative probability of the
data having been generated by one hypothesis compared to the other. Consequently, at a practical level the
estimation of normalising constants is an important topic for model selection in the Bayesian setting (Kass
& Raftery, 1995).
In practice, estimating a normalising constant relies on ’integrating out’ or marginalising the parameters
of the model to get the probability the associated hypothesis produced the data. But in general this is
difficult, becausewecannoteasilyintegratearbitraryhigh-dimensionaldistributions—certainlyanalyticalor
quadrature-based methods are of little help directly. As a result, practitioners turn to a range of approaches,
typically based on statistical sampling. Specific examples include bridge sampling (Bennett, 1976; Meng &
Wong, 1996), stochastic density of states based methods (Skilling, 2006; Habeck, 2012) and thermodynamic
integration (Kirkwood, 1935; Gelman & Meng, 1998; Lartillot & Philippe, 2006; Friel et al., 2017). This
work focuses on the latter — thermodynamic integration — in particular on the development of the practical
details for efficient application for Bayesian model selection.
By way of introduction for researchers unfamiliar with thermodynamic integration (TI), it allows us to
estimate the ratio of two normalising constants in a general and asymptotically exact way. Instead of
marginalising the associated densities explicitly in terms of the high-dimensional integrals, using TI we only
have to evaluate a 1-dimensional integral, where the integrand can easily be sampled with Markov Chain
Monte Carlo (MCMC). To see how this works, consider two models labelled 1and 2with normalising
constantsz1andz2. Eachzis given by
zi=/integraldisplay
qi(θ)dθ, i∈{1,2}, (1)
whereqiis a density for model Miwith parameters θ, that gives the model’s Bayesian posterior density as
pi(θ) =qi(θ)
zi, i∈{1,2}.
1Under review as submission to TMLR
To apply thermodynamic integration we introduce the concept of a path between q1(θ)andq2(θ), linking the
two densities via a series of intermediate ones. This family of densities, parameterised by the path coordinate
λ, is denoted by q(λ;θ). An example path in λis shown in Fig. 1A.
The density q(λ;θ), linkingq1toq2and defining the intermediate densities, can be chosen to have an optimal
or in some way convenient path. A common choice based on convenience is the geometric one
q(λ;θ) =qλ
2(θ)q1−λ
1(θ), λ∈[0,1].
The important point to note is that for λ= 0,q(λ;θ)returns the first density q(0;θ) =q1(θ), forλ= 1it
givesq(1;θ) =q2(θ), and for in-between λvalues a log-linear mixture of the endpoint densities. Just as we
have defined a family of densities, there is an associated normalising constant for any point along the path,
that for any value of λis given by
z(λ) =/integraldisplay
Ω(λ)q(λ;θ)dθ.
A further small but important point to avoid complications is to have densities with common support, for
example Ω(λ= 1) = Ω(λ= 0). Hereafter support is denoted by Ω.
Having set up the definitions of q(λ;θ)andz(λ), the TI expression can be derived, to compute the log-ratio
ofz1=z(λ= 0)andz2=z(λ= 1), while avoiding explicit integrals over the models’ parameters θ. This is
laid out as follows:
logz2
z1=/integraldisplay1
0∂λlogz(λ)dλ
=/integraldisplay1
01
z(λ)∂λz(λ)dλ
=/integraldisplay1
01
z(λ)∂λ/integraldisplay
Ωq(λ;θ)dθdλ
=/integraldisplay1
01
z(λ)/integraldisplay
Ω(∂λlogq(λ;θ))q(λ;θ)dθdλ
=/integraldisplay1
0Ep(λ;θ)[∂λlogq(λ;θ)]dλ
=/integraldisplay1
0Ep(λ;θ)/bracketleftbigg
logq2(θ)
q1(θ)/bracketrightbigg
dλ
=/integraldisplay1
0Eq(λ;θ)/bracketleftbigg
logq2(θ)
q1(θ)/bracketrightbigg
dλ, (2)
Here we started with the fundamental theorem of calculus (first step), rules of differentiating logs (second
step), definition of z(λ)(third step), assumed exchangeability of ∂λand/integraltext
dθand log differentiation rules
again (fourth step), identifying the expectation Eq(λ;θ)from sampling distribution q(λ;θ)(fifth step), dif-
ferentiation of the geometric path for q(λ)(sixth step), and finally equivalence of sampling from qandp.
The final line in the expression summarises the usefulness of TI. Instead of having to work with the com-
plicated high-dimensional integrals of Equation 1 to find the log-Bayes factor logz2
z1, which measures the
relative probability of getting the data from one hypothesis compared to another, we only need to consider
a 1-dimensional integral of an expectation, and that expectation can be readily produced by MCMC.
In our paper we examine the details of a referenced TI approach, which is a variation on the TI theme that
we find useful to enable fast and accurate normalising constant calculations. Our main contributions are as
follows:
•We show how to generate a reference normalising constant from an exactly-integratable reference
density, through sampling or gradients, and with parameter constraints. And we present how to
use this reference in the TI method to efficiently estimate a normalising constant of an arbitrary
high-dimensional density.
2Under review as submission to TMLR
•We discuss performance benchmarks for a well-known problem in the statistical literature (Williams,
1959),whichshowsthemethodperformsfavourablyintermsofaccuracyandthenumberofiterations
to convergence.
•Finally the technique is applied to a hierarchical Bayesian time-series model describing the COVID-
19 epidemic in South Korea.
In relation to other work, we recognise using a reference for thermodynamic integration is a topic that has
beenraised, especiallyinearlytheoretically-orientedliterature(Neal,1993;Diciccioetal.,1997;Grosseetal.,
2013). Our additional contribution is to bridge the gap from theory and simple examples to application,
which includes choosing the reference using MCMC samples or gradients, examination of reference support,
comparisons of convergence, and illustration of the approach for a non-trivial real-world problem.
2 Referenced-TI
Introducing a reference density and associated normalising constant as
z=zrefz
zref
=zrefexp/integraldisplay1
0Eq(λ;θ)/bracketleftbigg
logq(θ)
qref(θ)/bracketrightbigg
dλ, (3)
yields an efficient approach to compute Bayes factors, or more generally to marginalise an arbitrary density
for any application. To clarify notation, here zis the normalising constant of interest with density q,
zrefis a reference normalising constant with associated density qref. In the second line the ratio z/zrefis
straightforwardly given by the thermodynamic integral identity in Equation 2.
While the Equation 2 can be directly applied to conduct a pairwise model comparison between two hypothe-
ses, byintroducingareferencewecannaturallymarginalisethedensityofasinglemodel(Neal,1993;Diciccio
et al., 1997). This is useful when comparing multiple models as n >/parenleftbign
2/parenrightbig
forn > 3. Another motivation
to reference the TI is the MCMC computational efficiency of converging the TI expectation. In Equation
3, with judicious choice of qref, the reference normalising constant zrefcan be evaluated analytically and
account for most of z. In this case logq(θ)
qref(θ)tends to have a small expectation and variance and converges
quickly.
This idea of using an exactly solvable reference, to aid in the solution of an otherwise intractable problem,
has been a recurrent theme in the computational and mathematical sciences in general (Dirac, 1927; Gell-
Mann & Brueckner, 1957; Vocadlo & Alfe, 2002; Duff et al., 2015), and variations on this approach have
been used to compute normalising constants in various guises in the statistical literature (Friel et al., 2017;
Lartillot & Philippe, 2006; Xie et al., 2010; Neal, 1993; Cameron & Pettitt, 2014; Friel & Pettitt, 2008; Friel
& Wyse, 2012; Lefebvre et al., 2010; Fan et al., 2011; Baele et al., 2016). For example, in the generalised
stepping stone method a reference is introduced to speed up convergence of the importance sampling at each
temperature rung (Fan et al., 2011; Baele et al., 2016). In the work of Lefebvre et al. (2010) a theoretical
discussion has been presented that shows the error budget of thermodynamic integration depends on the J-
divergence of the densities being marginalised. Noting this, Cameron & Pettitt (2014) provide an illustration
for a 2-dimensional example in their work on recursive pathways to marginal likelihood estimation. And in
the power posteriors method, a reference is used but the reference is a prior density and thus zref= 1(Friel
& Pettitt, 2008). This approach is elegant as the reference need not be chosen — it is simply the prior —
however the downside is that for poorly chosen or uninformative priors, the thermodynamic integral will be
slow to converge and susceptible to instability. In particular for complex hierarchical models with weakly
informative priors this is found to be an issue.
For referenced TI as presented here, the reference density in Equation 3 can be chosen at convenience, but
the main desirable features are that it should be easily formed without special consideration or adjustments
and thatzrefshould be analytically integratable and account for as much of zas possible. Such a choice
ofzrefensures the part with expensive sampling is small and converges quickly. An obvious choice in this
3Under review as submission to TMLR
regard is the Laplace-type reference, where the log-density is approximated with a second-order one, for
example a multivariate Gaussian. For densities with a single concentration, Laplace-type approximations
are ubiquitous, and an excellent natural choice for many problems. In the following section we consider
approaches that can be used to formulate a reference normalising constant zreffrom a second-order log-
density (though more generally other tractable references are possible). In each referenced TI scenario,
we note that even if the reference approximation is poor, the estimate of the normalising constant based
on Equation 3 remains asymptotically exact—only the speed of convergence is affected (subject to the
assumptions of matching support for end-point densities).
2.1 Taylor Expansion at the Mode Laplace Reference
The most straightforward way to generate a reference density is to Taylor expand the log-density to second
order about a mode. Noting no linear term is present, we see the reference density is
qref(θ) =exp/parenleftbigg
logq(θ0) +1
2(θ−θ0)TH(θ−θ0)/parenrightbigg
, (4)
where His the Hessian matrix and θ0is the vector of mode parameters. The associated normalising constant
is
zref=/integraldisplay∞
−∞qref(θ)dθ
=/integraldisplay∞
−∞exp/parenleftbigg
logq(θ0) +1
2(θ−θ0)TH(θ−θ0)/parenrightbigg
dθ
=q(θ0)/integraldisplay∞
−∞exp/parenleftbigg1
2(θ−θ0)TH(θ−θ0)/parenrightbigg
dθ
=q(θ0)/radicalbig
det(2πH−1). (5)
This approach to yield a reference density, using either analytic or finite difference gradients at mode, tends
to produce a density close to the true one in the neighbourhood of θ0. But this is far from guaranteed,
particularly if the density is asymmetric, or has non-negligible high-order moments, or is discontinuous for
example exhibiting cusps. In many instances a more reliable choice of reference can be found by using
MCMC samples from the whole posterior density.
2.2 Sampled Covariance Laplace Reference
A second straightforward approach to form a reference density, that’s often more robust, is by drawing
samples from the true density q(θ)to estimate the mean parameters ˆθand covariance matrix ˆΣ, such that
qref(θ) =q(ˆθ)exp/parenleftbigg
−1
2(θ−ˆθ)TˆΣ−1(θ−ˆθ)/parenrightbigg
(6)
Then the reference normalising constant is
zref=q(ˆθ)/radicalig
det(2πˆΣ). (7)
This method of generating a reference is simple and reliable. It requires sampling from the posterior q(θ)
so is more expensive than gradient-based methods, but the cost associated with drawing enough samples
to generate a sufficiently good reference tends to be quite low. In the primary application discussed later,
regarding structured high-dimensional Bayesian hierarchical models, we use this approach to generate a
reference density and normalising constant.
Though the sampled covariance reference is typically a good approach, it is not in general optimal within the
Laplace-type family of approaches — typically another Gaussian reference exists with different parameters
that can generate a normalising constant closer to the true one, thus potentially leading to overall faster
convergence of the thermodynamic integral to the exact value. Such an optimal reference can be identified
variationally, as we show in Section A.1.
4Under review as submission to TMLR
2.3 Reference Support
If a model involves a bounded parameter space, for example θ1∈[0,∞),θ2∈(−1,∞)etc. as commonly
arise in structured Bayesian models, in referenced TI the exact analytic integration for the reference density
should be commensurately limited. This is necessary not only so the reference is closer to the true density to
speed up convergence, but also so MCMC samples from both densities can be drawn on the same parameter
space, as is required for the thermodynamic integrand in Equation 3 to be well-defined. However, the
calculation of arbitrary probability density function orthants, even for well-known analytic functions such as
the multivariate Gaussian, is in general a difficult problem. High-dimensional orthant computations usually
require advanced techniques, the use of approximations, or sampling methods (Ridgway, 2016; Azzimonti &
Ginsbourger, 2018; Owen, 2014; Miwa et al., 2003; Curnow & Dunnett, 1962; Ruben, 1964). Fortunately,
we can simplify our reference density to create a reference with tractable analytic integration for limits by
using a diagonal approximation to the sampled covariance or Hessian matrix. For example the orthant of a
diagonal multivariate Gaussian can be given in terms of the error function (Brown, 1963),
zref=q(ˆθ)/radicalig
det(2πΣdiag)/productdisplay
i∈K
1 +erf
ˆθi−ai/radicalig
2Σdiag
i

, (8)
whereKdenotes the set of indices of the parameters with lower limits ai.Σdiagis a diagonal covariance
matrix, that is one containing only the variance of each of the parameters, without the covariance terms
andΣdiag
idenotes the ithelement of the diagonal. Restricting our density to a diagonal one is a poorer
approximation than using the full covariance matrix. In practice however this has not been a substantial
drawback to the convergence of the thermodynamic integral—and again we state that the quality of the
reference affects only convergence rather than eventual accuracy of the normalising constant. This behaviour
is observed in the practical examples later considered, though we do recognise the distinction between
accuracy and convergence and matters of asymptotic consistency using an MCMC estimator with finite
iterations are not clear cut.
2.4 Technical Implementation
ReferencedTIwasimplementedinPythonandStanprogramminglanguages. UsingStanenablesfastMCMC
simulations with Hamiltonian Monte Carlo and No-U-Turn algorithm (Hoffman & Gelman, 2014; Carpenter
et al., 2017), and portability between other statistical languages. We also provide an example of carrying out
referenced-TI in NumPyro (Phan et al., 2019). The code for all examples shown in this paper is available
at https://github.com/revealed-when-accepted. In the examples shown in Section 3, we used 4 chains with
20,000 iterations per chain for the pedagogical examples, and 4 chains with 2,000 iterations for the other
applications. In all cases, half of the iterations were used for the warm-up. Mixing of the chains and the
sampling convergence was checked in each case, by ensuring that the ˆRvalue was≤1.05and investigating
the trace plots.
In all examples, the integral given in Equation 2 was discretised to allow computer simulations. Each
expectation Eq(λ;θ)/bracketleftig
logq1(θ)
q0(θ)/bracketrightig
was evaluated at λ= 0.0,0.1,0.2,....,0.9,1.0, unless stated otherwise. To
obtain the value of the integral in Equation 2, we interpolated a curve linking the expectations using a cubic
spline, which was then integrated numerically. The pseudo-code of the algorithm with sampled covariance
Laplace reference is shown in Section A.2.
3 Applications
In this section we present applications of the referenced TI approach. In 3.1 and 3.2 we give 1- and 2-
dimensional pedagogical introductions to the approach. In 3.3 we select a linear regression model for a
well-known problem in the statistical literature, and finally in 3.4 we consider a challenging model selection
task for a structured Bayesian model of the COVID-19 epidemic in South Korea.
5Under review as submission to TMLR
/uni00000015 /uni00000016 /uni00000017 /uni00000018 /uni00000019
/uni00000013/uni00000011/uni00000013/uni00000013/uni00000011/uni00000016/uni00000013/uni00000011/uni00000019/uni00000013/uni00000011/uni0000001c/uni00000027/uni00000048/uni00000051/uni00000056/uni0000004c/uni00000057/uni0000005c/uni00000024/uni00000020/uni00000013
/uni00000020/uni00000013/uni00000011/uni00000015
/uni00000020/uni00000013/uni00000011/uni00000018
/uni00000020/uni00000013/uni00000011/uni0000001b
/uni00000020/uni00000014
/uni00000013 /uni00000018/uni00000013/uni00000013/uni00000013 /uni00000014/uni00000013/uni00000013/uni00000013/uni00000013 /uni00000014/uni00000018/uni00000013/uni00000013/uni00000013 /uni00000015/uni00000013/uni00000013/uni00000013/uni00000013
/uni0000002c/uni00000057/uni00000048/uni00000055/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000013/uni00000011/uni00000013/uni0000001b
/uni00000013/uni00000011/uni00000013/uni00000017
/uni00000013/uni00000011/uni00000013/uni00000013/uni00000028/uni0000005b/uni00000053/uni00000048/uni00000046/uni00000057/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000003/uni00000053/uni00000048/uni00000055/uni00000003
/uni00000025
/uni00000013/uni00000011/uni00000013 /uni00000013/uni00000011/uni00000015 /uni00000013/uni00000011/uni00000017 /uni00000013/uni00000011/uni00000019 /uni00000013/uni00000011/uni0000001b /uni00000014/uni00000011/uni00000013
/uni00000013/uni00000011/uni00000013/uni00000019
/uni00000013/uni00000011/uni00000013/uni00000017
/uni00000013/uni00000011/uni00000013/uni00000015
/uni00000028/uni0000005b/uni00000053/uni00000048/uni00000046/uni00000057/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000003/uni00000053/uni00000048/uni00000055/uni00000003
/uni00000026
/uni00000013/uni00000011/uni00000017/uni00000015/uni00000013/uni00000011/uni00000017/uni00000016/uni00000013/uni00000011/uni00000017/uni00000017
/uni0000002f/uni00000052/uni0000004a/uni00000010/uni00000048/uni00000059/uni0000004c/uni00000047/uni00000048/uni00000051/uni00000046/uni00000048log(zref)
log(z)
/uni00000013 /uni00000018/uni00000013/uni00000013/uni00000013 /uni00000014/uni00000013/uni00000013/uni00000013/uni00000013 /uni00000014/uni00000018/uni00000013/uni00000013/uni00000013 /uni00000015/uni00000013/uni00000013/uni00000013/uni00000013
/uni0000002c/uni00000057/uni00000048/uni00000055/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000014/uni00000011/uni00000018/uni00000013/uni00000014/uni00000011/uni00000018/uni00000015/uni00000014/uni00000011/uni00000018/uni00000017/uni00000014/uni00000011/uni00000018/uni00000019/uni00000028/uni00000059/uni0000004c/uni00000047/uni00000048/uni00000051/uni00000046/uni00000048/uni00000027 zref
/uni0000005d
zTIz±1%
z±0.1%
Figure 1: A) qλq(1−λ)
reffor the 1d example density in parameter θ(Equation 9) at selected λvalues along
the path. B) Expectation Eq(λ;θ)/bracketleftig
logq(θ)
qref(θ)/bracketrightig
vs MCMC iteration, shown at each value of λsampled. C)
λ-dependence of Eq(λ;θ)/bracketleftig
logq(θ)
qref(θ)/bracketrightig
, the TI contribution to the log-evidence. D) Convergence of the evidence
z, with 1% convergence after 500iterations and 0.1% after 17,000iterations per λ.
3.1 1D Pedagogical Example
To illustrate the technique we consider the 1-dimensional density
q(θ) =exp/parenleftbigg
−1
2/radicalbig
|θ−4|−1
2(θ−4)4/parenrightbigg
,θ∈R, (9)
with normalising constant z=/integraltext∞
−∞q(θ)dθ. This density has a cusp and it does not have an analytical
integral that easily generalises to multiple dimensions.
In this instance the Laplace approximation based on the second-order Taylor expansion at the mode will
fail due to the cusp, so we use the more robust covariance sampling method. Sampling from the 1D density
q(θ)we find a variance of ˆσ2= 0.424, giving a Gaussian reference density qref(θ)with normalising constant
ofzref= 1.559. The full normalising constant, z=zrefz
zref, is evaluated by Equation 3, by setting up
a thermodynamic integration along the sampling path qλq(1−λ)
ref. The expectation, Eq(λ;θ)/bracketleftig
logq(θ)
qref(θ)/bracketrightig
, is
evaluated at 5points along the coupling parameter path λ= 0.0,0.2,0.5,0.8,1.0, shown in Fig. 1. In this
simple example, the integral can be easily evaluated to high accuracy using quadrature (Piessens et al., 1983;
Virtanen et al., 2020), giving a value of 1.523. Referenced TI reproduces this value, with convergence of z
shown in Fig. 1, converging to 1% ofzwith 500iterations and 0.1% within 17,000iterations.
This example illustrates notable characteristic features of referenced TI. Here the reference qref(θ)is a good
approximation to q(θ), withzrefaccounting for most of z(zref=1.02z). Consequentlyz
zrefis close to 1,
and the expectations, Eq(λ;θ)/bracketleftig
logq(θ)
qref(θ)/bracketrightig
, evaluated by MCMC for the remaining part of the integral are
small. For the same reasons the variance at each λis small, leading to favourable convergence within a small
number of iterations. And finally Eq(λ;θ)/bracketleftig
logq(θ)
qref(θ)/bracketrightig
weakly depends on λ, so there is no need to use a very
fine grid of λvalues or consider optimal paths—satisfactory convergence is easily achieved using a simple
geometric path with 4 λ-intervals.
3.2 2D Pedagogical Example with Constrained Parameters
As a second example, consider a 2-dimensional unnormalised density function with a constrained parameter
space:
q(θ1, θ2) =exp(−Θ), (10)
with
Θ =1
4/summationdisplay
i,j∈{1,2}/parenleftbigg
θi+1
2/parenrightbigg2j
+1
8θ1θ2
2, (11)
and
θ1∈[0,+∞)andθ2∈(−∞,+∞).
6Under review as submission to TMLR
/uni00000010/uni00000015 /uni00000013 /uni00000015
1
/uni00000010/uni00000015/uni00000013/uni000000152
q()
/uni00000010/uni00000015 /uni00000013 /uni00000015
1
/uni00000010/uni00000015/uni00000013/uni00000015qref()/uni0000000f/uni00000003/uni00000049/uni00000058/uni0000004f/uni0000004f/uni00000003/uni00000046/uni00000052/uni00000059/uni00000044/uni00000055/uni0000004c/uni00000044/uni00000051/uni00000046/uni00000048
/uni00000010/uni00000015 /uni00000013 /uni00000015
1
/uni00000010/uni00000015/uni00000013/uni00000015qref()/uni0000000f/uni00000003/uni00000047/uni0000004c/uni00000044/uni0000004a/uni00000052/uni00000051/uni00000044/uni0000004f/uni00000003/uni00000046/uni00000052/uni00000059/uni00000044/uni00000055/uni0000004c/uni00000044/uni00000051/uni00000046/uni00000048
/uni00000013/uni00000011/uni00000013/uni00000013/uni00000011/uni00000018/uni00000014/uni00000011/uni00000013
/uni00000013/uni00000011/uni00000013/uni00000013/uni00000011/uni00000018/uni00000014/uni00000011/uni00000013
/uni00000013/uni00000011/uni00000013/uni00000013/uni00000011/uni00000018/uni00000014/uni00000011/uni00000013
Figure 2: Contour plots of the un-normalised density qand its two reference densities qref, one using a full
covariance matrix and another using a diagonal covariance matrix that can be easily marginalised. The red
line shows the lower boundary θ1= 0and the shaded θ1<0region to the left of the line is outside of the
support of the density q.
A reference density qref(θ)can be constructed from the Hessian at the mode of q(θ). To marginalise it on
a parameter space with restricted support, we use a reference density qdiag
ref(θ)based on a diagonal Hessian,
that has an exact and easy to calculate orthant. All densities are shown in Fig. 2.
To obtain the log-evidence of the model, we calculated the exact value numerically (Piessens et al., 1983;
Virtanen et al., 2020), and using a sampled diagonal covariance matrix, as per Equation 8, to account for the
lower bound of the parameter θ1. Without this restriction the final normalising constant is overestimated
– if the support of the parameters in the MCMC isn’t the same as for the analytic zrefcalculation, zrefas
shown in Equation 3 doesn’t cancel with the TI reference. Numerical comparison of the referenced TI to
quadrature is presented in Table 2 in the Appendix.
3.3 Benchmarks— Radiata Pine
To benchmark the application of the referenced TI in the model selection task, two non-nested linear re-
gression models are compared for the radiata pine data set (Williams, 1959). This example has been widely
used for testing normalising constant calculating methods, since in this instance the exact value of the model
evidence can be computed. The data consists of 42 3-dimensional data-points, expressed as yi- maximum
compression strength, xi- density and zi- density adjusted for resin content. In this example, we follow the
approach of Friel & Wyse (2012), using the priors from therein, and test which of the two models M1and
M2provides better predictions for the compression strength:
M1:yi=α+β(xi−¯x) +ϵi,ϵi∼N(0,τ−1),i= 1,...,n,
M2:yi=γ+δ(zi−¯z) +ηi,ηi∼N(0,ρ−1),i= 1,...,n.
Five methods of estimating the model evidence were used in this example: Laplace approximation us-
ing a sampled covariance matrix, model switch TI along a path directly connecting the models (Lartillot
& Philippe, 2006; Vitoratou & Ntzoufras, 2017), referenced TI, power posteriors with equidistant 11 λ-
placements (labelled here as PP 11) and power posteriors with 100 λ-s (PP 100), following the example from
Friel & Wyse (2012). For the model switch TI, referenced TI and PP 11we usedλ∈{0.0,0.1,...,1.0}.
The expectation from MCMC sampling per each λfor model switch TI, referenced TI, PP 11and PP 100and
fitted cubic splines between the expectations are shown in Fig. 5 in the Appendix. Both reference and model
switch TI methods eliminate the problem of divergence of expectation for λ= 0, which is observed with the
power posteriors, where samples for λ= 0come from the prior density function. And both reference and
model switch have smaller residuals for splines in λfitted to Eq(λ;θ)/bracketleftig
logq(θ)
qref(θ)/bracketrightig
than power posteriors.
For each approach, the splines fitted to Eq(λ;θ)/bracketleftig
logq(θ)
qref(θ)/bracketrightig
were integrated to obtain the log-evidence for
modelsM1andM2, and the log-ratio of the two models’ evidences for the model switch TI. The rolling
means of the integral over 1500 iterations for referenced TI and PP 100forM2are shown in Fig. 3A. We
7Under review as submission to TMLR
/uni00000013 /uni00000017/uni00000013/uni00000013 /uni0000001b/uni00000013/uni00000013 /uni00000014/uni00000015/uni00000013/uni00000013
/uni0000002c/uni00000057/uni00000048/uni00000055/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000016/uni00000013/uni00000014/uni00000011/uni0000001a/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000019/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000018/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000017/uni00000018
/uni0000002f/uni00000052/uni0000004a/uni00000010/uni00000048/uni00000059/uni0000004c/uni00000047/uni00000048/uni00000051/uni00000046/uni00000048/uni00000024 /uni00000055/uni00000048/uni00000049/uni00000003/uni00000037/uni0000002c/uni00000003M2
/uni00000033/uni00000033100/uni00000003M2
M2/uni00000003/uni00000048/uni0000005b/uni00000044/uni00000046/uni00000057
/uni0000002f/uni00000044/uni00000053/uni0000004f/uni00000044/uni00000046/uni00000048 /uni00000035/uni00000048/uni00000049/uni00000003/uni00000037/uni0000002c /uni00000033/uni00000033100
/uni00000024/uni00000053/uni00000053/uni00000055/uni00000052/uni0000005b/uni0000004c/uni00000050/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000003/uni00000050/uni00000048/uni00000057/uni0000004b/uni00000052/uni00000047/uni00000016/uni00000013/uni00000014/uni00000011/uni0000001a
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000019
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000017
/uni0000002f/uni00000052/uni0000004a/uni00000010/uni00000048/uni00000059/uni0000004c/uni00000047/uni00000048/uni00000051/uni00000046/uni00000048/uni00000025
Figure 3: The log-evidence of M2from the Radiata Pine benchmark problem is shown estimated using
three approaches. (A) shows the rolling mean of log-evidence of M2over 1500 iterations per λobtained by
referenced TI (blue line) and PP 100(orange line) methods. The exact value is shown with red dashed line.
(B) shows the mean log-evidence of the model M2evaluated over 15 runs of the three algorithms. The exact
value of the log-evidence is shown with the dotted line.
can see from the plot, that referenced TI presents favourable convergence to the exact value, whereas PP 100
oscillates around it. Fig. 3B shows the distribution of log-evidence for the same model generated by 15 runs
of the three algorithms: Laplace approximation with sampled covariance matrix, referenced TI and PP 100.
Similar figures for model M1are given in Fig. 6. Although all three methods resulted in a log-evidence
satisfactorily close to the exact solution, referenced TI was the most accurate and importantly, converged
fastest (308 MCMC draws compared to 55,000 draws needed for the power posterior method to achieve
standard error of 0.5%, excluding warm-up, see Table 3 in the Appendix).
3.4 Model Selection for the COVID-19 Epidemic in South Korea
The final example of using referenced TI for calculating model evidence is fitting a renewal
model to COVID-19 case data from South Korea. The data were obtained from open-
data.ecdc.europa.eu/covid19/casedistribution/csv. The model is based on a statistical representation of a
stochastic branching process whose expectation mechanistically follows a renewal-type equation. Its deriva-
tion and details are explained in Berah et al. (2021) and a short explanation of the model is provided in the
Section A.3.3. Briefly, the model is fitted to the time-series case data and estimates a number of parameters,
including serial interval and the effective reproduction number, Rt. The number of cases for each day are
modelled by a negative binomial likelihood, with location parameter estimated by a renewal equation. Three
modifications of the original model are tested here:
•variation of the infection generation interval for values GI= 5,6,7,8,9,10,20— whereGIdenotes
the mean of Rayleigh-distributed generation interval,
•changing the order of the autoregressive model for the reproduction number, for AR(k)withk=
2,3,4lags,
•varying the length of the sliding window for estimating the reproduction number for values in
W= 1,2,3,4,7days.
Within each group of models, GI,ARandW, we want to select the best model through the highest evidence
method. The dimension of each model was dependent on the modifications applied, but in all the cases the
normalising constant was a 40- to 200-dimensional integral. The log-evidence of each model was calculated
using the Laplace approximation with a sampled covariance matrix, and then correction to the estimate was
obtained using referenced TI method. Values of the log-evidence for each model calculated by both Laplace
and referenced TI methods are given in Table 1. Interestingly, the favoured model in each group, that is
the model with the highest log-evidence, was different when the evidence was evaluated using the Laplace
approximation than when it was evaluated with referenced TI. For example, using the Laplace method,
sliding window of length 7 was incorrectly identified as the best model, whereas with referenced TI window
8Under review as submission to TMLR
of length 2 was chosen to be the best among the tested sliding windows models, which agrees with the
previous studies of the window-length selection in H1N1 influenza and SARS outbreaks (Parag & Donnelly,
2020). This exposes how essential it is to accurately determine the evidence, even good approximations can
result in misleading results. Bayes factors for all model pairs are shown in Fig. 7 in the Appendix.
Table 1: Log-evidence estimated by Laplace and referenced TI approximations. In each section, model with
the highest log-evidence estimated by Laplace or referenced TI method is indicated in bold. The credible
intervals for log-evidence comes from calculating the quantiles of the integral from Equation 2, where the
integral values were obtained from the spline interpolated using running means of the expecations per λover
all iterations.
ModelLog-evidence
LaplaceLog-evidence
ref TI [95% CrI]
GI=5 -1274 -716 [-715.6, -715.2]
GI=6 -1274 -703 [-703.3, -702.7]
GI=7 -1255 -732 [-732.4, -731.8]
GI=8 -1245 -685[-685.5, -684.7]
GI=9 -1310 -803 [-802.8, -802.3]
GI=10 -1313 -805 [-805.1, -805.3]
GI=20 -1170 -796 [-796.3, -795.5]
AR(2) -1207 -711 [-711.2, -710.6]
AR(3) -1293 -704[-704.7, -703.7]
AR(4) -2166 -821 [-820.6, -819.2.]
W=1 -1260 -802 [-802.1, -801.6]
W=2 -1069 -791[-791.2, -790.7]
W=3 -1003 -807 [-807.5, -807.2]
W=4 -940 -811 [-811.1, -810.7]
W=7 -875 -814 [-813.7, -813.5]
3.5 Interpretation of the COVID-19 model selection
The importance of performing model selection in a rigorous way is clear from Fig. 4, where the generated Rt
time-series are plotted for the models favoured by Laplace and referenced TI methods (additional posterior
densities are shown in Fig. 8 in the Appendix). The differences in the Rttime-series show the pitfalls of
selecting an incorrect model. The differences between the two favoured models were most extreme for the
GI= 8andGI= 20models. While a GI= 8is plausible, even likely for COVID-19, GI= 20is implausible
given observed data (Bi et al., 2020). This is further supported by observing that for GI= 20, favoured
by the Laplace method, Rtreached the value of over 125 in the first peak—around 100 more than for the
GI= 8. The second peak was also largely overestimated, where Rtreached a value of 75.
We find it interesting to note that all models present a similar fit to the confirmed COVID-19 cases data
(see Fig. 9 in the Appendix). This makes it impossible to select the best model through visual inspection
and comparison of the model fits, or by using model selection methods that do not take the full posterior
distributions into account. Although the models might fit the data well, other quantities generated, which
are often of interest to the modeller, might be completely incorrect. Moreover, it emphasises the need to test
multiple models before any conclusion or inference is undertaken, especially with the complex, hierarchical
models.
Although often the Laplace approximation of the normalising constant is sufficient to pick the best model, it
was not the case in this epidemiological model selection problem. We can see in Table 1 that the evidence was
the highest for the "boundary" models when Laplace approximation was applied. For example, for the sliding
window length models, when the Gaussian approximation was applied, the log-evidence was monotonically
increasing with the value of Wwithin the range of values that seem reasonable ( W= 1to7). In contrast,
with referenced TI, the log-evidence geometry is concave within the range of a priorireasonable parameters.
9Under review as submission to TMLR
/uni00000013 /uni00000014/uni00000013/uni00000013 /uni00000015/uni00000013/uni00000013
/uni00000027/uni00000044/uni0000005c/uni00000056/uni00000013/uni00000014/uni00000013/uni00000015/uni00000013RtAR(3)
AR(2)
/uni00000013 /uni00000014/uni00000013/uni00000013 /uni00000015/uni00000013/uni00000013
/uni00000027/uni00000044/uni0000005c/uni00000056/uni00000013/uni00000014/uni00000013/uni00000015/uni00000013W=2
W=7
/uni00000013 /uni00000014/uni00000013/uni00000013 /uni00000015/uni00000013/uni00000013
/uni00000027/uni00000044/uni0000005c/uni00000056/uni00000013/uni00000017/uni00000013/uni0000001b/uni00000013/uni00000014/uni00000015/uni00000013 GI=8
GI=20
Figure 4: Time-dependent reproduction number generated by models with the highest evidence calculated
using the Laplace approximation (orange lines) and referenced TI (blue lines). Note, the fitting data in this
example contains superspreading events (which leads to very high values of Rton certain days) so is not
representative of SARS-CoV-2 transmission generally.
4 Discussion
The examples shown in Section 3 illustrate the applicability of the referenced TI approach for calculating
model evidence. In the radiata pine example, referenced TI performed better than the other tested methods
in terms of accuracy and speed. When using referenced TI, at λ= 0values are sampled from the reference
density rather than the prior as in the power posterior method, which should be closer to the original
density (in the sense of Kullback–Leibler or Jensen-Shannon divergence). This leads not only to a more
accurate estimate of the normalising constant, but also much faster convergence of the MCMC samples. A
detailed theoretical characterisation of rates of convergence is beyond the scope of this article, nonetheless
the empirical tests presented consistently show faster convergence than with comparative approaches. This is
useful especially for evaluating model evidence in complex hierarchical models where each MCMC iteration
is computationally demanding.
Although referenced thermodynamic integration and other methods using path-sampling have theoretical
asymptotically exact Monte Carlo estimator limits, in practice a number of considerations affect accuracy.
For example, biases will be introduced to the referenced TI estimate if one endpoint density substantially
differs from another. An example of this and explanation is included in Section A.4.
Furthermore, the discretisation of the coupling parameter path in λcan introduce a discretisation bias.
For the power posteriors method, Friel et al. (2017) propose an iterative way of selecting the λ-placements
to reduce the discretisation error. Calderhead & Girolami (2009) test multiple λ-placements for 2- and
20D regression models, and report relative bias for each tested scenario. In the referenced TI algorithm
discretisation bias is however negligible — the use of the reference density results in TI expectations that
are both small and have low variance, and therefore curvature with respect to λ. In our framework we
use geometric paths with equidistant coupling parameters λbetween the un-normalised posterior densities,
but there are other possible choices of the path constructions, for example a harmonic (Gelman & Meng,
1998) or hypergeometric path (Vitoratou & Ntzoufras, 2017). This optimisation might be worth exploring,
however, as illustrated in Fig. 3B, the expectations evaluated vs λare typically near-linear with referenced
TI suggesting limited gains, although the extent of this will differ from problem to problem.
In the application to the renewal model for the COVID-19 epidemic in South Korea, we showed that for a
complex structured model, hypothesis selection by Laplace approximation of the normalising constant can
give misleading results. Using referenced TI, we calculated model evidence for 16 models, which enabled
a quick comparison between chosen pairs of competing models. Importantly, the evidence given by the
referencedTIwasnotmonotonicwiththeincreaseofoneoftheparameters,whichwasthecasefortheLaplace
approximation. The referenced TI presented here will similarly be useful in other situations particularly
where the high-dimensional posterior distribution is uni-modal but non-Gaussian.
10Under review as submission to TMLR
5 Conclusions
Normalising constants are fundamental in Bayesian statistics. In this paper we give an account of referenced
thermodynamic integration (TI), in terms of theoretical consideration regarding the choice of reference,
and show how it can be applied to realistic practical problems. We show how referenced TI allows efficient
calculation of a single model’s evidence by sampling from geometric paths between the un-normalised density
of the model and a judiciously chosen reference density — here, a sampled multivariate normal that can be
generated and integrated with ease. Referenced TI method has practical utility for substantially challenging
problems of model selection in epidemiology and we suggest it has applicability in other fields of applied
machine learning that rely on high-dimensional Bayesian models.
References
Dario Azzimonti and David Ginsbourger. Estimating orthant probabilities of high-dimensional Gaussian
vectors with an application to set estimation. Journal of Computational and Graphical Statistics , 27(2):
255–267, 2018.
Guy Baele, Philippe Lemey, and Marc A Suchard. Genealogical Working Distributions for Bayesian Model
Testing with Phylogenetic Uncertainty. Systematic Biology , 65(2):250–264, 2016. doi: 10.1093/sys-
bio/syv083.
Charles H Bennett. Efficient estimation of free energy differences from Monte Carlo data. Journal of
Computational Physics , 22(2):245–268, 1976.
Tresnia Berah, Thomas A Mellan, Xenia Miscouridou, Swapnil Mishra, Kris V Parag, Mikko S Pakkanen,
and Samir Bhatt. Unifying the effective reproduction number, incidence, and prevalence under a stochastic
age-dependent branching process. arXiv preprint arXiv:2107.05579 , 2021.
Qifang Bi, Yongsheng Wu, Shujiang Mei, Chenfei Ye, Xuan Zou, Zhen Zhang, Xiaojian Liu, Lan Wei,
Shaun A Truelove, Tong Zhang, Wei Gao, Cong Cheng, Xiujuan Tang, Xiaoliang Wu, Yu Wu, Binbin
Sun, Suli Huang, Yu Sun, Juncen Zhang, Ting Ma, Justin Lessler, and Tiejian Feng. Epidemiology and
transmission of COVID-19 in 391 cases and 1286 of their close contacts in Shenzhen, China: a retrospective
cohort study. The Lancet Infectious Disease , 20:911–919, 2020. doi: doi: 10.1016/S1473-3099(20)30287-5.
Nikolai N. Bogolubov Jr. On model dynamical systems in statistical mechanics. Physica, 32(5):933–944,
1966.
M. Brown. A generalized error function in n dimensions. U.S. Naval Missile Center, Theorethical Analysis
Division, 1963. URL https://apps.dtic.mil/dtic/tr/fulltext/u2/401722.pdf .
Ben Calderhead and Mark Girolami. Estimating Bayes factors via thermodynamic integra-
tion and population MCMC. Computational Statistics & Data Analysis , 53(12):4028 –
4045, 2009. ISSN 0167-9473. doi: https://doi.org/10.1016/j.csda.2009.07.025. URL
http://www.sciencedirect.com/science/article/pii/S0167947309002722 .
Ewan Cameron and Anthony Pettitt. Recursive pathways to marginal likelihood estimation with prior-
sensitivity analysis. Statistical Science , 29(3):397–419, 2014.
Bob Carpenter, Andrew Gelman, Matthew Hoffman, Daniel Lee, Ben Goodrich, Michael Betancourt, Marcus
Brubaker, Jiqiang Guo, Peter Li, and Allen Riddell. Stan: A Probabilistic Programming Language.
Journal of Statistical Software, Articles , 76(1):1–32, 2017. ISSN 1548-7660. doi: 10.18637/jss.v076.i01.
URL https://www.jstatsoft.org/v076/i01 .
Robert N. Curnow and Charles W. Dunnett. The numerical evaluation of certain multivariate normal
integrals. The Annals of Mathematical Statistics , pp. 571–579, 1962.
Thomas J. Diciccio, Robert E. Kass, Adrian Raftery, and Larry Wasserman. Computing Bayes Factors by
Combining Simulation and Asymptotic Approximations. Journal of the American Statistical Association ,
92(439):903–915, 1997. doi: 10.1080/01621459.1997.10474045.
11Under review as submission to TMLR
Paul Adrien Maurice Dirac. The quantum theory of the emission and absorption of radiation. Proceedings
of the Royal Society of London. Series A, Containing Papers of a Mathematical and Physical Character ,
114(767):243–265, 1927.
Andrew Ian Duff, Theresa Davey, Dominique Korbmacher, Albert Glensk, Blazej Grabowski, Jörg Neuge-
bauer, and Michael W Finnis. Improved method of calculating ab initio high-temperature thermodynamic
properties with application to ZrC. Physical Review B , 91(21):214311, 2015.
Yu Fan, Rui Wu, Ming-Hui Chen, Lynn Kuo, and Paul O Lewis. Choosing among partition models
in Bayesian phylogenetics. Molecular Biology and Evolution , 28(1):523–532, 2011. doi: 10.1093/mol-
bev/msq224.
Nial Friel and Anthony N. Pettitt. Marginal likelihood estimation via power posteriors. Journal of the
Royal Statistical Society: Series B (Statistical Methodology) , 70(3):589–607, 2008. doi: 10.1111/j.1467-
9868.2007.00650.x.
Nial Friel and Jason Wyse. Estimating the evidence: a review. Statistica Neerlandica , 66(3):288–308, 2012.
doi: 10.1111/j.1467-9574.2011.00515.x.
Nial Friel, Merrilee Hurn, and Jason Wyse. Improving power posterior estimation of statistical evidence.
Statistics and Computing , pp. 1165–1180, 2017. doi: https://doi.org/10.1007/s11222-016-9678-6.
Murray Gell-Mann and Keith A Brueckner. Correlation energy of an electron gas at high density. Physical
Review, 106(2):364, 1957.
Andrew Gelman and Xiao-Li Meng. Simulating normalizing constants: From importance sampling to bridge
sampling to path sampling. Statistical science , pp. 163–185, 1998.
Roger B Grosse, Chris J Maddison, and Russ R Salakhutdinov. Annealing between distributions by
averaging moments. In Advances in Neural Information Processing Systems , volume 26, 2013. URL
https://proceedings.neurips.cc/paper/2013/file/fb60d411a5c5b72b2e7d3527cfc84fd0-Paper.pdf .
Michael Habeck. Evaluation of marginal likelihoods via the density of states. In Artificial Intelligence and
Statistics , pp. 486–494, 2012.
Matthew D Hoffman and Andrew Gelman. The No-U-Turn sampler: adaptively setting path lengths in
Hamiltonian Monte Carlo. J. Mach. Learn. Res. , 15(1):1593–1623, 2014.
Michael I. Jordan, Zoubin Ghahramani, Tommi S. Jaakkola, and Lawrence K. Saul. An introduction to
variational methods for graphical models. Machine learning , 37(2):183–233, 1999.
Robert E. Kass and Adrian E. Raftery. Bayes Factors. Journal of the American Statistical Association , 90
(430):773–795, 1995.
John G. Kirkwood. Statistical Mechanics of Fluid Mixtures. The Journal of Chemical Physics , 3(5):300–313,
1935. doi: 10.1063/1.1749657. URL https://doi.org/10.1063/1.1749657 .
Alexander L. Kuzemsky. Variational principle of Bogoliubov and generalized mean fields in many-particle
interacting systems. International Journal of Modern Physics B , 29(18):1530010, 2015.
Nicolas Lartillot and Hervé Philippe. Computing Bayes Factors Using Thermodynamic Integration. System-
atic Biology , 55(2):195–207, 2006. ISSN 1063-5157. doi: 10.1080/10635150500433722.
Geneviève Lefebvre, Russell Steele, and Alain C Vandal. A path sampling identity for computing the
Kullback–Leibler and J divergences. Computational statistics & data analysis , 54(7):1719–1731, 2010.
Xiao-Li Meng and Wing Hung Wong. Simulating ratios of normalizing constants via a simple identity: a
theoretical exploration. Statistica Sinica , pp. 831–860, 1996.
Tetsuhisa Miwa, AJ Hayter, and Satoshi Kuriki. The evaluation of general non-centred orthant probabilities.
Journal of the Royal Statistical Society: Series B (Statistical Methodology) , 65(1):223–234, 2003.
12Under review as submission to TMLR
Radford M. Neal. Probabilistic Inference Using Markov Chain Monte Carlo Methods . 1993. URL
https://bayes.wustl.edu/Manual/RadfordNeal.review.pdf .
Radford M. Neal and Geoffrey E. Hinton. A view of the EM algorithm that justifies incremental, sparse,
and other variants. In Learning in graphical models , pp. 355–368. Springer, 1998.
Donald B. Owen. Orthant probabilities. Wiley StatsRef: Statistics Reference Online , 2014.
Kris V. Parag and Christl A. Donnelly. Using information theory to optimise epidemic models for real-
time prediction and estimation. PLOS Computational Biology , 16(7):1–20, 07 2020. doi: 10.1371/jour-
nal.pcbi.1007990.
Du Phan, Neeraj Pradhan, and Martin Jankowiak. Composable Effects for Flexible and Accelerated Prob-
abilistic Programming in NumPyro. arXiv preprint arXiv:1912.11554 , 2019.
Robert Piessens, Elise deDoncker Kapenga, Christian Ueberhuber, and David Kahaner. QUADPACK: A
Subroutine Package for Automatic Integration . Springer, 1983. ISBN 3540125531.
James Ridgway. Computation of Gaussian orthant probabilities in high dimension. Statistics and computing ,
26(4):899–916, 2016.
Harold Ruben. An Asymptotic Expansion for the Multivariate. Journal of Research of the National Bureau
of Standards: Mathematics and mathematical physics. B , 68:3, 1964.
John Skilling. Nested Sampling for General Bayesian Computation. Bayesian Analysis , 1(4):833–860, 2006.
URL https://projecteuclid.org/download/pdf 1/euclid.ba/ 1340370944 .
Pauli Virtanen, Ralf Gommers, Travis E. Oliphant, Matt Haberland, Tyler Reddy, David Cournapeau,
Evgeni Burovski, Pearu Peterson, Warren Weckesser, Jonathan Bright, Stéfan J. van der Walt, Matthew
Brett, Joshua Wilson, K. Jarrod Millman, Nikolay Mayorov, Andrew R. J. Nelson, Eric Jones, Robert
Kern, Eric Larson, CJ Carey, İlhan Polat, Yu Feng, Eric W. Moore, Jake Vand erPlas, Denis Laxalde,
Josef Perktold, Robert Cimrman, Ian Henriksen, E. A. Quintero, Charles R Harris, Anne M. Archibald,
Antônio H. Ribeiro, Fabian Pedregosa, Paul van Mulbregt, and SciPy 1. 0 Contributors. SciPy 1.0:
Fundamental Algorithms for Scientific Computing in Python. Nature Methods , 17:261–272, 2020. doi:
https://doi.org/10.1038/s41592-019-0686-2.
Silia Vitoratou and Ioannis Ntzoufras. Thermodynamic Bayesian model comparison. Statistics and Com-
puting, pp. 1165–1180, 2017. doi: https://doi.org/10.1007/s11222-016-9678-6.
Lidunka Vocadlo and Dario Alfe. Ab initio melting curve of the fcc phase of aluminum. Phys Rev B , 65(21),
2002.
Evan J. Williams. Regression Analysis . Wiley, 1959.
Wangang Xie, Paul O. Lewis, Yu Fan, Lynn Kuo, and Ming-Hui Chen. Improving Marginal Likelihood
Estimation for Bayesian Phylogenetic Model Selection. Systematic Biology , 60(2):150–160, 2010. ISSN
1063-5157. doi: 10.1093/sysbio/syq085.
Jun Zhang. The application of the Gibbs-Bogoliubov-Feynman inequality in mean field calculations for
Markov random fields. IEEE Transactions on Image Processing , 5(7):1208–1214, 1996.
13Under review as submission to TMLR
A Appendix
A.1 Variational Laplace Reference
The conditions to identify an optimal reference normalising constant can be derived by considering a Taylor
expansion of the log normalising constant log z(λ)aboutλ= 0:
logz(λ)≈logz(0) +λ∂λlogz(0) +1
2λ2∂2
λlogz(0).
The first derivative gives the expectation
∂λlogz(λ) =Eq(λ;θ)/bracketleftbigg
logq(θ)
qref(θ)/bracketrightbigg
,
as per the derivation in Equation 2, and the second derivative is a variance
∂2
λlogz(λ) =/integraltext/parenleftig
logq(θ)
qref(θ)/parenrightig2
q(λ;θ)dθ
/integraltext
q(λ;θ)dθ−
/integraltext/parenleftig
logq(θ)
qref(θ)/parenrightig
q(λ;θ)dθ
/integraltext
q(λ;θ)dθ
2
=/braceleftigg
Eq(λ;θ)/bracketleftigg/parenleftbigg
logq(θ)
qref(θ)/parenrightbigg2/bracketrightigg
−Eq(λ;θ)/bracketleftbigg
logq(θ)
qref(θ)/bracketrightbigg2/bracerightigg
≥0.
As the curvature of log z(λ)is increasing, to first order we see
logz(λ)≥logz(0)+λEq(0;θ)/bracketleftbigg
logq(θ)
q0(θ)/bracketrightbigg
,
and for the specific case of λ= 1,
logz≥logzref+Eqref(θ)/bracketleftbigg
logq(θ)
qref(θ)/bracketrightbigg
.
This inequality establishes bounds that can be maximised with respect to the position ( µ) and scale (S)
parameters of a reference density such as
qref(µ,S;θ) =q(µ)exp/parenleftbigg
−1
2(θ−µ)TS(θ−µ)/parenrightbigg
.
Thus the parameters that optimise
max
µ,S/braceleftbigg
logzref+Eqref(θ)/bracketleftbigg
logq(θ)
qref(µ,S;θ)/bracketrightbigg/bracerightbigg
,
provideareferencedensitythatisvariationallyoptimal. WenotethisisanapplicationoftheGibbs-Feynman-
Bogoliubov inequality (Bogolubov Jr, 1966; Kuzemsky, 2015; Zhang, 1996), and that finding approximations
of this type to the true density is a well-studied problem in machine learning, with well-documented ap-
proaches that can be used to determine qrefvariationally (Neal & Hinton, 1998; Jordan et al., 1999). In
itself the existence of a variational bound provides no guarantee of being a good approximation to the true
normalising constant, and is thus alone not a satisfactory general approach. However as a point of reference
from which to estimate the true normalising constant, it provides a first-order optimal density within the
family of trial reference functions considered, therefore improving convergence to the MCMC normalising
constant in referenced TI.
A.2 Algorithm
Algorithm 1.
14Under review as submission to TMLR
Algorithm 1 Referenced thermodynamic integration algorithm
Inputq- un-normalised density, qref- un-normalised reference density, Λ- set of coupling parameters
λ,N- number of MCMC iterations
Outputz- normalising constant of the density q
1:Define un-normalised density qand the reference density qref
2:Calculatezrefanalytically by using the determinant of the covariance matrix, as per Equations 5 or 6
from the main text.
3:forλ∈Λdo
4:Sample N values θnfromqλq1−λ
ref
5: forn= 1,2,...,N do
6: Calculate logq(θn)
qref(θn)
7: end for
8:Compute the mean, Eλ=1
NΣN
n=1logq(θn)
qref(θn)
9:end for
10:Interpolate between the consecutive Eλvalues to obtain a curve ∂λlog(z(λ))
11:Integrate∂λlog(z(λ))overλ∈[0,1]to get logz
zref
12:Calculatez=zref·exp/parenleftig
logz
zref/parenrightig
A.3 Applications
Here we present additional figures and tables for the examples shown in Section 3 of the paper.
A.3.1 2D Pedagogical Example with Constrained Parameters
Table 2: Evidence calculated with different methods. Constraint correction refers to imposing the integration
limits on the reference as per Equation 8 in the main text. Diagonal covariance means a covariance matrix
where only the diagonal (variance) terms are non-zero. Full covariance is a covariance matrix in which all
terms can be non-zero.∗obtained numerically (Virtanen et al., 2020; Piessens et al., 1983).
Method Evidence
Exact∗3.31
Laplace with full covariance 5.55
Laplace with diagonal covariance
+ constraint correction3.81
Ref TI with full covariance 4.79
Ref TI with diagonal covariance
+ constraint correction3.33
A.3.2 Benchmarks – Radiata Pine
A.3.3 COVID-19 Model
The COVID-19 model shown is based on the renewal equation derived from the Bellman-Harris process. The
details of the model and its derivation are provided in Berah et al. (2021). Here, we give a short overview
of theAR(2)model. The model has a Bayesian hierarchical structure and is fitted to the time-series data
containing a number of new confirmed COVID-19 cases per day in South Korea from 31-12-2019 to 18-07-
2020, obtained from https://opendata.ecdc.europa.eu/covid19/casedistribution/csv. New infections y(t)are
modelled by a negative binomial distribution, with a mean parameter in a form of a renewal equation. The
number of confirmed cases y(t)is modelled as:
y∼NegBin (f(t),ϕ),
15Under review as submission to TMLR
/uni00000013/uni00000011/uni00000013 /uni00000013/uni00000011/uni00000015 /uni00000013/uni00000011/uni00000017 /uni00000013/uni00000011/uni00000019 /uni00000013/uni00000011/uni0000001b /uni00000014/uni00000011/uni00000013
/uni0000001a/uni00000011/uni00000013/uni0000001a/uni00000011/uni00000018/uni0000001b/uni00000011/uni00000013/uni0000001b/uni00000011/uni00000018/uni0000001c/uni00000011/uni00000013/uni0000001c/uni00000011/uni00000018/uni00000014/uni00000013/uni00000011/uni00000013/uni00000028/uni0000005b/uni00000053/uni00000048/uni00000046/uni00000057/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051
/uni00000053/uni00000044/uni00000057/uni0000004b/uni00000003/uni00000049/uni00000055/uni00000052/uni00000050/uni00000003M1/uni00000003/uni00000057/uni00000052/uni00000003M2
(a) Model switch TI
/uni00000013/uni00000011/uni00000013 /uni00000013/uni00000011/uni00000015 /uni00000013/uni00000011/uni00000017 /uni00000013/uni00000011/uni00000019 /uni00000013/uni00000011/uni0000001b /uni00000014/uni00000011/uni00000013
/uni00000013/uni00000011/uni00000017
/uni00000013/uni00000011/uni00000016
/uni00000013/uni00000011/uni00000015
/uni00000013/uni00000011/uni00000014
/uni00000013/uni00000011/uni00000013/uni00000028/uni0000005b/uni00000053/uni00000048/uni00000046/uni00000057/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051
M1
M2 (b) Referenced TI
/uni00000013/uni00000011/uni00000013 /uni00000013/uni00000011/uni00000015 /uni00000013/uni00000011/uni00000017 /uni00000013/uni00000011/uni00000019 /uni00000013/uni00000011/uni0000001b /uni00000014/uni00000011/uni00000013
/uni0000001a/uni00000013/uni00000013
/uni00000019/uni00000013/uni00000013
/uni00000018/uni00000013/uni00000013
/uni00000017/uni00000013/uni00000013
/uni00000016/uni00000013/uni00000013
/uni00000028/uni0000005b/uni00000053/uni00000048/uni00000046/uni00000057/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051
M1
M2
(c) PP 11
/uni00000013/uni00000011/uni00000013 /uni00000013/uni00000011/uni00000015 /uni00000013/uni00000011/uni00000017 /uni00000013/uni00000011/uni00000019 /uni00000013/uni00000011/uni0000001b /uni00000014/uni00000011/uni00000013
/uni0000001a/uni00000013/uni00000013
/uni00000019/uni00000013/uni00000013
/uni00000018/uni00000013/uni00000013
/uni00000017/uni00000013/uni00000013
/uni00000016/uni00000013/uni00000013
/uni00000028/uni0000005b/uni00000053/uni00000048/uni00000046/uni00000057/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051
M1
M2 (d) PP 100
Figure 5: The HMC-evaluated expectation of Eq(λ;θ)/bracketleftig
logq(θ)
qref(θ)/bracketrightig
vs coupling parameter λis given for models
M1andM2for four methods of calculating the model evidence: model switch TI (a), referenced TI (b),
power posteriors with 11 λ-placements (c) and power posteriors with 100 λplacements (d). Model switch TI
(a) creates the path directly between two competing densities, therefore only one line is shown (see Equation
2 in the main text). In each of the plots, the evaluated expectation for a given λis shown with the dot, and
the lines connecting the dots were obtained through interpolation.
Table 3: Comparison of Bayes factors for radiata pine models for each method. Here we show BF21=M2
M1to determine whether model M2is better than model M1. Both TI and referenced TI methods used 11
equidistant λ-s. Power posteriors method was used with 11 (PP 11) and 100 (PP 100)λ-s. Third column
shows the total number of MCMC steps required to achieve standard error of 0.5%, excluding the warm-up
steps.∗- using sampled covariance matrix.
Method BF21MCMC steps
Exact 4552.35 -
Laplace approximation∗6309.10 -
Model switch TI 4557.63 2,365
Referenced TI 4558.71 308
PP11 4463.71 41,514
PP100 4757.82 55,000
whereϕis an overdispersion or variance parameter and the mean of the negative binomial distribution is
denoted as f(t)and represents the daily case data through:
f(t) =Rt/summationdisplay
τ<tf(t−τ)g(τ).
16Under review as submission to TMLR
/uni00000013 /uni00000015/uni00000013/uni00000013 /uni00000017/uni00000013/uni00000013 /uni00000019/uni00000013/uni00000013 /uni0000001b/uni00000013/uni00000013 /uni00000014/uni00000013/uni00000013/uni00000013 /uni00000014/uni00000015/uni00000013/uni00000013 /uni00000014/uni00000017/uni00000013/uni00000013
/uni0000002c/uni00000057/uni00000048/uni00000055/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000016/uni00000014/uni00000013/uni00000011/uni00000015/uni00000013
/uni00000016/uni00000014/uni00000013/uni00000011/uni00000014/uni00000018
/uni00000016/uni00000014/uni00000013/uni00000011/uni00000014/uni00000013
/uni00000016/uni00000014/uni00000013/uni00000011/uni00000013/uni00000018
/uni00000016/uni00000014/uni00000013/uni00000011/uni00000013/uni00000013
/uni00000016/uni00000013/uni0000001c/uni00000011/uni0000001c/uni00000018
/uni00000016/uni00000013/uni0000001c/uni00000011/uni0000001c/uni00000013
/uni0000002f/uni00000052/uni0000004a/uni00000010/uni00000048/uni00000059/uni0000004c/uni00000047/uni00000048/uni00000051/uni00000046/uni00000048/uni00000055/uni00000048/uni00000049/uni00000003/uni00000037/uni0000002c/uni00000003M1
/uni00000033/uni00000033100/uni00000003M1
M1/uni00000003/uni00000048/uni0000005b/uni00000044/uni00000046/uni00000057
(a)M1
/uni00000013 /uni00000015/uni00000013/uni00000013 /uni00000017/uni00000013/uni00000013 /uni00000019/uni00000013/uni00000013 /uni0000001b/uni00000013/uni00000013 /uni00000014/uni00000013/uni00000013/uni00000013 /uni00000014/uni00000015/uni00000013/uni00000013 /uni00000014/uni00000017/uni00000013/uni00000013
/uni0000002c/uni00000057/uni00000048/uni00000055/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000016/uni00000013/uni00000014/uni00000011/uni0000001a/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni0000001a/uni00000013
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000019/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000019/uni00000013
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000018/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000018/uni00000013
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000017/uni00000018
/uni0000002f/uni00000052/uni0000004a/uni00000010/uni00000048/uni00000059/uni0000004c/uni00000047/uni00000048/uni00000051/uni00000046/uni00000048/uni00000055/uni00000048/uni00000049/uni00000003/uni00000037/uni0000002c/uni00000003M2
/uni00000033/uni00000033100/uni00000003M2
M2/uni00000003/uni00000048/uni0000005b/uni00000044/uni00000046/uni00000057 (b)M2
/uni0000002f/uni00000044/uni00000053/uni0000004f/uni00000044/uni00000046/uni00000048 /uni00000035/uni00000048/uni00000049/uni00000003/uni00000037/uni0000002c /uni00000033/uni00000033100
/uni00000024/uni00000053/uni00000053/uni00000055/uni00000052/uni0000005b/uni0000004c/uni00000050/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000003/uni00000050/uni00000048/uni00000057/uni0000004b/uni00000052/uni00000047/uni00000016/uni00000014/uni00000013/uni00000011/uni00000014/uni00000015
/uni00000016/uni00000014/uni00000013/uni00000011/uni00000014/uni00000013
/uni00000016/uni00000014/uni00000013/uni00000011/uni00000013/uni0000001b
/uni00000016/uni00000014/uni00000013/uni00000011/uni00000013/uni00000019
/uni00000016/uni00000014/uni00000013/uni00000011/uni00000013/uni00000017
/uni00000016/uni00000014/uni00000013/uni00000011/uni00000013/uni00000015
/uni0000002f/uni00000052/uni0000004a/uni00000010/uni00000048/uni00000059/uni0000004c/uni00000047/uni00000048/uni00000051/uni00000046/uni00000048
(c)M1
/uni0000002f/uni00000044/uni00000053/uni0000004f/uni00000044/uni00000046/uni00000048 /uni00000035/uni00000048/uni00000049/uni00000003/uni00000037/uni0000002c /uni00000033/uni00000033100
/uni00000024/uni00000053/uni00000053/uni00000055/uni00000052/uni0000005b/uni0000004c/uni00000050/uni00000044/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000003/uni00000050/uni00000048/uni00000057/uni0000004b/uni00000052/uni00000047/uni00000016/uni00000013/uni00000014/uni00000011/uni0000001a/uni00000013
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000019/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000019/uni00000013
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000018/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000018/uni00000013
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000017/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000017/uni00000013
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000016/uni00000018
/uni00000016/uni00000013/uni00000014/uni00000011/uni00000016/uni00000013
/uni0000002f/uni00000052/uni0000004a/uni00000010/uni00000048/uni00000059/uni0000004c/uni00000047/uni00000048/uni00000051/uni00000046/uni00000048 (d)M2
Figure 6: Log-evidence of M1andM2for the three algorithms. (a) and (b) show the rolling mean of log-
evidence of M1andM2over 1500 iterations per λobtained by referenced TI (blue line) and PP 100(orange
line) methods. The exact value is shown with red dashed line. (c) and (d) show the mean log-evidence of
the two models evaluated over 15 runs of the three algorithms. The exact value of the log-evidence is shown
with the dotted line.
Here,g(τ)is a Raleigh-distributed serial interval with mean GI, which is discretised as
gs=/integraldisplays+0.5
s−0.5g(τ)dτfors= 2,3,...andg1=/integraldisplay1.5
0g(τ)dτ.
Rt, the effective reproduction number, is parametrised as Rt=exp(ϵt), with exponent ensuring positivity.
ϵtis an autoregressive process with two-days lag, that is AR(2), with ϵ1∼N(−1,0.1),ϵ2∼N(−1,σ)and
ϵt∼N(ρ1ϵt−1+ρ2ϵt−2,σt)fort={3,4,5,...}.
The model’s priors are:
σ∼N+(0,0.2),
ρ1∼N+(0.8,0.05),
ρ2∼N+(0.1,0.05),
ϕ∼N+(0,5),
GI∼N+(0.01,001).
Modification were applied to this basic model, to obtain the different variants of the model as described in
Section 3. First group of models analysed was the AR(2) model described above, but with the GIparameter
fixed to a certain value instead of inferring that parameter from the data. AR(3)andAR(4)models had
additional parameters ρ3andρ4, which allow to model the autoregressive process with a longer lag (3- and 4-
17Under review as submission to TMLR
GI=5
GI=6
GI=6.5
GI=7
GI=8
GI=9
GI=10
GI=20GI=5
GI=6
GI=6.5
GI=7
GI=8
GI=9
GI=10
GI=20/uni00000013 /uni00000010/uni00000014/uni00000015 /uni00000015/uni00000016 /uni00000014/uni00000019 /uni00000010/uni00000016/uni00000013 /uni0000001b/uni0000001a /uni0000001b/uni0000001c /uni0000001b/uni00000013
/uni00000014/uni00000015 /uni00000013 /uni00000016/uni00000018 /uni00000015/uni0000001c /uni00000010/uni00000014/uni0000001b /uni0000001c/uni0000001c /uni00000014/uni00000013/uni00000014 /uni0000001c/uni00000016
/uni00000010/uni00000015/uni00000016 /uni00000010/uni00000016/uni00000018 /uni00000013 /uni00000010/uni00000019 /uni00000010/uni00000018/uni00000016 /uni00000019/uni00000016 /uni00000019/uni00000019 /uni00000018/uni0000001a
/uni00000010/uni00000014/uni00000019 /uni00000010/uni00000015/uni0000001c /uni00000019 /uni00000013 /uni00000010/uni00000017/uni0000001a /uni0000001a/uni00000013 /uni0000001a/uni00000015 /uni00000019/uni00000016
/uni00000016/uni00000013 /uni00000014/uni0000001b /uni00000018/uni00000016 /uni00000017/uni0000001a /uni00000013 /uni00000014/uni00000014/uni0000001a /uni00000014/uni00000014/uni0000001c /uni00000014/uni00000014/uni00000014
/uni00000010/uni0000001b/uni0000001a /uni00000010/uni0000001c/uni0000001c /uni00000010/uni00000019/uni00000016 /uni00000010/uni0000001a/uni00000013 /uni00000010/uni00000014/uni00000014/uni0000001a /uni00000013 /uni00000015 /uni00000010/uni00000019
/uni00000010/uni0000001b/uni0000001c /uni00000010/uni00000014/uni00000013/uni00000014 /uni00000010/uni00000019/uni00000019 /uni00000010/uni0000001a/uni00000015 /uni00000010/uni00000014/uni00000014/uni0000001c /uni00000010/uni00000015 /uni00000013 /uni00000010/uni0000001b
/uni00000010/uni0000001b/uni00000013 /uni00000010/uni0000001c/uni00000016 /uni00000010/uni00000018/uni0000001a /uni00000010/uni00000019/uni00000016 /uni00000010/uni00000014/uni00000014/uni00000014 /uni00000019 /uni0000001b /uni00000013 /uni00000014/uni00000013/uni00000013
/uni00000018/uni00000013
/uni00000013/uni00000018/uni00000013/uni00000014/uni00000013/uni00000013
(a)
W=1
W=2
W=3
W=4
W=7W=1
W=2
W=3
W=4
W=7/uni00000013 /uni00000010/uni00000014/uni00000013 /uni00000018 /uni0000001b /uni00000014/uni00000014
/uni00000014/uni00000013 /uni00000013 /uni00000014/uni00000019 /uni00000014/uni0000001c /uni00000015/uni00000015
/uni00000010/uni00000018 /uni00000010/uni00000014/uni00000019 /uni00000013 /uni00000016 /uni00000019
/uni00000010/uni0000001b /uni00000010/uni00000014/uni0000001c /uni00000010/uni00000016 /uni00000013 /uni00000015
/uni00000010/uni00000014/uni00000014 /uni00000010/uni00000015/uni00000015 /uni00000010/uni00000019 /uni00000010/uni00000015 /uni00000013
/uni00000015/uni00000013
/uni00000014/uni00000018
/uni00000014/uni00000013
/uni00000018
/uni00000013/uni00000018/uni00000014/uni00000013/uni00000014/uni00000018/uni00000015/uni00000013
 (b)
AR(2)AR(3)AR(4)AR(2) AR(3) AR(4)/uni00000013 /uni00000010/uni0000001a /uni00000014/uni00000013/uni0000001c
/uni0000001a /uni00000013 /uni00000014/uni00000014/uni00000019
/uni00000010/uni00000014/uni00000013/uni0000001c /uni00000010/uni00000014/uni00000014/uni00000019 /uni00000013
/uni00000014/uni00000013/uni00000013
/uni00000018/uni00000013
/uni00000013/uni00000018/uni00000013/uni00000014/uni00000013/uni00000013
 (c)
Figure 7: Logarithms of Bayes factors for the analysed COVID-19 renewal models, evaluated using the
normalising constants ratios obtained by referenced TI. In each cell, the colour indicates the value of the
BF1,2for models M1(row) andM2(column). Higher values, that is a brighter orange colour, suggest that
M1is strongly better than M2, and values below 0 in blue palette indicate that M1is worse than M2.GI= 8
performed best out of fixed GImodels,W= 2best out of sliding window models, and AR(3)performed
better than AR(2)andAR(4). For the interpretation of the BF values see Kass & Raftery (1995).
days respectively). Finally, models W=k,k= 1,..,7were similar to the AR(2)model, but the underlying
assumption of these models is that the Rtstays constant for the duration of the length of the sliding window
W=k.
A.4 Bias and variance
Although referenced thermodynamic integration and other methods using path-sampling have theoretical
asymptotically exact Monte Carlo estimator limits, in practice a number of considerations affect accuracy.
For example, biases will be introduced to the referenced TI estimate in practice if one endpoint density
substantially differs from another. Then the volume of parameter space that must be explored to produce an
unbiased estimate of the expectation cannot be sampled based on the reference density generating proposals
within a practical number of iterations. The point is shown for a simple 1D example in Figure 10. Similarly,
the larger the mismatch, the higher the variance and slower the expectation is to converge. This illustrates
the advantage of using a reference that matches the posterior as closely as possible, as opposed to a typically
wide reference like the prior distribution, that gives the characteristic divergence at λ= 0with power
posteriors. Measures of density similarity in path sampling have been discussed by Lefebvre et al. (2010),
however in practical terms there remains much scope for analysis of reference performance in terms of scaling
with distribution dimension and type, which should be considered in detail in future work.
18Under review as submission to TMLR
/uni00000013 /uni00000018 /uni00000014/uni00000013 /uni00000014/uni00000018 /uni00000015/uni00000013
/uni00000013/uni00000011/uni00000013/uni00000013/uni00000011/uni00000015/uni00000013/uni00000011/uni00000017/uni00000013/uni00000011/uni00000019 AR(3)
AR(2)
/uni00000013 /uni00000018 /uni00000014/uni00000013 /uni00000014/uni00000018 /uni00000015/uni00000013
W=2
W=7
/uni00000013 /uni00000018 /uni00000014/uni00000013 /uni00000014/uni00000018 /uni00000015/uni00000013
GI=8
GI=20
(a) Posterior distributions for overdispersion parameter ϕ
/uni00000013/uni00000011/uni00000013/uni00000013 /uni00000013/uni00000011/uni00000015/uni00000018 /uni00000013/uni00000011/uni00000018/uni00000013 /uni00000013/uni00000011/uni0000001a/uni00000018 /uni00000014/uni00000011/uni00000013/uni00000013 /uni00000014/uni00000011/uni00000015/uni00000018 /uni00000014/uni00000011/uni00000018/uni00000013
/uni00000013/uni00000015/uni00000017/uni00000019/uni0000001b AR(3)
AR(2)
/uni00000013/uni00000011/uni00000013/uni00000013 /uni00000013/uni00000011/uni00000015/uni00000018 /uni00000013/uni00000011/uni00000018/uni00000013 /uni00000013/uni00000011/uni0000001a/uni00000018 /uni00000014/uni00000011/uni00000013/uni00000013 /uni00000014/uni00000011/uni00000015/uni00000018 /uni00000014/uni00000011/uni00000018/uni00000013
W=2
W=7
/uni00000013/uni00000011/uni00000013/uni00000013 /uni00000013/uni00000011/uni00000015/uni00000018 /uni00000013/uni00000011/uni00000018/uni00000013 /uni00000013/uni00000011/uni0000001a/uni00000018 /uni00000014/uni00000011/uni00000013/uni00000013 /uni00000014/uni00000011/uni00000015/uni00000018 /uni00000014/uni00000011/uni00000018/uni00000013
GI=8
GI=20
(b) Posterior distributions for σparameter
/uni00000013 /uni00000018/uni00000013 /uni00000014/uni00000013/uni00000013 /uni00000014/uni00000018/uni00000013 /uni00000015/uni00000013/uni00000013
/uni00000027/uni00000044/uni0000005c/uni00000056/uni00000013/uni00000018/uni00000014/uni00000013/uni00000014/uni00000018/uni00000015/uni00000013/uni00000015/uni00000018/uni00000016/uni00000013RtAR(3)
AR(2)
/uni00000013 /uni00000018/uni00000013 /uni00000014/uni00000013/uni00000013 /uni00000014/uni00000018/uni00000013 /uni00000015/uni00000013/uni00000013
/uni00000027/uni00000044/uni0000005c/uni00000056/uni00000013/uni00000018/uni00000014/uni00000013/uni00000014/uni00000018/uni00000015/uni00000013/uni00000015/uni00000018/uni00000016/uni00000013 W=2
W=7
/uni00000013 /uni00000018/uni00000013 /uni00000014/uni00000013/uni00000013 /uni00000014/uni00000018/uni00000013 /uni00000015/uni00000013/uni00000013
/uni00000027/uni00000044/uni0000005c/uni00000056/uni00000013/uni00000015/uni00000018/uni00000018/uni00000013/uni0000001a/uni00000018/uni00000014/uni00000013/uni00000013/uni00000014/uni00000015/uni00000018 GI=8
GI=20
(c)Rtgenerated by the favoured models
Figure 8: Posterior distributions for models’ parameters for models favoured by BFs using the Laplace
approximation (orange lines) and referenced TI (blue lines).
/uni00000013 /uni00000018/uni00000013 /uni00000014/uni00000013/uni00000013 /uni00000014/uni00000018/uni00000013 /uni00000015/uni00000013/uni00000013
/uni00000027/uni00000044/uni0000005c/uni00000056/uni00000013/uni00000015/uni00000013/uni00000013/uni00000017/uni00000013/uni00000013/uni00000019/uni00000013/uni00000013/uni0000001b/uni00000013/uni00000013/uni00000014/uni00000013/uni00000013/uni00000013/uni00000033/uni00000055/uni00000048/uni00000047/uni0000004c/uni00000046/uni00000057/uni0000004c/uni00000052/uni00000051/uni00000056AR(3)
AR(2)
/uni00000013 /uni00000018/uni00000013 /uni00000014/uni00000013/uni00000013 /uni00000014/uni00000018/uni00000013 /uni00000015/uni00000013/uni00000013
/uni00000027/uni00000044/uni0000005c/uni00000056W=2
W=7
/uni00000013 /uni00000018/uni00000013 /uni00000014/uni00000013/uni00000013 /uni00000014/uni00000018/uni00000013 /uni00000015/uni00000013/uni00000013
/uni00000027/uni00000044/uni0000005c/uni00000056GI=8
GI=20
Figure 9: Cases of SARS-CoV-2 infections in South Korea from the data (shown with bars) and the cases
predicted by different models. On each graph, predictions made by the model favoured by the Laplace
approximation is shown with a blue dashed line, and predictions made by the referenced TI favoured models
are shown with an orange dashed line. The lines in all three subplots are largely overlapping, revealing that
all models fitted the case data similarly well.
19Under review as submission to TMLR
0.00.20.40.60.81.0a b
c
q
qref
-4 -2 0 2 4-1.5-1.0-0.50.00.51.0
θDensity0246810Variance atλ= 0Ω/Ωref≈1
Ω/Ωref≈0.3
0.0 0.5 1.0 1.5 2.0 2.50.000.050.100.150.200.25
Ω/ΩrefSystematic Error atλ=0ql p
Figure 10: a) 1D examples to illustrate the bias and variance introduced with finite MCMC samples when
qandqrefare mismatched. In these examples ΩandΩrefdenote the domain of the 99%quartiles of qand
qref. b) A mismatch between qandqref(ΩandΩref) causes the variance of logq
qrefto increase, requiring more
iterations to convergence. c) Similarly the mismatch causes the mass of the distribution for the expectation
of logq
qref(evaluated with respect to the reference distribution) to increase beyond the parameter range
effectively sampled with finite iterations, in this example corresponding to the 99%quartile of the sampling
distribution, thus introducing a bias in the expectation.
20