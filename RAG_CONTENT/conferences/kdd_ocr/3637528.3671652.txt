Personalised Drug Identifier for Cancer Treatment with
Transformers using Auxiliary Information
Aishwarya Jayagopal
National University of Singapore
Singapore, Singapore
aishwarya.jayagopal@u.nus.eduHansheng Xue
National University of Singapore
Singapore, Singapore
hansheng.xue@nus.edu.sgZiyang He
National University of Singapore
Singapore, Singapore
heziyang@u.nus.edu
Robert J. Walsh
National University Cancer Institute
Singapore, Singapore
robert_walsh@nuhs.edu.sgKrishna Kumar Hariprasannan
National University of Singapore
Singapore, Singapore
krishnakh@u.nus.eduDavid Shao Peng Tan
Cancer Science Institute of Singapore
Singapore, Singapore
david_sp_tan@nuhs.edu.sg
Tuan Zea Tan
Cancer Science Institute of Singapore
Singapore, Singapore
csittz@nus.edu.sgJason J. Pitt
Cancer Science Institute of Singapore
Singapore, Singapore
jason.j.pitt@nus.edu.sgAnand D. Jeyasekharan
Cancer Science Institute of Singapore
Singapore, Singapore
csiadj@nus.edu.sg
Vaibhav Rajan
National University of Singapore
Singapore, Singapore
vaibhav.rajan@nus.edu.sg
Abstract
Cancer remains a global challenge due to its growing clinical and
economic burden. Its uniquely personal manifestation, which makes
treatment difficult, has fuelled the quest for personalized treatment
strategies. Thus, genomic profiling is increasingly becoming part of
clinical diagnostic panels. Effective use of such panels requires accu-
rate drug response prediction (DRP) models, which are challenging
to build due to limited labelled patient data. Previous methods to
address this problem have used various forms of transfer learning.
However, they do not explicitly model the variable length sequen-
tial structure of the list of mutations in such diagnostic panels.
Further, they do not utilize auxiliary information (like patient sur-
vival) for model training. We address these limitations through a
novel transformer-based method, which surpasses the performance
of state-of-the-art DRP models on benchmark data. Code for our
method is available at https://github.com/CDAL-SOC/PREDICT-AI.
We also present the design of a treatment recommendation sys-
tem (TRS), which is currently deployed at the National University
Hospital, Singapore and is being evaluated in a clinical trial. We
discuss why the recommended drugs and their predicted scores
alone, obtained from DRP models, are insufficient for treatment
planning. Treatment planning for complex cancer cases, in the face
of limited clinical validation, requires assessment of many other
This work is licensed under a Creative Commons Attribution
International 4.0 License.
KDD ’24, August 25–29, 2024, Barcelona, Spain
©2024 Copyright held by the owner/author(s).
ACM ISBN 979-8-4007-0490-1/24/08
https://doi.org/10.1145/3637528.3671652factors, including several indirect sources of evidence on drug effi-
cacy. We discuss key lessons learnt on model validation and use of
indirect supporting evidence to build clinicians’ trust and aid their
decision making.
CCS Concepts
•Applied computing →Bioinformatics; Health care infor-
mation systems; •Computing methodologies →Neural net-
works; Learning latent representations.
Keywords
personalized treatment recommendation, cancer drug response pre-
diction, transformers, auxiliary information, clinical deployment,
survival prediction
ACM Reference Format:
Aishwarya Jayagopal, Hansheng Xue, Ziyang He, Robert J. Walsh, Krishna
Kumar Hariprasannan, David Shao Peng Tan, Tuan Zea Tan, Jason J. Pitt,
Anand D. Jeyasekharan, and Vaibhav Rajan. 2024. Personalised Drug Identi-
fier for Cancer Treatment with Transformers using Auxiliary Information.
InProceedings of the 30th ACM SIGKDD Conference on Knowledge Discovery
and Data Mining (KDD ’24), August 25–29, 2024, Barcelona, Spain. ACM, New
York, NY, USA, 12 pages. https://doi.org/10.1145/3637528.3671652
1 Introduction
Cancer, a leading cause of death globally, occurs due to the uncon-
trolled proliferation of cells. During cancer progression, cells in the
body acquire specific alterations (mutations ) that allow them to mul-
tiply rapidly compared to normal cells, resulting in tumors. Cancer
remains difficult to cure due to its high complexity, which is not yet
fully understood, and considerable heterogeneity in treatment out-
comes [ 52]. While clinical trials have identified therapeutic agents
5138
KDD ’24, August 25–29, 2024, Barcelona, Spain Aishwarya Jayagopal et al.
Figure 1: Overview of our personalized Treatment Recommendation System (TRS) and its role in clinical treatment planning.
that target specific mutations, these studies have largely been re-
stricted to mutations in individual genes [ 2,39]. Conducting trials to
identify the most suitable drug for every combination of mutations
across all (∼20000) genes is intractable due to the exponentially
large combinatorial space of mutations. Machine learning solutions
provide a promising direction and can mine patterns from patient
genomic profiles that correlate with drug response. However, build-
ing these drug response prediction (DRP) models require large
patient genomic datasets with documented response to different
drugs. While patient genomic profiles have been collected in large
numbers [ 4,57], corresponding drug response data is limited as
standard of care treatment [ 38,50] in clinics only involve a narrow
subset of drugs decided by the cancer type.
This dearth of patient drug response data has led researchers
to create and explore ‘proxy’ patient datasets – cell lines. These
are cancer cells extracted from patients, which can be cloned (thus
having the same genomic profiles) and simultaneously screened
for multiple drugs [ 13]. These cells proliferate in an environment
different from the human body, and this results in distributional
shifts in the mutations and changes in the observed drug responses,
compared to those in patients. Thus, DRP models on cell lines are
not directly usable on patients. To address this problem, several
transfer learning methods, e.g., [ 15,42], have been developed to
effectively utilize both the labelled source domain (cell lines) and
target domain (patients) containing some labelled and relatively
abundant unlabelled data. These methods have not been evaluated
in a clinical setting which pose additional data-related challenges.
Omics data is rapidly becoming part of clinical diagnostics for
cancer. Patients undergo genomic sequencing to identify mutations
present in a subset of cancer-related genes. For example, popu-
lar clinical sequencing panels like FoundationOne CDx [ 30] and
TruSight Oncology 500 [ 56] consider 324 and 523 genes respectively.
Note that each gene is a sequence of DNA alphabets and a mutation
can occur in any location in the sequence. The sequencing report
lists out mutations detected in the genes (at a sub-gene level) and
their locations – the effect of a mutation depends on the location
as well. Thus, input data for a patient comprises a sequence of
mutations, with the sequence length varying across patients.
Previous transfer learning based DRP models have several lim-
itations: (i) The best previous methods [ 15,42] have considered
subsets of genes (e.g., 1426 in CODE-AE, 2128 in Velodrome) basedon criteria like maximum variations in values and known interac-
tions amongst proteins. The selected subsets do not match those in
diagnostic panels. (ii) Most prior methods, e.g., [ 15,29,36,42,43],
consider gene expression data (indicative of gene activity) to train
DRP models, which is largely unavailable in current clinical set-
tings [ 22,63]. (iii) To our knowledge, DruID [ 16] is the only DRP
model that addresses the above problems. This work also shows
that to effectively utilize diagnostic panels, sparsity of the mutation
data (a problem which previous gene expression based models do
not face) has to be carefully modeled. Further, DruID also used
the sub-gene level variant information, through additional annota-
tions, which predict the effect of the mutation locations on cancer.
However, these annotations were aggregated to obtain a fixed-
dimensional representation of each gene which was subsequently
used as input to the DRP model. Thus, none of the extant meth-
ods explicitly model the variable-length sequential nature of the
inputs. (iv) The best previous methods, including DruID, follow
the paradigm of unsupervised representation learning (to utilize
unlabelled data) followed by supervised fine tuning. They have
largely neglected available auxiliary information which are highly
correlated to drug response, such as patient survival, which can be
used to supervise representation learning.
We address these limitations through a novel transformer-based
algorithm PREDICT-AI (PeRsonalisEd Drug Identifier for Cancer
Treatment using Auxiliary Information), to predict drug response
using sparse mutation data from diagnostic panels. Following [ 16],
we annotate sub-gene level mutation locations, to model their func-
tional effects, and obtain a feature vector per input mutation. We
design a novel tokenization approach to embed this sequence of
feature vectors in transformers. Our model learns from both cell
line and patient mutation data, and utilizes auxiliary survival infor-
mation, in a two-stage training process comprising: (i) Transformer
enhanced Multi-Task Logistic Regression-based Survival Prediction
TransformerMTLR , and (ii) Pre-trained Transformer-based Drug Re-
sponse Prediction TransformerDRP . We evaluate the performance
of PREDICT-AI on benchmark datasets and show that our model-
ing approach leads to substantial performance improvement over
state-of-the-art methods.
Although several DRP methods have been developed in the past,
their application in mainstream clinical practice is limited [ 7,31].
Using a DRP model on a set of drugs, we can predict which drug is
5139Personalised Drug Identifier for Cancer Treatment with Transformers using Auxiliary Information KDD ’24, August 25–29, 2024, Barcelona, Spain
likely to be most effective for a patient. However, this prediction
alone is insufficient for clinicians to decide whether or not to ad-
minister the drug, which also makes clinical validation of a DRP
model challenging. Treatment planning for complex cancer cases
is increasingly done by a Molecular Tumor Board (MTB) [ 28,49],
where several expert clinicians collectively decide on the most suit-
able treatment. Their decision-making relies on knowledge from
clinical trials and/or mechanism of action for each drug as well as
clinical guidelines. However, mechanism of action of drugs may not
always be fully known. And, as mentioned earlier, it is infeasible to
obtain knowledge of drug efficacy for every combination of muta-
tions through clinical trials. As a result, the choice of a drug for a
patient, has to be made by considering multiple incomplete or indi-
rect sources of evidence. In fact, this would be the decision-making
process even to evaluate the efficacy of a DRP model through a
clinical trial. We discuss these considerations, steps taken towards
building such a treatment recommendation system (TRS) for MTB
(Figure 1) and lessons learnt from the deployment.
To summarize, our main contributions are as follows:
•We design a new transformer-based machine learning method,
PREDICT-AI , which predicts the efficacy of a given drug on a
genomic profile comprising mutation information of a subset of
genes sequenced in clinical diagnostic reports.
•To the best of our knowledge, we are the first to incorporate
auxiliary information, like patient survival, indicative of patient
response in transfer-learning based drug response prediction.
•We propose a novel tokenization approach to explicitly model
variable length sequential inputs and incorporate biologically
meaningful annotations of individual mutations as features.
•We describe our implementation of a treatment recommenda-
tion system (TRS), hosted at https://pharmacope.ai/, which uses
DRP models, to support molecular tumor boards (MTB) in their
treatment planning process. We discuss key lessons learnt on
model validation and use of indirect supporting evidence to build
clinicians’ trust and aid their decision making.
2 Background and Related Work
2.1 Background
Dearth of drug response data in patients has led researchers to
create and explore cell lines. These are cancer cells extracted from
patients, which are replicated and studied under controlled labo-
ratory conditions [ 13]. Replicated cells, having identical genomes,
are subjected to different doses of various drugs to examine their
response. A common measure of drug response in cell lines is the
Area Under the Dose Response Curve (AUDRC), which is a
real-valued function of the number of surviving cells after exposure
to the drug. These cell lines are in an environment different from
and outside the patient body, and so, mutations observed across
cancer cells in cell lines and patients display distributional differ-
ences. Further, their response to drugs may also be different from
that of a tumour inside a patient.
Patient drug response is measured as a function of change in
tumor volume, using Response Evaluation Criteria In Solid
Tumors (RECIST) [48] categories - Stable Disease, Progressive
Disease, Complete Response, Partial Response. The four categories
are coalesced into 2 classes indicating good/bad response. Somepatient datasets also measure the time taken from treatment start to
tumor progression/death, i.e. Progression-Free Survival (PFS) [3],
which can be indicative of drug efficacy. DRP models trained on
cell lines cannot translate directly to patients [ 33,43] due to dis-
tributional differences in mutations, differences in drug response
measurements and functions. Thus, transfer learning approaches
are used to effectively utilize data from both domains.
2.2 Related Work
Prior DRP models perform transfer learning between the source
domain (cell lines) and target domain (patients). These methods
can be categorised broadly based on their use of labeled patient
samples. Inductive transfer learning methods, like AITL [ 43] and
TCRP [ 29] used both labeled cell line and patient samples. Trans-
ductive methods like TUGDA [ 36], Velodrome [ 42] used labeled
cell line and unlabeled patient samples. Only a few methods, like
CODE-AE [ 15] and DruID [ 16], relied on unsupervised transfer
learning using available unlabeled cell line and patient datasets in
a pre-training stage. Most of these methods derived binary patient
labels from RECIST categories and none of them have used PFS
information for DRP modeling. All these methods (except DruID)
used gene expression data, and have not been evaluated on sparse
mutation data from diagnostic panels. DruID used mutation level
variant annotations to model their functional effects but has not ex-
plictly modeled their variable-length sequential structure. Through
the used of transformers, our model addresses this limitation and
achieves superior empirical performance on benchmark data.
Many survival models have been developed to predict time-to-
event [ 26,55], the event being tumor progression in our case. Here,
we mention a few recent works, particularly those based on deep
learning. These methods can be broadly classified into two types
based on whether they model survival time as discrete or continu-
ous. Models like DeepSurv [ 21], PCHazard [ 23] treat survival time
as continuous, while others like LogisticHazard [ 12], PMF, Deep-
Hit [ 25] and MTLR [ 11] treat it as discrete. These methods largely
rely on simpler neural networks and empirically yield poor perfor-
mance on relatively small datasets. Our approach in this work is
based on MTLR but we use transformers in place of feed forward
networks and integrate survival prediction with DRP.
3 Data
We obtain mutation profiles of cell lines from the Cancer Cell Line
Encyclopedia (CCLE) DepMap portal [ 13] and their drug responses
from the Genomics of Drug Sensitivity in Cancer (GDSC) portal [ 61].
The mutation data for patients with RECIST response, was obtained
from The Cancer Genome Atlas (TCGA) GDC portal [ 57]. The cor-
responding RECIST response data was obtained from [ 18] and
converted to binary labels as in [ 36]. There is a significant class
imbalance in this dataset, with 454 positively and 175 negatively
labeled (sample, drug) pairs. For patients with survival informa-
tion, we obtained both mutation profiles as well as progression-free
survival information for colorectal cancer patients from the GE-
NIE BPC CRC v2.0-public dataset [ 53] (henceforth ‘CRC’) and for
non-small cell lung cancer patients from the GENIE BPC NSCLC
v2.0-public dataset [ 5] (henceforth ‘NSCLC’). We consider only
progression-free survival (PFS) as it is the only other clinically
5140KDD ’24, August 25–29, 2024, Barcelona, Spain Aishwarya Jayagopal et al.
relevant outcome-related target [ 59]. Drugs were encoded using
Morgan fingerprints [ 32]. We use Morgan fingerprints instead of
molecular graphs, as they are the most commonly used represen-
tation in prior DRP literature [ 35], and to ensure fair comparison
with [ 16]. Details of processing are in Appendix A.1. Data statistics
after processing are in Appendix Table 3.
4 Method
4.1 Preliminaries
The patient records utilized for drug response prediction tasks
primarily include information on genes, mutations, and drugs. In
our experiments, we consider 324 genes (from the FoundationOne
CDx panel) associated with patients, denoted as 𝐺. For each sub-
gene-level mutation, we follow the variant annotation procedure
as in [ 16], without the gene-level aggregation step. This results in a
17 dimensional binary vector from Annovar [54], a 3-dimensional
binary vector each from GPD [ 27] and ClinVar [ 24], together re-
sulting in a 23-dimensional annotation-based features for each
mutation, denoted as 𝑀∈R|𝑀|×23, and drugs with Morgan finger-
print features represented by 𝐷∈R|𝐷|×2048. We consider 3 sepa-
rate tasks, each with its own dataset. i) For the survival prediction
task, the training dataset is a combination of the CRC and NSCLC
datasets, denoted as P=P𝐶𝑅𝐶∪P𝑁𝑆𝐶𝐿𝐶 . These patient samples
not only include three types of information (genes, mutations, and
drugs) but also encompass survival time information ( 𝑡), denoted
asP={𝑔𝑢𝑖,𝑚𝑢𝑖,𝑑𝑖,𝑡𝑖}𝑁
𝑖=1, where𝑔𝑢𝑖⊆𝐺,𝑚𝑢𝑖⊆𝑀,𝑑𝑖⊆𝐷,
𝑡𝑖∈R,𝑁denotes number of patients and 𝑢∈Z+varies across
patients. ii) In the drug response prediction task, TCGA patient data
is employed and denoted as P𝑇𝐶𝐺𝐴 . Drug response prediction aims
to acquire information about patient samples, specifically genes
and mutations, to predict their drug responses as a classification
task. Similar to i), the TCGA patient dataset can be represented
asP𝑇𝐶𝐺𝐴 ={𝑔𝑢𝑖,𝑚𝑢𝑖,𝑑𝑖,𝑦𝑖}𝑁
𝑖=1, where𝑦𝑖∈{0,1}where𝑦𝑖=1
indicates that the patient responds well to 𝑑𝑖and𝑦𝑖=0indicates
that the tumor worsens. iii) Additionally, during response predic-
tion, we integrate the task for predicting the real-valued AUDRC
on cell lines, to improve the overall performance of response predic-
tion [ 16,43]. The cell line data is employed in this task, encompass-
ing information on genes, mutations, drugs, and associated AUDRC
values, denoted as P𝐶𝐿={𝑔𝑢𝑖,𝑚𝑢𝑖,𝑑𝑖,𝑣𝑖}𝑁
𝑖=1, where𝑣𝑖∈ [0,1]
with lower value indicating better response to the drug. It must be
noted that in all 3 cases, the number of gene-mutation pairs 𝑢can
differ across samples, resulting in a variable length input.
In summary, our model involves three tasks: survival prediction
formulated as multi-task logistic regression, AUDRC prediction
as a regression task, and the RECIST prediction as a classification
task. In the initial pre-training step, we perform survival prediction
using CRC and NSCLC data. Subsequently, we leverage both sur-
vival prediction on NSCLC data and AUDRC prediction on cell line
data to improve the overall performance of the final drug response
prediction in TCGA patients. The PREDICT-AI model primarily
comprises two components: a multi-task logistic regression model
based on transformers for survival prediction (TransformerMTLR)
and a pretrained transformer-based drug response prediction model
incorporating the AUDRC prediction task ( TransformerDRP ). The
overall architecture is illustrated in Figure 2.4.2 Tokenization
We use transformers to model varying length inputs, with each in-
put being a sequence of { gene-mutation } names such as {TP53-R306},
{KRAS-G12V} ,... Note that there can be multiple mutations in the
same gene and the number of listed genes can differ across patients.
Text tokenizers are not trained on genomic data, so they cannot
recognize these mutations and hence tokenize them as ‘unknowns’.
The first step is to tokenize the inputs without treating the names of
genes and mutations as linguistic words. Unlike genomic tokenizers
for every nucleotide [ 17,34] or entire genes [ 19,47], we tokenize
at an intermediate level - mutations in genes. We are also the first
to embed tokens with biologically meaningful annotations. To this
end, we propose a novel tokenizer as shown in Figure 3.
We have two separate tokenizers - one each at the gene and
mutation levels. The gene-level tokenizer vocabulary has 324 gene-
specific tokens (1 per gene), 2 special separator tokens (<gensep>,
<mutsep> ), 4 classical special tokens ( <s>, </s>, <pad>, <unk> ),
and 1 general mutation token ( <mut> ). As shown in Figure 3, each of
these tokens is mapped to a unique index ranging from 0 to 330. </s>
and<s>denote start and end of sequence. <unk> indicates unknown
tokens and <pad> is for padding shorter sequences. <gensep> is
used to separate out genes. <mut> is used to denote the presence of
a mutation within the gene. In Figure 3, given a sample S1, the gene
level tokenization includes the 4 classical special tokens. Genes G1
and G2 are assigned the corresponding gene-specific token with
<mutsep> used to denote start of mutations within a gene (e.g.,
before M3, M5 in G2). Each individual mutation is assigned the
token <mut>.
In the mutation level tokenizer, each gene-mutation pair is
mapped to a unique number, ranging from 1 to the maximum num-
ber of gene-mutation pairs (𝑀) (Figure 3). Each token is associated
with a set of 23 annotated features 𝑀∈R|𝑀|×23. Details of the
annotations can be found in [ 24,27,54]. Tokens that are not recog-
nised as gene-mutation pairs in the genomic profile are mapped
to index𝑀+1and token <namut> , and embedded as a 23-dim
unit vector 123. The tokenized output lengths of both tokenizers is
identical.
Given an input sample, the final vector representation, in terms
of tokens, is made up of two parts - one each from the gene and
mutation level tokenizers. A gene-level vector is made up of gene
level token indices, extracted from the gene tokenizer, and padded
to reach maximum possible gene index. Similarly a mutation level
vector is made up of mutation level token indices and padded to
reach maximum possible gene-mutation index. These two vectors
are concatenated and passed as input to the transformer.
4.3 TransformerMTLR: Multi-Task Logistic
Regression- based Survival Prediction
The survival prediction model primarily comprises two compo-
nents: i) formulating survival prediction as a multi-task logistic
regression model and ii) constructing transformer and neural net-
work models to learn from patients’ clinical inputs.
i. Multi-task logistic regression. We formulate the survival pre-
diction as a multi-task logistic regression task following [ 11]. For
a patient𝑝∈P with survival time 𝑡, the survival function can
5141Personalised Drug Identifier for Cancer Treatment with Transformers using Auxiliary Information KDD ’24, August 25–29, 2024, Barcelona, Spain
Figure 2: Overview of the PREDICT-AI , consisting of three main components: (A) TransformerMTLR : a multi-task logistic regression
model based on transformers for survival prediction. (B) TransformerDRP : a pretrained transformer-based drug response
prediction model incorporating the AUDRC prediction task. (C) Detailed description of the transformer encoder layers.
Figure 3: Overview of proposed tokenization procedure with
gene and mutation tokenizers.
be computed asF(𝑡)=𝑃𝑟𝑜𝑏(𝑡′>𝑡), representing the probabil-
ity that an individual within the population will survive beyond
time𝑡[62]. When provided with the survival times of a group of
individuals, we can graphically depict the proportion of individ-
uals surviving over time using the Kaplan-Meier curve, which is
closely associated with the hazard function. Therefore, the survival
function can be computed as: F(𝑡)=exp(−∫𝑡
0𝜆(𝑢)𝑑𝑢), where
𝜆(𝑡)=limΔ𝑡→0𝑃(𝑡≤𝑡′<𝑡+Δ𝑡|𝑡′≥𝑡)
Δ𝑡. Many methods exist for estimat-
ingF(𝑡)and𝜆(𝑡), such as Cox’s proportional hazards model [ 8] and
the Kaplan-Meier model [ 20]. However, these models are computa-
tionally inefficient and rely on strict distributional assumptions.
Multi-task logistic regression can mitigate these limitations by
utilizing a series of logistic regression models across various time in-
tervals to estimate the probability of the event of interest occurring
within each interval. Thus, the response variable 𝑠𝑗for a logisticregression model on each interval 𝛼𝑗can be formulated as 𝑠𝑖=1if
𝑡′∈𝛼𝑗i.e., the event happened in the interval 𝛼𝑗else 0. Thus, if a
patient experiences an event (tumor progression in this case) in one
of𝑘intervals (𝑘∈[1,𝐾]), the response vector with 𝐾time intervals
can be formulated as 𝑆=[𝑠0=0,...,𝑠𝑘−1=0,𝑠𝑘=1,...,𝑠𝐾=1]. To
capture the underlying non-linear relationships in the data, neu-
ral multi-task logistic regression was introduced, incorporating
multi-layer perceptrons [ 11].The survival function can be defined
as:
F(𝑡𝑘−1,𝑥)=𝐾∑︁
𝑖=𝑘exp(𝜙(𝑥)·Δ·𝑆)
𝑍(𝜙(𝑥)), (1)
where𝜙:R𝑑↦−→R𝐾is the transformation function, 𝑥∈R𝑑de-
notes𝑑-dimensional features. Δ∈R𝐾×(𝐾+1)is a triangular matrix.
𝑍(𝜙(𝑥))=Í𝐾
𝑗=1exp(Í𝐾
𝑙=𝑗+1𝜙(𝑥))is the normalizing constant. For
survival prediction, we define the loss function as the negative
log-likelihood of Equation 1 (similar to DeepSurv [ 21]). The log-
likelihood function primarily comprises two components—one for
uncensored instances P𝑢and one for censored instances P𝑐. The
whole sample data is denoted as P=P𝑢∪P𝑐={¯𝑋,𝑆}, where ¯𝑋
denotes the learned features from transformer or drug embedder
(described in the following sections). The objective function for
survival prediction can be formulated as:
L𝑆=∑︁
𝑗∈P𝑢𝐾−1∑︁
𝑘=1𝜙𝑘(𝑋𝑗)𝑆𝑗
𝑘+∑︁
𝑗∈P𝑐log∑︁
𝑡𝑘>𝑇𝑗
𝑐exp(𝐾−1∑︁
𝑘=1𝜙𝑘(𝑋𝑗))
−|P|∑︁
𝑗=1log𝑍(𝜙(𝑋𝑗))(2)
ii. Transformer and Neural networks. Within the multi-task
logistic regression model, the learning module comprises a trans-
former for patients and a multilayer perceptron for drugs. Following
5142KDD ’24, August 25–29, 2024, Barcelona, Spain Aishwarya Jayagopal et al.
the utilization of these learning modules, a transformation is em-
ployed for prediction, ℎ. Subsequently, we will provide a detailed
introduction to the transformer utilized for patient learning. Given
patient samplesP, we perform tokenization and obtain the feature
vector as in Section 4.2. The features for each gene and mutation
can be represented as 𝑋𝑔∈R𝑑and𝑋𝑚∈R𝑑, respectively. The
combined features for each patient are denoted as 𝑋=[𝑋𝑔||𝑋𝑚],
where||denotes the concatenation operation.
The structure of the transformer encoder layer primarily includes
one multi-head attention layer, one position-wise feed-forward
layer, and several layer normalization operators [ 51]. The multi-
head attention layer trains multiple attention heads independently
to focus on distinct parts of the inputted patients’ embeddings.
Given the input encoding 𝑋, three distinct representations known
as query (Q), key (K), and value (V) are derived through a linear
transformation of 𝑋, expressed as 𝑄=𝑋𝑊𝑄,𝐾=𝑋𝑊𝐾, and𝑉=
𝑋𝑊𝑉, where𝑊𝑄,𝑊𝐾,𝑊𝑉∈R𝑑×𝑑represent trainable parameters
of the network. The self-attention mechanism is defined as:
Attention(𝑄,𝐾,𝑉)=softmax𝑄𝐾⊤
√
𝑑
𝑉. (3)
The attention mechanism uses the scaled dot product of the key
and query to calculate the relevance between the sequence ele-
ments, and then the softmax function is applied on the 𝑄𝐾⊤. The
scaling factor 1/√
𝑑works analogously to standard dot product at-
tention. The resulting matrix contains a set of weights in each row
to compute the weighted sum of the input values 𝑉. To allow the
model to attend to information based on varying patterns multiple
attention-heads are employed.
MultiHead(𝑋)=Concat(head 1,..., headℎ)𝑊𝑂, (4)
where head 𝑖=Attention(𝑋𝑊𝑄
𝑖,𝑋𝑊𝐾
𝑖,𝑋𝑊𝑉
𝑖). (5)
whereℎrepresents the number of attention heads, and 𝑊𝑄,𝑊𝐾,
𝑊𝑉, and𝑊𝑂stand for trainable parameters of the network. Fol-
lowing the multi-head attention operation, layer normalization and
residual connections are employed to facilitate training acceleration,
enhance generalization, and alleviate the vanishing or exploding
gradients problem. Additionally, a fully connected feed-forward
network (FFN) is applied uniformly to each token. This layer com-
prises two linear transformations with a rectified linear unit (ReLU)
activation in the middle.
In the survival prediction module, a neural network, such as
a multi-layer perceptron, incorporating batch normalization and
activation functions, is utilized to learn the features of the inputted
fingerprints for drugs and serve as the predictor. The structure of
the neural network can be expressed as:
¯𝑋𝐷=MLP𝐷𝑟𝑢𝑔(𝑋𝐷),ˆ𝑦=MLP(¯𝑋𝐷||¯𝑋), (6)
where𝑋𝐷is the 2048-dimensional fingerprint features of drugs, ¯𝑋
is the learned features outputted from transformer, and ||denotes
the concatenation operation. We also compare the performance
of PREDICT-AI when a graph convolution network (GCN) is used
instead of MLP𝐷𝑟𝑢𝑔 , as shown in Appendix A.7.4.4 TransformerDRP: Pre-trained
Transformer-based Response Prediction
Within the TransformerDRP , we primarily incorporate two drug
response prediction tasks – based on patient data (RECIST predic-
tor) and based on cell line data (AUDRC predictor).
i. RECIST Predictor. By optimizing the loss function in Equation 1
within the survival prediction section, we can acquire trained trans-
formers for patients and neural networks for drugs. During this
stage, we employ these pretrained models to predict drug response
by jointly optimizing RECIST prediction and survival prediction.
Similar to the patients (CRC and NSCLC) in the survival prediction
section, patient samples (TCGA) employed in the response pre-
diction part also encompass genes, mutations, and drugs for each
sample. We input the patient and drug features into the transformer
and neural network, respectively, to obtain the learned embed-
dings ¯𝑋𝑇and ¯𝑋𝐷. Subsequently, a MLP-based RECIST predictor is
constructed to predict the response, ˆ𝑌=MLP(¯𝑋𝑇||¯𝑋𝐷). Next, to
address the class imbalance problem, we utilize the BCEFocalLoss
as the objective function, calculated as:
L𝑅=1
𝑁∑︁
𝑖∈𝑁[−𝛼𝑦𝑖(1−ˆ𝑦𝑖)𝛾log(ˆ𝑦𝑖)−(1−𝛼)(1−𝑦𝑖)ˆ𝑦𝛾
𝑖log(1−ˆ𝑦𝑖)],
(7)
where, ˆ𝑦∈ˆ𝑌represents the predicted response, and 𝑦∈𝑌is
the true response. 𝑁denotes the number of patient samples. The
weighting factor is denoted as 𝛼∈[0,1], and𝛾≥0serves as the
tunable focusing parameter.
ii. AUDRC Predictor. Note that the format of the preprocessed cell
line data is similar to the patient samples. Through the pretrained
transformer and drug neural network, we can also obtain the em-
beddings for samples and drugs ˆ𝑋𝐶and ˆ𝑋𝐷. A MLP-based AUDRC
predictor is constructed to predict the value, ˆ𝑅=MLP(¯𝑋𝐶||¯𝑋𝐷).
The MSE loss function for the AUDRC predictor and calculated as:
L𝐶=1
𝑀𝑀∑︁
𝑖(ˆ𝑟𝑖−𝑟𝑖)2, (8)
where, ˆ𝑟𝑖∈ˆ𝑅represents the predicted response, and 𝑟∈𝑅is the
true AUC value. 𝑀denotes the number of cell line samples. In
the response prediction phase, we jointly optimize three objective
functions,𝐿𝑆for survival prediction, 𝐿𝑅for response prediction,
and𝐿𝐶for AUDRC predictor. The pseudocode for PREDICT-AI is
shown in Algorithm 1 A.
5 Experiments and Results
To evaluate our model, PREDICT-AI , we conduct 3 experiments - i)
evaluation of TransformerMTLR on survival prediction, ii) evalua-
tion of PREDICT-AI against state-of-the-art DRP models, iii) abla-
tion tests on various model components.
5.1 Survival Prediction with TransformerMTLR
To evaluate TransformerMTLR , we compare its test set concordance
index (CI) [ 41] with that of 6 baseline survival models from the
pycox library [ 14]. CI measures the fraction of patients with pre-
dicted survival time ranked in the correct order, amongst all patients
who can be ordered [ 45]. Each input for baseline models is a binary
vector∈{0,1}324representing the absence (0) or presence (1) of
5143Personalised Drug Identifier for Cancer Treatment with Transformers using Auxiliary Information KDD ’24, August 25–29, 2024, Barcelona, Spain
any mutation in a gene. All models are trained on same train set of
NSCLC and CRC datasets, which is divided into train, validation,
test splits (64:16:20) using same random seed in our experiment,
resulting in 1479 train, 370 validation and 463 test NSCLC/CRC
samples. As shown in Table 1, our method outperforms the second-
best DeepSurv method by 5.9%. We also explore the effect of using
annotated mutations as inputs to these baseline models (Table 5).
Table 1: Comparison of TransformerMTLR against survival
prediction baselines on NSCLC and CRC datasets.
Model Test CI Model Test CI
DeepSurv 0.5834 MTLR 0.5624
DeepHit 0.4841 PCHazard 0.3197
LogisticHazard 0.5121 PMF 0.5072
TransformerMTLR 0.6425
5.2 Comparison with state-of-the-art models
Table 2 shows the results obtained by PREDICT-AI and baseline DRP
models on three distinct drugs (5-Fluorouracil, Cisplatin, and Pacli-
taxel), with more than 80 (sample, drug) pairs in the TCGA dataset
and using the same train-test splits in [ 16]. This results in 3 random
80:20 splits with 503/504/502 train, 90/82/90 test TCGA (sample,
drug) pairs respectively. PREDICT-AI surpasses baselines in overall
prediction performance, as well as on 2 drugs. PREDICT-AI achieves
the highest overall evaluation scores, with 64.96% for AUROC
and 84.85% for AUPRC, outperforming the second-highest scores
achieved by DruID (62.36% for AUROC and 82.06% for AUPRC). On
Cisplatin and 5-Fluorouracil, PREDICT-AI achieves an improvement
of 4.99% and 6.57% for AUROC, and 3.96% and 0.72% for AUPRC
compared to the second-best performing method. The superior-
ity of PREDICT-AI in DRP over baseline models demonstrates the
advantages of our transformer-based approach of modeling input
sequences and use of auxiliary survival information.
5.3 Ablation Tests
To evaluate the effectiveness of our proposed model, we conduct an
ablation study to examine three specific components in PREDICT-AI :
one without the pre-training/ TransformerMTLR component (‘w/o
Pretrain ’), another without utilizing the cell-line/AUDRC predic-
tor (‘w/o Cell-line ’), and a third without the survival predictor in
TransformerDRP (‘w/o Survival ’). Figure 4 illustrates that the pre-
trained TransformerMTLR model contributes to enhancing the DRP
outcomes, e.g., the AUROC and AUPRC achieved by PREDICT-AI
without pretraining are 0.5774 and 0.8135, respectively, significantly
lower than the metrics obtained by PREDICT-AI . Besides, incorpo-
rating cell-line data for the AUDRC predictor and reintroducing
the survival predictor in TransformerDRP also contribute to the
DRP performance.6 Deployment in a Clinical Setting
Our Treatment Recommendation System has been deployed at
https://pharmacope.ai/. The backend architecture, described in Ap-
pendix A.2, processes the input PDF diagnostic panel reports, ex-
tracts the mutations therein, runs a DRP model and returns a list of
10 drugs with the best predicted RECIST probability scores along
with supporting evidence to the user interface.
6.1 User Interface
The interface, used by clinicians, shows the input set of mutations in
the patient genomic profile (Appendix Figure 7), the top 10 drug rec-
ommendations with their predicted scores, and supporting evidence
(Figure 5). As discussed earlier, in addition to these predictions, the
Molecular Tumor Board (MTB) requires multiple available sources
of information, which may be incomplete and indirect, to arrive at
the final treatment decision. Based on prior literature [ 46] and ex-
tensive discussion among us – computer scientists and oncologists
– we arrived at the following sources of information which have
been useful in the clinical decision-making process.
•Model explainability: Many Explainable AI (XAI) algorithms can
be used to provide model explainability [ 10]. E.g., feature im-
portance scores or attention scores can be used to highlight
important genes. While clinicians are aware that the predictions
are a result of complex series of computations, and XAI scores
may not be a faithful or complete representation of the model’s
inner working, these inputs may become useful starting points
for discussing potential targeted interventions.
•Auxiliary drug databases: Several publicly available portals such
as Pandrugs [ 37], collect information from multiple databases to
display known information on drug-gene associations. Such in-
formation can be used to assess the available level of evidence and
examine the biological plausibility of the drugs recommended,
based on patient cancer type and known drug targets.
•Drug-level validation across patients: For each predicted drug,
clinicians are interested in knowing the difference in the predic-
tion (for the input patient) to the predictions on a reference (or
validation) set of patients. The reference set is often chosen as a
cohort of patients of the same cancer type. Note that it is unla-
belled, i.e., without drug response or survival labels. E.g., in Fig. 5,
we see the distribution of predictions for each drug on a reference
dataset and the prediction on the input patient overlaid with an
asterisk. If the input patient’s prediction is an outlier (e.g., for
Fluvestrant), indicating an unusually good prediction vis-a-vis
the reference cohort, it highlights a drug that could be considered
further. This may be quantified with robust z-scores by subtract-
ing the median predicted score on the validation dataset and
dividing by the interquartile range.
•Patient-level validation across drugs: Lack of sufficient labelled
data during model training can result in, for some input patients,
very similar scores on all input drugs. In such cases, our confi-
dence in the predictions should be low. Hence, it is helpful to rule
out such cases by examining the distribution of predicted scores
of the patient, across all drugs, not just the top 10, as shown in
Fig. 8. This can also be quantified using z-scores.
5144KDD ’24, August 25–29, 2024, Barcelona, Spain Aishwarya Jayagopal et al.
Table 2: Experimental results comparing PREDICT-AI against extant DRP methods on 3 distinct drugs in TCGA patients. Best
scores are in bold, second-best scores are underlined. (%).
5-Fluorouracil Cisplatin Paclitaxel Overall
AUROC AUPRC AUROC AUPRC AUROC AUPRC AUROC AUPRC
CODE-AE 61.77(±11.63) 88.02(±4.85) 38.09(±16.34) 71.88(±8.46) 44.83(±15.08) 74.68(±5.11) 47.15(±7.82) 73.74(±6.90)
TCRP 48.39(±11.96) 77.87(±9.49) 50.86(±16.75) 79.60(±10.73) 60.66(±24.22) 78.69(±16.73) 47.36(±3.26) 75.70(±4.03)
TUGDA 58.39(±16.94) 83.40(±7.69) 37.47(±4.36) 72.07(±3.75) 41.13(±18.28) 71.67(±1.03) 46.18(±3.18) 75.42(±2.22)
Velodrome 50.91(±19.54) 79.08(±15.04) 48.61(±9.73) 78.80(±7.97) 63.26(±26.45) 80.02(±16.34) 52.56(±4.93) 77.62(±0.48)
DruID 64.73(±8.73) 85.55(±6.43) 67.38(±10.63) 86.30(±7.35) 63.43(±4.97) 82.55(±6.83) 62.36(±3.60) 82.06(±5.02)
PREDICT-AI 71.30(±3.87) 88.74(±2.82) 72.37(±10.10) 90.26 (±4.68) 62.19(±9.42) 81.08(±8.02) 64.96(±4.50) 84.85(±4.02)
Figure 4: Effects of individual components in the PREDICT-AI model.
Figure 5: Left panel shows mutations present in patient ge-
nomic profile. Middle and right panels displays top 10 rec-
ommendations with supporting evidence as boxplots.
6.2 Clinical Treatment Planning Process
Evaluating the drugs predicted by a DRP model in the face of insuf-
ficient clinical validation is a non-trivial and challenging problem.
Retrospective evaluation on clinical datasets (e.g., on TCGA, Table
2), remains limited since the number of possible combinations of
mutations is exponentially large. Hence, such evaluation, although
a necessary first step, is insufficient to ensure that the predicted
drug will be effective when used on an unseen patient. A clinical
trial of the DRP model itself can be done, which also would yield
limited data due to the same reasons. Moreover, during such a trial,
the choice of drug to be administered to an enrolled patient is not
straightforward – a problem which will also arise when the system
is deployed for routine clinical use.A clinical trial is ongoing for our treatment recommendation
system at the National University Hospital, Singapore [ 6]. Before
commencing the trial, an important validation for our DRP model
was the presence of cancer type-specific standard-of-care drugs
among the top predicted drugs on test patients, e.g., 5-Fluorouracil,
Oxaliplatin, Irinotecan in colorectal cancer, and Cisplatin, Pacli-
taxel in ovarian cancer. This led to clinicians gaining confidence
in our model. These drugs may not always be the topmost in the
recommended list, as the model learns from only mutations and
drug response in cell lines and patient data. Thus, it was important
to display higher number of recommendations and we chose 10.
The decision of the most appropriate drug for a patient, is taken
in a collective manner involving all members of the MTB. An im-
portant lesson learnt before and during the trial was that many
additional sources of information are required by the MTB to make
the final treatment decision. The top 10 recommendations and
supporting evidence (Section 6.1) from various sources are used
together for decision making. Further, patient-specific details are
considered such as possibility of side-effects, avoiding drugs that
caused a disease progression in earlier treatment cycles.
6.3 Ethical Considerations
Several ethical considerations must be accounted for in the deploy-
ment of such clinical treatment recommendation systems, such as
biases, transparency, interpretability, privacy, algorithmic fairness,
safety and accountability. Limited training data may lead to biases,
which may be addressed with methods such as intra-processing [ 40],
and RTO [ 1]. Obtaining patient consent prior to treatment [ 9], mak-
ing data and models public, communicating algorithmic details to
clinicians and comparison with SOTA enable transparency [ 44].
5145Personalised Drug Identifier for Cancer Treatment with Transformers using Auxiliary Information KDD ’24, August 25–29, 2024, Barcelona, Spain
XAI and supporting evidence from literature can help interpret
results in decision making. Privacy concerns may be alleviated by
various measures such as preventing unauthorized data access by
users, de-identification of patient data and appropriate data shar-
ing practices e.g., federated learning, across centers. Algorithmic
fairness can be evaluated using counterfactual or equal opportu-
nity metrics [ 60]. Fairness for edge cases like different train-test
data distribution can be handled partially by fine tuning, especially
when the test population is known in advance. Clinical trials and
analysis of recommendations in MTB before administration, partly
ensures safety. Accountability is achieved by testing TRS prior to de-
ployment, conducting clinical trials, educating clinicians on usage
and monitoring performance post deployment [ 58]. In our current
deployment, we have ensured some of the above (e.g., obtaining
patient consent, communicating with clinicians about the model,
auditing logs on TRS) with the remaining currently underway.
7 Conclusion
We design a new cancer drug response prediction (DRP) model,
PREDICT-AI , which predicts the efficacy of a given drug on a pa-
tient’s mutation profile from clinical diagnostic panels. PREDICT-AI
faithfully models the sequential structure of input mutations us-
ing transformers. Further, it effectively utilizes auxiliary patient
survival information for training. These modeling steps address
limitations of extant models and lead to improved performance on
benchmark data compared to state-of-the-art alternatives.
We present the architecture of a treatment recommendation sys-
tem (TRS) which internally uses DRP models. The TRS is deployed
in a cancer-specific clinical setting – a Molecular Tumour Board
(MTB) whose members collectively makes treatment decisions. We
discuss the technical and clinical considerations required to make
treatment decisions in this challenging scenario where validation
of the predictions from any DRP model is difficult to obtain. In par-
ticular, we present various forms of indirect supporting evidence
which were found to be useful in building clinician’s trust in the
model as well as in making the final choice of a suitable drug.
Our work opens several avenues for future research. Other mod-
eling approaches that build on PREDICT-AI may be investigated,
e.g., other forms of tokenization, survival analysis and multi-task
learning. The use of additional unlabelled data during pre-training
and various forms of attention-based explainability can be explored.
A limitation of our work, which can be addressed in the future, is
that it does not model rearrangement-based alterations which are
also available in diagnostic panels. Finally, more work can be done
on designing methods and systems that can integrate information
from DRP models and auxiliary sources of information to effectively
faciliate collective decision-making in MTBs.
Acknowledgments
We wish to thank Renie Ravin for his invaluable support in build-
ing the PharmacopeAI UI and guidance on deployment best prac-
tices. We would like to acknowledge the American Association for
Cancer Research in the development of the AACR Project GENIE
registry, as well as members of the consortium for their commit-
ment to data sharing. Images were generated using Flaticon. This
research is funded by the National Research Foundation, Singaporeunder its AI Singapore Programme (AISG Award No: AISG-100E-
2023-116) and the Cancer Science Institute of Singapore internal
funding. Aishwarya Jayagopal is supported by the National Uni-
versity of Singapore Research Scholarship. David Shao Peng Tan is
supported by funding from the National Medical Research Coun-
cil (NMRC) Clinician Scientist Award Senior Investigator Grant
(CSASI21jun-0003), Pangestu Family Foundation Gynaecological
Cancer Research Fund. Anand D. Jeyasekharan is supported by
the Ministry of Health, Singapore, through the NMRC Clinician
Scientist Award (MOH-CSAINV20nov-0010).
References
[1]Ibrahim M Alabdulmohsin and Mario Lucic. 2021. A near-optimal algorithm
for debiasing trained machine learning models. Advances in Neural Information
Processing Systems 34 (2021), 8072–8084.
[2]Pavla Brachova, Kristina W Thiel, and Kimberly K Leslie. 2013. The consequence
of oncomorphic TP53 mutations in ovarian cancer. International journal of
molecular sciences 14, 9 (2013), 19257–19275.
[3]Marc Buyse, Tomasz Burzykowski, Kevin Carroll, Stefan Michiels, Daniel J Sar-
gent, Langdon L Miller, Gary L Elfring, Jean-Pierre Pignon, and Pascal Piedbois.
2007. Progression-free survival is a surrogate for survival in advanced colorectal
cancer. Journal of clinical oncology 25, 33 (2007), 5218–5224.
[4]Ethan Cerami, Jianjiong Gao, Ugur Dogrusoz, Benjamin E Gross, Selcuk Onur
Sumer, Bülent Arman Aksoy, Anders Jacobsen, Caitlin J Byrne, Michael L Heuer,
Erik Larsson, et al .2012. The cBio cancer genomics portal: an open platform for
exploring multidimensional cancer genomics data. Cancer discovery 2, 5 (2012),
401–404.
[5]Noura J Choudhury, Jessica A Lavery, Samantha Brown, Ino de Bruijn, Justin Jee,
Thinh Ngoc Tran, Hira Rizvi, Kathryn C Arbour, Karissa Whiting, Ronglai Shen,
et al.2023. The GENIE BPC NSCLC Cohort: A Real-World Repository Integrating
Standardized Clinical and Genomic Data for 1,846 Patients with Non–Small Cell
Lung Cancer. Clinical Cancer Research 29, 17 (2023), 3418–3428.
[6]ClinicalTrials.gov. 2023. Neural Network-based Treatment Decision Support Tool in
Patients With Refractory Solid Organ Malignancies (DRUID). Retrieved February
7, 2024 from https://clinicaltrials.gov/study/NCT05719428
[7]Chiara Corti, Marisa Cobanaj, Edward C Dee, Carmen Criscitiello, Sara M Tolaney,
Leo A Celi, and Giuseppe Curigliano. 2023. Artificial intelligence in cancer
research and precision medicine: Applications, limitations and priorities to drive
transformation in the delivery of equitable and unbiased care. Cancer Treatment
Reviews 112 (2023), 102498.
[8]David R Cox. 1972. Regression models and life-tables. Journal of the Royal
Statistical Society: Series B (Methodological) 34, 2 (1972), 187–202.
[9]Bouchra Derraz, Gabriele Breda, Christoph Kaempf, Franziska Baenke, Fabienne
Cotte, Kristin Reiche, Ulrike Köhl, Jakob Nikolas Kather, Deborah Eskenazy,
and Stephen Gilbert. 2024. New regulatory thinking is needed for AI-based
personalised drug and cell therapies in precision oncology. NPJ Precision Oncology
8, 1 (2024), 23.
[10] Rudresh Dwivedi, Devam Dave, Het Naik, Smiti Singhal, Rana Omer, Pankesh
Patel, Bin Qian, Zhenyu Wen, Tejal Shah, Graham Morgan, et al .2023. Explainable
AI (XAI): Core ideas, techniques, and solutions. Comput. Surveys 55, 9 (2023),
1–33.
[11] Stephane Fotso. 2018. Deep neural networks for survival analysis based on a
multi-task framework. arXiv preprint arXiv:1801.05512 (2018).
[12] Michael F Gensheimer and Balasubramanian Narasimhan. 2019. A scalable
discrete-time survival model for neural networks. PeerJ 7 (2019), e6257.
[13] Mahmoud Ghandi, Franklin W Huang, Judit Jané-Valbuena, Gregory V Kryukov,
Christopher C Lo, E Robert McDonald III, Jordi Barretina, Ellen T Gelfand, Craig M
Bielski, Haoxin Li, et al .2019. Next-generation characterization of the cancer
cell line encyclopedia. Nature 569, 7757 (2019), 503–508.
[14] Sarthak Pati Haavard Kvamme, Brian Hart and Nikolai Sellereite. 2022. Survival
analysis with PyTorch. Retrieved February 8, 2024 from https://github.com/
havakv/pycox
[15] Di He, Qiao Liu, You Wu, and Lei Xie. 2022. A context-aware deconfounding
autoencoder for robust prediction of personalized clinical drug response from
cell-line compound screening. Nature Machine Intelligence 4, 10 (2022), 879–892.
[16] Aishwarya Jayagopal, Robert J Walsh, Krishna Kumar Hariprasannan, Ragu-
nathan Mariappan, Debabrata Mahapatra, Patrick William Jaynes, Diana Lim,
David Shao Peng Tan, Tuan Zea Tan, Jason J Pitt, et al .2023. A multi-task domain-
adapted model to predict chemotherapy response from mutations in recurrently
altered cancer genes. medRxiv (2023), 2023–11.
[17] Yanrong Ji, Zhihan Zhou, Han Liu, and Ramana V Davuluri. 2021. DNABERT:
pre-trained Bidirectional Encoder Representations from Transformers model for
DNA-language in genome. Bioinformatics 37, 15 (2021), 2112–2120.
5146KDD ’24, August 25–29, 2024, Barcelona, Spain Aishwarya Jayagopal et al.
[18] Peilin Jia, Ruifeng Hu, Guangsheng Pei, Yulin Dai, Yin-Ying Wang, and Zhong-
ming Zhao. 2021. Deep generative neural network for accurate drug response
imputation. Nature communications 12, 1 (2021), 1740.
[19] Likun Jiang, Changzhi Jiang, Xinyu Yu, Rao Fu, Shuting Jin, and Xiangrong Liu.
2022. DeepTTA: a transformer-based model for predicting cancer drug response.
Briefings in bioinformatics 23, 3 (2022), bbac100.
[20] Edward L Kaplan and Paul Meier. 1958. Nonparametric estimation from incom-
plete observations. Journal of the American statistical association 53, 282 (1958),
457–481.
[21] Jared L Katzman, Uri Shaham, Alexander Cloninger, Jonathan Bates, Tingting
Jiang, and Yuval Kluger. 2018. DeepSurv: personalized treatment recommender
system using a Cox proportional hazards deep neural network. BMC medical
research methodology 18, 1 (2018), 1–12.
[22] Tadayuki Kou, Masashi Kanai, Shigemi Matsumoto, Yasushi Okuno, and Manabu
Muto. 2016. The possibility of clinical sequencing in the management of cancer.
Japanese Journal of Clinical Oncology 46, 5 (2016), 399–406.
[23] Håvard Kvamme and Ørnulf Borgan. 2019. Continuous and discrete-time survival
prediction with neural networks. arXiv preprint arXiv:1910.06724 (2019).
[24] Melissa J Landrum, Jennifer M Lee, Mark Benson, Garth R Brown, Chen Chao,
Shanmuga Chitipiralla, Baoshan Gu, Jennifer Hart, Douglas Hoffman, Wonhee
Jang, et al .2018. ClinVar: improving access to variant interpretations and sup-
porting evidence. Nucleic acids research 46, D1 (2018), D1062–D1067.
[25] Changhee Lee, William Zame, Jinsung Yoon, and Mihaela Van Der Schaar. 2018.
Deephit: A deep learning approach to survival analysis with competing risks. In
Proceedings of the AAAI conference on artificial intelligence, Vol. 32.
[26] Seungyeoun Lee and Heeju Lim. 2019. Review of statistical methods for survival
analysis using genomic data. Genomics & informatics 17, 4 (2019).
[27] Ginny XH Li, Dan Munro, Damian Fermin, Christine Vogel, and Hyungwon
Choi. 2020. A protein-centric approach for exome variant aggregation enables
sensitive association analysis with clinical outcomes. Human mutation 41, 5
(2020), 934–945.
[28] Claudio Luchini, Rita T Lawlor, Michele Milella, and Aldo Scarpa. 2020. Molecular
tumor boards in clinical practice. Trends in Cancer 6, 9 (2020), 738–744.
[29] Jianzhu Ma, Samson H Fong, Yunan Luo, Christopher J Bakkenist, John Paul Shen,
Soufiane Mourragui, Lodewyk FA Wessels, Marc Hafner, Roded Sharan, Jian Peng,
et al.2021. Few-shot learning creates predictive models of drug response that
translate from high-throughput screens to individual patients. Nature Cancer 2,
2 (2021), 233–244.
[30] Coren A Milbury, James Creeden, Wai-Ki Yip, David L Smith, Varun Pattani, Kristi
Maxwell, Bethany Sawchyn, Ole Gjoerup, Wei Meng, Joel Skoletsky, et al .2022.
Clinical and analytical validation of FoundationOne® CDx, a comprehensive
genomic profiling assay for solid tumors. PLoS One 17, 3 (2022), e0264138.
[31] Mirja Mittermaier, Marium Raza, and Joseph C Kvedar. 2023. Collaborative
strategies for deploying AI-based physician decision support systems: challenges
and deployment approaches. npj Digital Medicine 6, 1 (2023), 137.
[32] Harry L Morgan. 1965. The generation of a unique machine description for
chemical structures-a technique developed at chemical abstracts service. Journal
of chemical documentation 5, 2 (1965), 107–113.
[33] Soufiane Mourragui, Marco Loog, Mark A Van De Wiel, Marcel JT Reinders, and
Lodewyk FA Wessels. 2019. PRECISE: a domain adaptation approach to transfer
predictors of drug response from pre-clinical models to tumors. Bioinformatics
35, 14 (2019), i510–i519.
[34] Eric Nguyen, Michael Poli, Marjan Faizi, Armin Thomas, Michael Wornow, Cal-
lum Birch-Sykes, Stefano Massaroli, Aman Patel, Clayton Rabideau, Yoshua
Bengio, et al .2024. Hyenadna: Long-range genomic sequence modeling at sin-
gle nucleotide resolution. Advances in neural information processing systems 36
(2024).
[35] Alexander Partin, Thomas S Brettin, Yitan Zhu, Oleksandr Narykov, Austin
Clyde, Jamie Overbeek, and Rick L Stevens. 2023. Deep learning methods for
drug response prediction in cancer: predominant and emerging trends. Frontiers
in medicine 10 (2023), 1086097.
[36] Rafael Peres da Silva, Chayaporn Suphavilai, and Niranjan Nagarajan. 2021.
TUGDA: task uncertainty guided domain adaptation for robust generalization of
cancer drug response prediction from in vitro to in vivo settings. Bioinformatics
37, Supplement_1 (2021), i76–i83.
[37] Elena Piñeiro-Yáñez, Miguel Reboiro-Jato, Gonzalo Gómez-López, Javier Perales-
Patón, Kevin Troulé, José Manuel Rodríguez, Héctor Tejero, Takeshi Shimamura,
Pedro Pablo López-Casas, Julián Carretero, et al .2018. PanDrugs: a novel method
to prioritize anticancer drug treatments according to individual genomic data.
Genome medicine 10 (2018), 1–11.
[38] D Planchard, ST Popat, K Kerr, S Novello, EF Smit, Corinne Faivre-Finn, TS Mok,
M Reck, PE Van Schil, MD Hellmann, et al .2018. Metastatic non-small cell lung
cancer: ESMO Clinical Practice Guidelines for diagnosis, treatment and follow-up.
Annals of Oncology 29 (2018), iv192–iv237.
[39] Tijana Randic, Stefano Magni, Demetra Philippidou, Christiane Margue, Kamil
Grzyb, Jasmin Renate Preis, Joanna Patrycja Wroblewska, Petr V Nazarov, Michel
Mittelbronn, Katrin BM Frauenknecht, et al .2023. Single-cell transcriptomics of
NRAS-mutated melanoma transitioning to drug resistance reveals P2RX7 as anindicator of early drug response. Cell Reports 42, 7 (2023).
[40] Yash Savani, Colin White, and Naveen Sundar Govindarajulu. 2020. Intra-
processing methods for debiasing neural networks. Advances in neural informa-
tion processing systems 33 (2020), 2798–2810.
[41] Matthias Schmid, Marvin N Wright, and Andreas Ziegler. 2016. On the use of
Harrell’s C for clinical risk prediction via random survival forests. Expert Systems
with Applications 63 (2016), 450–459.
[42] Hossein Sharifi-Noghabi, Parsa Alamzadeh Harjandi, Olga Zolotareva, Colin C
Collins, and Martin Ester. 2021. Out-of-distribution generalization from labelled
and unlabelled gene expression data for drug response prediction. Nature Machine
Intelligence 3, 11 (2021), 962–972.
[43] Hossein Sharifi-Noghabi, Shuman Peng, Olga Zolotareva, Colin C Collins, and
Martin Ester. 2020. AITL: adversarial inductive transfer learning with input and
output space adaptation for pharmacogenomics. Bioinformatics 36, Supplement_1
(2020), i380–i388.
[44] Aubrey A Shick, Christina M Webber, Nooshin Kiarashi, Jessica P Weinberg,
Aneesh Deoras, Nicholas Petrick, Anindita Saha, and Matthew C Diamond. 2024.
Transparency of artificial intelligence/machine learning-enabled medical devices.
NPJ Digital Medicine 7, 1 (2024), 21.
[45] Harald Steck, Balaji Krishnapuram, Cary Dehing-Oberije, Philippe Lambin, and
Vikas C Raykar. 2007. On ranking in survival analysis: Bounds on the concordance
index. Advances in neural information processing systems 20 (2007).
[46] David Tamborero, Rodrigo Dienstmann, Maan Haj Rachid, Jorrit Boekel, Adria
Lopez-Fernandez, Markus Jonsson, Ali Razzak, Irene Braña, Luigi De Petris,
Jeffrey Yachnin, et al .2022. The Molecular Tumor Board Portal supports clinical
decisions and automated reporting for precision oncology. Nature cancer 3, 2
(2022), 251–261.
[47] Yifeng Tao, Chunhui Cai, William W Cohen, and Xinghua Lu. 2019. From genome
to phenome: Predicting multiple cancer phenotypes based on somatic genomic
alterations via the genomic impact transformer. In PACIFIC SYMPOSIUM ON
BIOCOMPUTING 2020. World Scientific, 79–90.
[48] Patrick Therasse, Susan G Arbuck, Elizabeth A Eisenhauer, Jantien Wanders,
Richard S Kaplan, Larry Rubinstein, Jaap Verweij, Martine Van Glabbeke, Allan T
van Oosterom, Michaele C Christian, et al .2000. New guidelines to evaluate the
response to treatment in solid tumors. Journal of the National Cancer Institute 92,
3 (2000), 205–216.
[49] Apostolia M Tsimberidou, Michael Kahle, Henry Hiep Vo, Mehmet A Baysal, Am-
ber Johnson, and Funda Meric-Bernstam. 2023. Molecular tumour boards—current
and future considerations for precision oncology. Nature Reviews Clinical Oncol-
ogy20, 12 (2023), 843–863.
[50] Eric Van Cutsem, B Nordlinger, and A Cervantes. 2010. Advanced colorectal
cancer: ESMO Clinical Practice Guidelines for treatment. Annals of oncology 21
(2010), v93–v97.
[51] Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones,
Aidan N Gomez, Łukasz Kaiser, and Illia Polosukhin. 2017. Attention is all
you need. Advances in neural information processing systems 30 (2017).
[52] Adam Wahida, Lars Buschhorn, Stefan Fröhling, Philipp J Jost, Andreas
Schneeweiss, Peter Lichter, and Razelle Kurzrock. 2023. The coming decade
in precision oncology: six riddles. Nature Reviews Cancer 23, 1 (2023), 43–54.
[53] Ching-Yu Wang, Changxia Shao, Alicia C McDonald, Mayur M Amonkar, Wei
Zhou, Edward A Bortnichak, and Xinyue Liu. 2023. Evaluation and Comparison
of Real-World Databases for Conducting Research in Patients With Colorectal
Cancer. JCO Clinical Cancer Informatics 7 (2023), e2200184.
[54] Kai Wang, Mingyao Li, and Hakon Hakonarson. 2010. ANNOVAR: functional
annotation of genetic variants from high-throughput sequencing data. Nucleic
acids research 38, 16 (2010), e164–e164.
[55] Ping Wang, Yan Li, and Chandan K Reddy. 2019. Machine learning for survival
analysis: A survey. ACM Computing Surveys (CSUR) 51, 6 (2019), 1–36.
[56] Bo Wei, John Kang, Miho Kibukawa, Gladys Arreaza, Maureen Maguire, Lei
Chen, Ping Qiu, Lixin Lang, Deepti Aurora-Garg, Razvan Cristescu, et al .2022.
Evaluation of the trusight oncology 500 assay for routine clinical testing of tumor
mutational burden and clinical utility for predicting response to pembrolizumab.
The Journal of Molecular Diagnostics 24, 6 (2022), 600–608.
[57] John N Weinstein, Eric A Collisson, Gordon B Mills, Kenna R Shaw, Brad A
Ozenberger, Kyle Ellrott, Ilya Shmulevich, Chris Sander, and Joshua M Stuart.
2013. The cancer genome atlas pan-cancer analysis project. Nature genetics 45,
10 (2013), 1113–1120.
[58] Jenna Wiens, Suchi Saria, Mark Sendak, Marzyeh Ghassemi, Vincent X Liu, Finale
Doshi-Velez, Kenneth Jung, Katherine Heller, David Kale, Mohammed Saeed, et al .
2019. Do no harm: a roadmap for responsible machine learning for health care.
Nature medicine 25, 9 (2019), 1337–1340.
[59] Michelle K Wilson, Deborah Collyar, Diana T Chingos, Michael Friedlander,
Tony W Ho, Katherine Karakasis, Stan Kaye, Mahesh KB Parmar, Matthew R
Sydes, Ian F Tannock, et al .2015. Outcomes and endpoints in cancer trials:
bridging the divide. The lancet oncology 16, 1 (2015), e43–e52.
[60] Jie Xu, Yunyu Xiao, Wendy Hui Wang, Yue Ning, Elizabeth A Shenkman, Jiang
Bian, and Fei Wang. 2022. Algorithmic fairness in computational medicine.
EBioMedicine 84 (2022).
5147Personalised Drug Identifier for Cancer Treatment with Transformers using Auxiliary Information KDD ’24, August 25–29, 2024, Barcelona, Spain
[61] Wanjuan Yang, Jorge Soares, Patricia Greninger, Elena J Edelman, Howard Light-
foot, Simon Forbes, Nidhi Bindal, Dave Beare, James A Smith, I Richard Thompson,
et al.2012. Genomics of Drug Sensitivity in Cancer (GDSC): a resource for thera-
peutic biomarker discovery in cancer cells. Nucleic acids research 41, D1 (2012),
D955–D961.
[62] Chun-Nam Yu, Russell Greiner, Hsiu-Chin Lin, and Vickie Baracos. 2011. Learn-
ing patient-specific cancer survival distributions as a sequence of dependent
regressors. Advances in neural information processing systems 24 (2011).
[63] Ahmet Zehir, Ryma Benayed, Ronak H Shah, Aijazuddin Syed, Sumit Middha,
Hyunjae R Kim, Preethi Srinivasan, Jianjiong Gao, Debyani Chakravarty, Sean M
Devlin, et al .2017. Mutational landscape of metastatic cancer revealed from
prospective clinical sequencing of 10,000 patients. Nature medicine 23, 6 (2017),
703–713.
A Supplementary Material
Algorithm 1: ThePREDICT-AI algorithm.
Data: Survival dataP𝐶𝑅𝐶 ,P𝑁𝑆𝐶𝐿𝐶 ; TCGA patient samples P𝑇𝐶𝐺𝐴 ; cell
line dataP𝐶𝐿; initialization parameters;
Result: Drug response prediction results ˆ𝑌.
1//Module 1: TransformerMTLR
2S←{𝑡𝑖}𝑁
1//Framing the multi-task learning problem
3for𝑒∈epochs do
4 for𝑏∈Batches𝑖𝑛{P𝑁𝑆𝐶𝐿𝐶,P𝐶𝑅𝐶}do
5 ¯𝑋←transformer(𝑋𝐺||𝑋𝑀)//Learning genes and
mutation representations using transformer
6 ¯𝑋𝐷←MLP Drug(𝑋𝐷)//Learning drug representations
using MLP
7 ˆ𝑆←MLP(¯𝑋||¯𝑋𝐷)//MTLR predictor
8L𝑆←Equation (2) // Loss for survival prediction
9 end
10end
11//Module 2: TransformerDRP
12transformer, MLP Drug←Load(*) // Pretrained models
13for𝑒∈epochs do
14 for𝑏∈Batches in{P𝑁𝑆𝐶𝐿𝐶,P𝑇𝐶𝐺𝐴,P𝐶𝐿}do
15L𝑆←TransformerMTLR(P𝑁𝑆𝐶𝐿𝐶 ) //Survival Prediction
16 //AUDRC Prediction: P𝐶𝐿
17 ¯𝑋,¯𝑋𝐷←transformer(𝑋𝐺||𝑋𝑀),MLP Drug(𝑋𝐷)
18 ˆ𝑌←MLP(¯𝑋||¯𝑋𝐷)
19L𝐶←Equation (8) // Loss for AUDRC prediction
20 //RECIST Prediction: P𝑇𝐶𝐺𝐴
21 ¯𝑋,¯𝑋𝐷←transformer(𝑋𝐺||𝑋𝑀),MLP Drug(𝑋𝐷)
22 ˆ𝑅←MLP(¯𝑋||¯𝑋𝐷)
23L𝑅←Equation (7) // Loss for RECIST prediction
24 end
25L←L𝑆+L𝑅+L𝐶//Jointly train 3 loss functions
26end
A.1 Data Processing
In cell lines, we consider only labelled samples with a documented
AUDRC score, resulting in 689 samples. In the TCGA dataset, we
only consider the samples belonging to the following projects/cancer
types - LUAD, STAD, HNSC, SKCM, BLCA, UCEC, COAD, LUSC,
BRCA, CESC. We also restrict our analysis to a set of drugs (Cis-
platin, Paclitaxel, 5-Fluorouracil, Gemcitabine, Docetaxel, Cyclophos-
phamide) administered to more than 50 TCGA samples. The result-
ing set of 470 TCGA patients have a documented RECIST response.
In the GENIE BPC CRC dataset, we extract the progression-free
survival duration as the time between the start of the first line
of treatment and the subsequent progression, according to the
medical oncologist’s assessment. We obtain this information for
5-Fluorouracil, resulting in 822 CRC samples with documented PFS
values. A similar analysis on the GENIE BPC NSCLC v2.0-public
dataset resulted in 900 patients (i.e. 1490 samples) with documented
PFS values for 16 drugs. Details of the output labels across eachdataset is provided in Table 3. The model performance is eval-
uated on 5-Fluorouracil, Cisplatin and Paclitaxel with 43, 49, 37
non-responders and 82, 157, 76 responders respectively per drug.
Table 3: Dataset details used in patient and cell line domains. Numbers(#)
indicate train/test in split 0, S: sample, D: drugs
Domain Dataset Response Range #samples #(S,D) pairs
Cell lines CCLE AUDRC [0,1] 551/138 2894/738
Patients TCGA RECIST {0, 1} 376/84 503/90
CRC PFS days 822 822
NSCLC PFS days 1490 1490
A.2 Backend Architecture
Here, we describe the backend architecture (Figure 6) of the TRS
used to deploy a DRP model. Our deployment has been set up on
an Amazon LightSail instance, which serves requests from web
clients. These requests are handled by an NGINX reverse proxy,
which also does SSL termination. Calls from the user interface (de-
scribed in Section 6.1) are made via API calls served by a Flask
application. This application also uses a Gunicorn HTTP server.
The API call to obtain recommendations is invoked with the set of
patient mutations provided as inputs. FoundationOne reports may
also be directly used as inputs – the PDF is parsed to extract out
mutation information. The input mutations are first validated to
ensure proper formatting, followed by feature generation (anno-
tations or other strategies based on the DRP model inputs). These
are then passed through the DRP model for inference on a set of
70 drugs approved for clinical use in Singapore. Drugs with top 10
predicted scores are provided along with supporting evidence (as
described in 6.1) to the user interface. Minimal unit-testing of the
API endpoints is achieved through pytest. The deployment can be
accessed at https://pharmacope.ai/.
Figure 6: Backend Architecture of TRS
A.3 Implementation
The representation dimension is empirically fixed at 64. The learn-
ing rate varies from 0.0001 to 0.05. Epochs range from 100 to 500,
with a default dropout value of 0.1. Batch sizes are selected from
the range [128, 256, 512]. Our model offers two optional optimizers:
Adam and SGD. The default number of attention heads is set to 8.
All codes, data and experimental settings of the model are released
at https://github.com/CDAL-SOC/PREDICT-AI.
A.4 Time Complexity Analysis
We examine the time complexity of PREDICT-AI based on the
algorithm in Sec. A. Our proposed method scales linearly with an
increase in the number of tasks. If 𝑛tasks are jointly trained, time
5148KDD ’24, August 25–29, 2024, Barcelona, Spain Aishwarya Jayagopal et al.
complexity is 𝑂(𝑛), since weight updates happen on LS,LCand
LR. For𝑒epochs,𝑏batches, it is 𝑂(𝑒𝑏𝑛). We compared runtimes
of the joint training strategy in PREDICT-AI against training it in a
step-wise manner, where the transformer is trained with survival
information, followed by AUDRC prediction and lastly RECIST
prediction. We observe similar runtimes with PREDICT-AI having
a slight improvement in AUROC and AUPRC, for 300 epochs(early
stopping) and 256 batch size (Table 4).
Table 4: Runtime in minutes and maximum GPU memory usage in GB (Max
Mem) for joint and step-wise training.
Strategy AUROC AUPRC Max Mem Runtime
Joint 64.96 (±4.50) 84.85 (±4.02) 19.7 21.8
Step-wise 63.24 (±4.78) 83.88 (±5.23) 14.3 22.1
A.5 Additional Baseline Models Comparison
We compare the test concordance indices of baseline models using
binary (BIN324) and annotated input on CRC dataset, divided into
train, validation, test segmentation (64:16:20). The results (Table 5)
show that compared with the binary input, the mutation auxiliary
information has no obvious strengthening effect on the model.
Table 5: Comparison of binary BIN324 and annotated inputs on baseline mod-
els for CRC survival prediction (DS: DeepSurv, DH: DeepHit, LH: LogisticHaz-
ard, PC: PCHazard)
Model DS DH LH MTLR PC PMF
BIN324 0.4747 0.5307 0.5069 0.5061 0.5410 0.5027
Annotated 0.5127 0.4659 0.5251 0.4722 0.4895 0.4697
A.6 Performance Across Cancer Types
Table 6 shows performance of test TCGA samples across cancer
types with most number of samples, gender and race. We combine
all 3 test splits to calculate AUROC and AUPRC across each category.
Patient demographics were obtained from the TCGA GDC portal.
Table 6: Performance measured across subsets of TCGA test dataset, with
respect to cancer type, gender and race.
Cancer Type BRCA BLCA STAD CESC
AUROC 0.7298 0.5238 0.6379 0.619
AUPRC 0.8281 0.916 0.8407 0.6493
Race White Black Asian Unreported
AUROC 0.6253 0.7624 0.7778 0.593
AUPRC 0.8315 0.923 0.9468 0.8231
Gender Female Male
AUROC 0.6168 0.6549
AUPRC 0.8639 0.8068A.7 Alternate Drug Representation
We evaluated the performance of our model with drug embeddings
obtained from a Graph Convolutional Network (GCN) with average
readout. Each SMILES string was encoded as a graph, with atoms
as nodes and bonds as links using the PySmiles package. The GCN
(with parametric ReLU activation) generated 64-dim node represen-
tations, which were then averaged to obtain a 64-dim graph level(i.e.
drug level) representation. This GCN was used to replace the drug
embedding MLP in PREDICT-AI. The GCN layer and PREDICT-AI
network were trained end to end in both the pre-training and DRP
stages. Results across 3 test splits are summarized in Table 7. We
observe that use of GCN leads to a reduction in mean AUROC and
AUPRC for Cisplatin and 5-Fluorouracil. In Paclitaxel, although
there is an improvement in mean AUROC and AUPRC, the stan-
dard deviation in values is higher across splits. Thus, we see no
significant improvement with the use of GCN in our dataset. This
may be due to the high capacity of GNNs, which requires more
data to train. A potential way to alleviate this may be the use of
pretrained GCNs trained on large molecular datasets, which can be
explored in the future.
Table 7: Comparison of PREDICT-AI with MLP and with GCN for drug repre-
sentation learning.
Drug With MLP With GCN
AUROC
Cisplatin 0.7237(±0.101) 0.5229(±0.0691)
Paclitaxel 0.6219(±0.0942) 0.6571( ±0.1804)
5-Fluorouracil 0.713(±0.0387) 0.5135(±0.1362)
AUPRC
Cisplatin 0.9026(±0.0468) 0.8316(±0.012)
Paclitaxel 0.8108(±0.0802) 0.8475( ±0.1009)
5-Fluorouracil 0.8874(±0.0282) 0.8189( ±0.0516)
Figure 7: Patient genomic profile fed as input to TRS.
Figure 8: Swarmplot of predicted scores across approved drugs for a test patient.
5149