Counteracting Duration Bias in Video Recommendation via
Counterfactual
Watch Time
Haiyuan Zhao∗
School of Information
Renmin University of China
Beijing, China
haiyuanzhao@ruc.edu.cnGuohao Cai∗
Huawei Noah’s Ark Lab
Shenzhen, China
caiguohao1@huawei.comJieming Zhu
Huawei Noah’s Ark Lab
Shenzhen, China
jiemingzhu@ieee.org
Zhenhua Dong
Huawei Noah’s Ark Lab
Shenzhen, China
dongzhenhua@huawei.comJun Xu†
Gaoling School of Artificial Intelligence
Renmin University of China
Beijing, China
junxu@ruc.edu.cnJi-Rong Wen
Gaoling School of Artificial Intelligence
Renmin University of China
Beijing, China
jrwen@ruc.edu.cn
Abstract
In video recommendation, an ongoing effort is to satisfy users’ per-
sonalizedinformationneedsbyleveragingtheirloggedwatchtime.
However, watch time prediction suffers from duration bias, hinder-
ing its ability to reflect users’ interests accurately. Existing label-
correctionapproachesattempttouncoveruserintereststhrough
grouping and normalizing observed watch time according to video
duration.Althougheffectivetosomeextent,wefoundthatthese
approachesregardcompletelyplayedrecords(i.e.,auserwatches
theentirevideo)asequallyhighinterest,whichdeviatesfromwhat
weobservedonrealdatasets:usershavevariedexplicitfeedback
proportionwhencompletelyplayingvideos.Inthispaper,wein-
troducethe counterfactualwatch time (CWT),the potentialwatch
timeauserwouldspendonthevideoifitsdurationissufficiently
long.Analysisshowsthatthedurationbiasiscausedbythetrun-
cation of CWT due to the video duration limitation, which usually
occurs onthose completely playedrecords. Besides, aCounterfac-
tual Watch Model(CWM) is proposed, revealing that CWT equals
thetimeusers getthemaximumbenefit fromvideorecommender
systems.Moreover,acost-basedtransformfunctionisdefinedto
transform the CWT into the estimation of user interest, and the
model can be learned by optimizing a counterfactual likelihood
function defined over observed user watch times. Extensive exper-
iments on three real video recommendation datasets and online
A/B testing demonstrated that CWM effectively enhanced video
recommendation accuracy and counteracted the duration bias.
∗Bothauthors contributed equally to this research.
†JunXuisthecorrespondingauthor.WorkpartiallydoneatEngineeringResearchCen-
terofNext-GenerationIntelligentSearchandRecommendation,MinistryofEducation.
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation
onthe firstpage.Copyrights forcomponentsof thisworkowned byothersthan the
author(s)mustbehonored.Abstractingwithcreditispermitted.Tocopyotherwise,or
republish,topostonserversortoredistributetolists,requirespriorspecificpermission
and/or a fee. Request permissions from permissions@acm.org.
KDD ’24, August 25ś29, 2024, Barcelona, Spain
©2024 Copyright held by the owner/author(s). Publication rights licensed to ACM.
ACM ISBN 979-8-4007-0490-1/24/08
https://doi.org/10.1145/3637528.3671817CCS Concepts
•Information systems →Recommender systems.
Keywords
video recommendation, duration bias, user modelling
ACM Reference Format:
HaiyuanZhao,GuohaoCai,JiemingZhu,ZhenhuaDong,JunXu,andJi-
RongWen.2024.CounteractingDurationBiasinVideoRecommendation
via Counterfactual Watch Time. In Proceedings of the 30th ACM SIGKDD
Conference on Knowledge Discovery and Data Mining (KDD ’24), August
25ś29, 2024, Barcelona, Spain. ACM, New York, NY, USA, 12 pages. https:
//doi.org/10.1145/3637528.3671817
1 Introduction
The rising of video content platforms have attracted billions of
users and become more frequent in the daily use of users nowa-
days [12,15,24,25]. To satisfy users’ information needs and en-
hance their engagement, developing accurate and personalized
video recommender systems is critical. It is essential to incorpo-
rate various feedback signals that reflect users’ interests to achieve
this goal. In the video scenario, watch time has been commonly
employedasanindicatorofuserinterestandcanbeleveragedto
enhance the accuracy of video recommender systems [5, 12].
Like other implicit feedback signals (e.g., user click) in recom-
mender systems, directly inferring the user interest labels from
the watch time is also hurt by the bias problem. One crucial bias is
durationbias;thatis,users’watchtimeisnotonlyrelatedtotheirin-
terestbutalsoaffectedbytheduration(length)ofthevideo[ 49,53].
It has been observed that users naturally tend to watch for more
time on longer videos, making watch time no longer a faithful
reflection of the user’s interest.
Existing approaches like Play Completion Rate (PCR), Watch
TimeGain(WTG)[ 49]andQuantile-basedmethod (D2Q)[ 53]re-
garddurationbiasasaproblemofinconsistentwatchtimescales
causedbythevideoduration.Thelongerthevideoduration,the
larger the watch time scale, resulting in a longer average watch
time. Therefore, these methods group and normalize the watch
time accordingto the videoduration, which keepsthe watch time
correspondingtodifferentvideodurationconsistentinscale.For
4455
KDD ’24, August 25–29, 2024, Barcelona, Spain Haiyuan Zhao et al.
0 50 100 150 200 250
Duration(s)1.501.752.002.252.502.753.003.253.50Proportion (× 1e1)1e 1
(a) KuaiRand10 20 30 40 50 60
Duration(s)3.03.23.43.63.84.04.24.4Proportion (× 1e2)1e 2
(b) WeChat
Figure1:Users’explicitfeedbackproportionincompletely
played records grouped by video duration of (a) KuaiRand
dataset (b) WeChat dataset.
User B
10s 20s 30s
Video A
· · · 
Observed Watch Time (30s)
Counterfactual Watch Time (>30s)
User  A
10s 20s 30sVideo  A
Observed Watch Time (30s)
Counterfactual Watch Time (30s)
Figure2:Comparisonbetweencounterfactualwatchtimeand
observed watch time. Users A and B have the same observed
watch time but different counterfactual watch times.
example, PCR directly divides the watch time according to the cor-
respondingvideodurationandthennormalizesthewatchtimeinto
intervalsof0to1.Thesenormalizedvaluesaretreatedasestimated
labels of user interest in downstream tasks. Since these methods
mitigating bias via correcting labels, they can be categorised as
label-correction methods. In practice, both video ranking based
onuserinterestandaccuratelypredictingwatchtimearecrucial
tasks.Theadvantageofthelabel-correctionmethodisthatitcan
not only provide an unbiased estimate of the user interest score
but also predict watch time through the inverse transformation
of the normalization function. In contrast, other existing methods,
such as the feature-based methods: DCR [ 20] and CVRDD [ 36],
primarilyfocusontheunbiasedestimationofuserinterestscores.
While these methods have proven effective, they struggle to simul-
taneously estimate both watch time and user interest scores as
effectively as label-correction methods.
Althoughexistinglabel-correctionmethodshaveshowneffec-
tiveness in some extent, we argue that there are still limitations. In
existingmethods,afterthenormalization,thecompletelyplayed
records (i.e., the user watched the whole video) are usually treated
as the highest user interest, regardless of the video duration. Typi-
cally,recordswithexplicitfeedbackcanreflectuserengagement
andinteresttosomeextent.However,fromtheexplicituserfeed-
back signals provided in KuaiRand dataset1and WeChat dataset2,
we observed that user explicit feedback in these completely played
recordsdoesnotalignwellwithcurrentmethods.Specifically,Fig.1
1https://kuairand.com/
2https://algo
.weixin.qq.com/shows the proportion of explicit positive feedback(i.e., like and for-
ward) received by those completely played records, grouped by
the video duration. In existing methods [ 49,53], since the user has
fully watched the video, these completely played records should
beconsideredasindicatingequallyhighinterest.However,Fig.1
clearly shows that, on both two datasets, longer completely played
videos have a higher proportion of positive feedback, even though
the short videos are also completely played.
The results in Fig. 1 suggest that even if users have watched the
entirevideo,thesecompletelyplayedrecordsmayreflectvarying
levels of interest. Moreover, the shorter the video duration, the
lower the user interest level that a completely played record can
represent,asitcorrespondstoalowerexplicitfeedbackproportion.
This inspires us to derive a novel interpretation of the duration
bias:There existsa potentialwatch time thatfaithfully reflectsuser
interest, which is truncated by the video’s duration, thereby resulting
inadurationbias..AsillustratedinFigure2,let’sconsidertwousers,
A and B, engaged in watching the samevideo with a 30s duration.
Bothusershavecompletelyplayedthevideo,andtheirwatchtimes
are recorded as 30s in the log data. However, after watching the
same video, User B exhibits a higher level of interest than User
A, thus appearing to be left wanting more. We then consider a
counterfactualquestion: Howlongwilltheuserwatchifthevideo
duration is sufficiently long? It becomes clear that User A is less
likely, or even unlikely, to extend her observed watch time. The
logged30swatchtimeforuserAcansufficientlyreflectherinterest.
Conversely, User B prefers exceeding her observed watch time.
Sinceherinformationneedsarenotfullysatisfiedafterwatching
this video, the logged 30s watch time cannot represent B’s interest.
To this end, we argue that there exists a counterfactual watch
time(CWT)correspondingtouserinterest,whichispartiallyob-
servedduetothetruncationbyvideoduration.Forincompletely
playedrecords,theCWTequalsitsobservedwatchtime,thusre-
flectinguserinterest.Forcompletelyplayedrecords,theCWTcould
belongerthantheobservedwatchtimeduetothetruncationby
video duration.The user’s trueinterest levelcould be higherthan
that directly inferred from the observed watch time.
The CWT can explain the results in Fig. 1 well: various CWT
are truncated by video duration in an entirely played video. There-
fore, the same observed watch time may correspond to various
CWT and thus cannot distinguish user interest level. Furthermore,
the completion of shorter videos occurs more easily than longer
ones,exacerbatingthetruncationofCWT.Thisresultsinamore
pronounced duration bias, impacting the accuracy of interest mea-
surement based on watch time.
To model the CWT and estimate user interests, we propose
a Counterfactual Watch Model (CWM) that adopts an economic
perspective to model users’ CWT. Specifically, CWM treats user
watchingasaprocessofaccumulatingwatchingrewards,wherethe
marginalrewardsareindicativeofuserinterest,andtheinvested
watchtimecorrespondstotheuserwatchingcost.Atthetimepoint
where a user’s marginal cost equals the marginal rewards, the user
attains the maximum cumulative benefit, making her actively stop
watching.ThistimepointcorrespondstotheaforementionedCWT.
Then,acost-basedtransformfunctionisderivedtotransformthe
CWT to the estimated user interest. The duration-debiased recom-
mendation model can be learned by optimizing a counterfactual
4456Counteracting Duration Bias in Video Recommendation via Counterfactual Watch Time KDD ’24, August 25–29, 2024, Barcelona, Spain
likelihood function defined over observed user watch times. In
summary,CWMattemptstomodelusers’consumptionbehavior,
specifically in video scenarios. Similar to the commonly used click
model [11], our CWM is beneficial for both relevance ranking and
watch time prediction via effectively modeling user behaviors.
The major contributions of this work are:
(1)We provide a novel concept called counterfactual watch time
(CWT) for interpreting the essence of duration bias;
(2)We propose a method named CWM for modeling CWT. We
furtherdevelopacost-basedtransformfunctionandcounter-
factual likelihood function for learning a duration-debiased
recommendation model;
(3)Weconductexperimentsonthreerealvideorecommendation
datasetsandonlineA/Btesting.Theresultimprovementsdemon-
strate the effectiveness of our CWM.
2 Related work
Video Recommendation. In the evolution from traditional video
recommendation to TV show, various methods have been devel-
oped to enhance the user experience and accuracy of recommenda-
tions. Park et al . [28]introduced a system that incorporates time
factorsanduserpreferencesusing4-dimensionaltensorfactoriza-
tiontoimproverecommendationaccuracy.Choetal .[10]presented
a recommendation method that accounts for user feedback within
specificwatchableintervalstoenhanceusersatisfactionwithTV
showrecommendations.Qinetal .[29]proposedamodelthatiden-
tifies and adapts to the behavior of multiple users interacting with
a TV system, thereby improving the personalization of recommen-
dations. Most research works have transferred from traditional
video to micro-video scenarios in the mobile internet era. Cov-
ington et al . [13]introduced the funnel architecture of YouTube
recommender system. They predicted the expected watch time
from training samples with weighted logistic regression, which
utilizes observed watch time as the weight of positive samples’
loss.Multi-taskmethods[ 6,26,35,52]havebeenproposedtoim-
provemetricssuchaswatchtimeprediction,relevanceofuser-item
pair, and number of video views together. Ma et al . [26]extend the
mixture-of-experts [ 21] architecture to multi-gate expert knowl-
edge integration. Tang et al . [35]proposed a shared learning struc-
ture to address the seesaw phenomenon. Chang et al .[6]proposed
aplug-and-playparameterandembeddingpersonalizednetwork
for a multi-domain and multi-task recommendation.
Counterfactual Information Retrieval. Most information re-
trievalsystemsconsiderusers’implicitfeedbackasasupervision
signal to infer their true interests. However, implicit feedback is
influenced not only by users’ interests but also by external factors.
Consequently, user interest signals are often concealed within im-
plicit feedback and remain unobserved. Researchers have drawn
inspiration from causal inference techniques [ 46] and developed
counterfactualinformationretrieval technologytoaddressthebi-
ases inherent in implicit feedback. Previous work in counterfac-
tualIRprimarilyfocusesonmitigatingpositionbias[ 1,9,22,48],
popularity bias [ 45,50,54] , and selection bias [ 32,33,43]. How-
ever, duration bias becomes a crucial concern when it comes to
video recommendation, which has been discussed in existing stud-
ies[20,30,36,49,53].Incontrasttoourapproach,currentmethodsforcorrectingdurationbiascannoteffectivelyexplainandeliminate
duration bias.
Click model in Information Retrieval. Modeling user behav-
iors plays a vital role in enhancing the performance of information
retrievalsystems.Theabilitytoaccuratelymodeluserbehaviorsal-
lowsaretrievalsystembettertofulfillusers’informationneeds[ 11].
Tothisend,manymodelshavebeenproposedtoexplainorpredict
userclickbehaviorinvariouscontexts:cascademodel(CM)[ 14],
userbrowsingmodel(UBM)[ 16]anddynamicBayesiannetwork
(DBN) model [ 7] model users’ click behavior in desktop search-
ing with different assumption; mobile click model (MCM) [ 27] and
F-shape Click Model (FSCM) [ 17] further extend the understand-
ing of users’ click behaviors on mobile devices. Moreover, Borisov
et al. [4]and Chen et al . [8]develop the click model into neural
networks,whichenableautomaticdependencydetection.Unlike
theaboveclickmodels,theUWMproposedinthispaperfocuses
onmodeling andexplainingusers’ watchingbehavior sinceitis a
better quantitative indicator of user preferences in video feeds.
3 Counterfactual watch time
In thissection, we willfirst define thevideo recommendation prob-
lemandthecounterfactualwatchtime(CWT);thenwewillprovide
supportingevidencesforourproposedCWT.Wealsopresentan
economic view of the user watch behavior based on the watch cost
andreward.Finally,wepointoutthecurrentmethods’limitation
from the CWT viewpoint.
3.1 Definition of counterfactual watch time
The task of user interest and watch time prediction can be formal-
ized as follows: Suppose UandVare the sets of users and videos,
respectively. We can record user 𝑢∈U’s watching behavior on
video𝑣∈VasD𝑢,𝑣={x𝑢,𝑣,𝑤𝑢,𝑣,𝑑𝑣},wherex𝑢,𝑣∈R𝑘represents
thefeaturevectorofthesamplepairand 𝑘isthefeaturedimension.
𝑤𝑢,𝑣∈R+denotesuser 𝑢’sobservedwatchtimeonvideo 𝑣(e.g.,in
seconds), while 𝑑𝑣∈R+is the duration of video 𝑣.
Next, we will introduce a novel concept called counterfactual
watch time CWT, which is denoted as 𝑤𝑐𝑢,𝑣. As we have discussed
before, the CWT can be defined as:
Definition1(counterfactualwatchtime). Foruser𝑢and
video𝑣,theCWT 𝑤𝑐𝑢,𝑣∈Risdefinedasthetimeuserswanttowatch
based on the user’s interest 𝑟𝑢,𝑣if the video duration is sufficiently
long. There is no correlation between 𝑤𝑐𝑢,𝑣and video duration 𝑑𝑣.
The CWT 𝑤𝑐𝑢,𝑣corresponds to user interests. However, CWT
𝑤𝑐𝑢,𝑣doesnotalwaysequaltheobservedwatchtime 𝑤𝑢,𝑣sinceitcan
betruncatedbyvideoduration 𝑑𝑣inpractice3.Theirrelationship
is formulated as follows:
𝑤𝑢,𝑣=min(𝑤𝑐
𝑢,𝑣,𝑑𝑣)⇐⇒/braceleftBigg
𝑤𝑐
𝑢,𝑣=𝑤𝑢,𝑣,if𝑤𝑢,𝑣<𝑑𝑣;
𝑤𝑐
𝑢,𝑣≥𝑤𝑢,𝑣,if𝑤𝑢,𝑣=𝑑𝑣;(1)
Eq.(1)indicatethatobservedwatchtime 𝑤𝑢,𝑣canberegardedas
the truncated variable of CWT 𝑤𝑐𝑢,𝑣.
3CWT may also be truncated at 0, making it difficult to discern how much a user
dislikesthevideo.However,thisstudyismoreconcernedwiththevideosuserslike
than those they dislike.
4457KDD ’24, August 25–29, 2024, Barcelona, Spain Haiyuan Zhao et al.
(5s,34s](34s,64s] (64s,93s](93s,122s](122s,152s] (152s,181s] (181s,211s] (211s,240s]
duration bins0.000.050.100.150.200.25Repeated play proportion 0.10.20.30.40.5
Average repeated play ratio
(a) KuaiRand(5s,14s](14s,23s] (23s,32s] (32s,41s] (41s,50s] (50s,59s]
duration bins0.360.380.400.420.440.460.480.50Repeated play proportion0.60.81.01.2
Average repeated play ratio
(b) WeChat
Figure 3: The repeated play proportion and average repeated
play ratio in different duration bins of (a) KuaiRand dataset
(b) WeChat dataset.
0 5 10 15 20 25 30
W
atch Time(s)0.0000.0250.0500.0750.1000.1250.1500.1750.200Proportiondurtaion=30s
(a) KuaiRand0 5 10 15 20 25 30
W
atch Time(s)0.000.050.100.150.200.250.300.35Proportiondurtaion=30s
(b) WeChat
Figure 4: The bimodal distribution of watch time on (a)
KuaiRand dataset (b) WeChat dataset. The video duration is
30s.
0 15
Watch Time (s)30less truncation
0 15
Watch Time (s)30more truncation
(a) Repeated playing
0 15
Watch Time (s)30counterfactual watch time dist.
0
Watch Time (s)30observed bimodal watch time dist.
(b) Bimodal distribution
Figure 5: Employing CWT to explain (a) repeated playing (b)
bimodal distribution.
3.2 The existence of counterfactual watch time
ThoughtheCWTisnotdirectlyobservablefromthedata,wecan
still find hints about the existence of CWT in real-world video
recommendationdatasets.Next,wewilluseCWTtoexplaintwo
phenomenapresentedinrealdatasets:(i)users’repeatedplaying
and (ii) the bimodal distribution of watch time.
3.2.1 Evidence 1: repeated playing. In real datasets, we found that
usersmayengageinrepeatedplaying(forexample,byrewinding
thevideo progressbar), leadingto actualwatch timethatexceeds
the video duration. This phenomenon is often due to users’ highinterest level in the current video. However, the video’s duration is
insufficienttomeettheirneeds,whichissimilartoourdefinition
of CWT. Since the definition of CWT necessitates a sufficiently
long video duration (Definition 1), in this study, we do not equate
repeat playing with CWT. In Fig. 3, we investigate the repeated
playinginboththeKuaiRandandWeChatdatasets.Specifically,we
focusontwometrics:(1) repeatedplayproportion,whichrepresents
theproportionofrepeatplayedrecordswithinthecurrentvideo
duration,and(2) averagerepeatplayratio,whichreflectstheaverage
extent of repeat playing within the current video duration, defined
as(𝑤𝑢,𝑣−𝑑𝑣)/𝑑𝑣. The results depicted inFig. 3 indicate that both
the proportion of users’ repeat playing and the degree of repeat
playingarehigherforshortervideosanddecreaseasvideoduration
increases.
3.2.2 Evidence 2: bimodal distribution. Another supporting evi-
dence is the bimodal distribution of users’ watch time. For the
overalldistributionofallthevideoplayingrecords,existingstud-
ies[47,55]arguethatlogarithmicwatchtimeobeystheGaussian
distribution. However, when we focus on a given video duration
(e.g., 30s), the distribution of observed watch time turns out to
be bimodal, as shown in Fig. 4. The bimodal distribution reveals
that most users skip over the recommended video or completely
watch it, while only a few users stop watching in the middle of the
video playing [ 37,51]. This abnormal distribution change is less
interpreted by existing studies but can be well explained by the
CWT.
3.2.3 Explanation from counterfactual watch time. Without loss of
generality,weassumethatCWT 𝑤𝑐𝑢,𝑣obeysaGaussiandistribution.
However, as we have mentioned in Eq. (1), all sampled 𝑤𝑐𝑢,𝑣will be
truncatedbyduration 𝑑𝑣.Meanwhile, 𝑤𝑐𝑢,𝑣willalsobetruncated
to 0 since all recorded watch times have to be non-negative. The
truncatedsamplesareassignedto 𝑑𝑣or0,respectively.Asillustrated
in Fig. 5(a), with the video duration increases, CWT experiences
lesstruncationontherightside,therebyreducingthetendencyfor
userstoengageinrepeatplaying.Meanwhile,inFig.5(b),whenthe
original Gaussian distribution is truncated, it presents a bimodal
distribution,asweobservedinthereal-worlddataset.Hence,CWT
cansuccessfullyinterprettheabovephenomenon,whichinturn
supports its existence.
3.3 An economic view of user watching
To address the relationship between CWT and user interest, we
model the user’s watch behavior from an economic perspective.
The foundation of CWT within this framework is based on the
conceptsof utilitymaximization [2]andrationalchoice [39].
This means users decide how much time to allocate to watching
videosbasedontheperceivedutility(satisfaction)derivedfromthe
content and their resource constraints. In accordance with these
economic principles, individuals allocate resourcesÐin this case,
timeÐto maximize their utility. Utility can be seen as the reward
minus the cost. For users, the rewardfor watching a video is the
informationorpleasurederivedfromthevideocontent,whichis
determinedbytheirinteresttothevideo.However,userscannot
earnunlimitedrewards,astheyfaceresourceconstraints,suchas
limited time. To illustrate the constraint, we introduce the concept
4458Counteracting Duration Bias in Video Recommendation via Counterfactual Watch Time KDD ’24, August 25–29, 2024, Barcelona, Spain
Marginal Reward = Marginal Cost
(a) marginal watch cost/reward
Maximum Benefit (b) cumulative watch cost/reward
Figur
e 6: The economic view of user watching.
ofwatching cost, which refers to the overall effort and resources
required to watch a video, including not just the value of time
fortheuserbutalsotheuser’smentalenergyandattention.This
watching cost highlights that watching a video requires users to
allocatetheirfiniteresources,whichcouldhavebeenspentonother
activities.
Insummary,Weassumethattheuser’swatchingbehaviorfol-
lows the underlying assumptions:
•Diminishing marginal reward: When the user watches
a video, the enjoyment or satisfaction derived per second
decreasesgradually,whichissupportedbythehabituation
phenomenon in the psychology filed [ 38] and existing prac-
tice [47]. The initial marginal watch reward corresponds to
user interest.
•Constantmarginalcost:Sincethewatchingcostismainly
influenced by context factors, we can mildly assume that
contextfactorsarenotsignificantlyalteredduringtheperiod
user watching video. Therefore, we consider the marginal
watch cost as a constant.
•Rationalusers:Userstypicallyactrationallybymaximizing
theircumulative utility. Userswill stopwatching thevideo
when the marginal watch cost equals the reward.
Based on the three assumptions above, we draw the marginal
watch cost/reward curves in Fig. 6(a) and the cumulative watch
cost/rewardcurvesinFig.6(b).Themarginalcurvesareobtained
as derivatives of the cumulative curves. The figure shows that the
marginalwatchrewarddecreasesmonotonicallywhilethemarginal
watchcostcurveisconstant.Whenthesetwocurvesmeet,auser’s
marginal watch reward equals the marginal watch cost. At this
point,thecumulativeutility(i.e.,cumulativerewardminuscumu-
lative cost) is maximized, as illustrated in Figure 6(b). Formally, we
refer to this time point as our proposed CWT. Our economic view
can interpret the phenomenon in Fig. 1 and Fig. 2: users interest
level in a video is reflected by the time when they receives their
maximum cumulative utility. When the video duration is too short
to achieve each user’s maximum cumulative utility point, users
with either high or low interest will completely play it.
3.4 Limitation of existing methods
Finally, we point out the limitation of current methods from the
viewpointofCWT.Wewillprovethatusers’trueinterestcannot
beinferredwithonlyatransformfunctionovertheobservedwatch
time, as shown in the following theorem:
𝒙 𝑢,𝑣
𝑓𝜃 𝒙 𝑢,𝑣 Ƹ 𝑟𝑢,𝑣 𝑔 Ƹ 𝑟𝑢,𝑣 ; 𝑐 ෝ 𝑤𝑢,𝑣𝑐𝑐
Rec. Model Transform Function
𝒙 𝑢,𝑣 𝑓𝜃 𝒙 𝑢,𝑣Ƹ 𝑟𝑢,𝑣
𝑤 𝑢,𝑣 𝑔−1𝑤 𝑢,𝑣 ; 𝑐𝑐
𝑟𝑢,𝑣′Rec. Model
Transform Functionℒ 𝑐 Ƹ 𝑟𝑢,𝑣 , 𝑟 𝑢,𝑣′
Likelihood 
FunctionInference 
Stage
Training 
Stage𝑑 𝑣𝑑 𝑣
ෝ 𝑤𝑢,𝑣 𝑐𝑙𝑖𝑝Figure 7: Computational flow of the proposed CWM.
Theorem1(observedwatchtimeisnottheindicatorofin-
terest). For∀W⊆R+,𝑔∈G, given𝑔:R→W, we have/nexists𝑔−1:
W→R, whereWis the set of all observed watch time values, Gis
the function space,Ris the set of all interest probability values.
The proof of this theorem is presented in our Appendix A. This
theorem indicates that existing methods fail to uncover user inter-
est inthose completelyplayed records,especially whenthe video
duration is short. The failure of current methods motivates us to
develop a CWT-based approach to address this problem and better
understand user interest.
4 Our approach
For better modeling the CWT and estimating user interest, we
proposeCounterfactualWatch Model(CWM).Fig7 illustratesthe
flow of CWM in the inference stage and training stage. At the
inferencestage,arecommendationmodel 𝑓𝜃(·),parameterizedwith
𝜃,estimatestheuserinterest ˆ𝑟𝑢,𝑣basedonthefeaturevector x𝑢,𝑣.
Then a transform function 𝑔(·), conditioned on user watch cost
𝑐, converts the interest estimation into the CWT prediction ˆ𝑤𝑐𝑢,𝑣.
The actual watch time prediction ˆ𝑤𝑢,𝑣is obtained by truncating it
through the video duration 𝑑𝑣.
Atthetrainingstage,toestimatetheparameters 𝜃in𝑓𝜃(·),we
employ a set of user activity log D⊆{D 𝑢,𝑣={x𝑢,𝑣,𝑤𝑢,𝑣,𝑑𝑣}:
𝑢∈U,𝑣∈V}.For eachD𝑢,𝑣∈D,the observedwatchtime 𝑤𝑢,𝑣
is transformed into the supervision signal of user interest by the
inverseofthetransformfunction,i.e., 𝑟′𝑢,𝑣=𝑔−1(𝑤𝑢,𝑣;𝑐).Although
we use observed watch time 𝑤𝑢,𝑣as the input of the inverse trans-
formfunctionhere,wewillapproximateittoCWTinoptimization.
Thenthepredicteduserinterest ˆ𝑟𝑢,𝑣=𝑓𝜃(x𝑢,𝑣)iscalculatedwith
current model parameters. For all D𝑢,𝑣∈D, comparing 𝑟′𝑢,𝑣and
ˆ𝑟𝑢,𝑣jointlywithduration 𝑑𝑣derivesthelikelihood function L𝑐(·).
Thus,thelearningoftherecommendationmodelcanbeperformed
by optimizingL𝑐(·).
Next,wewillelaborateonthedesignofCWM’skeycomponents:
(1)thetransformfunction 𝑔(·)and(2)thelikelihoodfunction L𝑐(·).
4.1 Cost-based transform function
As defined in Section 3.1, the CWT 𝑤𝑐𝑢,𝑣reveals user interest level
𝑟𝑢,𝑣. To estimate 𝑟𝑢,𝑣from𝑤𝑐𝑢,𝑣, we first define the transform func-
tion between 𝑤𝑐𝑢,𝑣and𝑟𝑢,𝑣.
Basedontheeconomicviewoftheuser’swatchingprocessin
Section 3.3, we first formulate the cumulative watch reward and
4459KDD ’24, August 25–29, 2024, Barcelona, Spain Haiyuan Zhao et al.
cumulative watch cost function as:
𝐹reward=𝜔(𝑟𝑢,𝑣)·log(𝑤𝑐
𝑢,𝑣+1);
𝐹cost=𝑐·𝑤𝑐
𝑢,𝑣,
wherethe 𝜔(𝑟𝑢,𝑣)istheinitialmarginalrewardthatcorresponds
touserinterestlevel 𝑟𝑢,𝑣,and𝑐istheuserwatchcostpersecond.It
isevidentthatthederivativefunctionof 𝐹rewardismonotonically
decreasing while that of 𝐹costis constant, which satisfies the as-
sumptionsinSection3.3.Whentheirderivativevaluesareequal,
wecanderiveatimepoint(i.e.,CWT)forthemaximumcumulative
benefit:
d𝐹reward
d𝑤𝑐𝑢,𝑣=d𝐹cost
d𝑤𝑐𝑢,𝑣⇒𝑤𝑐
𝑢,𝑣=𝜔(𝑟𝑢,𝑣)
𝑐−1.
Nowwewillformulatetheinitialmarginalrewardfunction 𝜔(𝑟𝑢,𝑣).
Since𝑟𝑢,𝑣∈(0,1), the𝜔(𝑟𝑢,𝑣)is expected to fulfill the following
conditions:(i) monotonically increasing.(ii) when 𝑟𝑢,𝑣→0(i.e., the
lowest interest level), the initial marginal reward 𝜔(𝑟𝑢,𝑣)should
also tend to 0. (iii) when 𝑟𝑢,𝑣→1(i.e., the highest interest level),
the initial marginal reward 𝜔(𝑟𝑢,𝑣)should tend to positive infinity.
Tothisend,weformulatethat 𝜔(𝑟𝑢,𝑣)=1/(−log𝑟𝑢,𝑣),sotheCWT
can be further written as:
𝑤𝑐
𝑢,𝑣=𝑔(𝑟𝑢,𝑣;𝑐)=1
−𝑐log𝑟𝑢 ,𝑣−1. (2)
Eq.(2)indicateshowuserinterest 𝑟𝑢,𝑣andusers’watchcost 𝑐affect
theirCWT.SinceweaimtouncoveruserinterestfromtheCWT
fortrainingrecommendationmodel,wecanrewriteEq. (2)toits
inverse function:
𝑟𝑢,𝑣=𝑔−1(𝑤𝑐
𝑢,𝑣;𝑐)=exp/parenleftbigg1
−𝑐(𝑤𝑐𝑢,𝑣+1)/parenrightbigg
. (3)
BothEq.(2)andEq.(3)arethecost-basedtransformfunctionssince
we introduce an extra cost parameter 𝑐(as a hyper-parameter) for
controllingtheconversionsensitivityfromCWTtouserinterest
or vice versa. Then we can leverage them to estimate user interest
and predict the user’s actual watch time.
4.2 Counterfactual likelihood function
Althoughwehaveproposedthecost-basedtransformfunctionto
describe the relationship between CWT and user interest, we still
face the problem that CWT is truncated when the record is com-
pletely played. We need to approximate the CWT by the observed
watch time to optimize our recommendation model.
4.2.1 Formulationofthecounterfactuallikelihoodfunction. Inspired
by the solution of survival analysis [ 23], we regard the observed
watch time distribution as the truncated distribution of CWT. The
overalllikelihoodfunctionofthetruncatedCWTcanbewrittenas:
𝑙=/productdisplay.1
𝑤𝑐𝑢,𝑣<𝑑𝑣Pr(𝑊𝑐=𝑤𝑐
𝑢,𝑣,𝑊𝑐<𝑑𝑣|x𝑢,𝑣)/productdisplay.1
𝑤𝑐𝑢,𝑣≥𝑑𝑣Pr(𝑊𝑐≥𝑑𝑣|x𝑢,𝑣)
=/productdisplay.1
𝑤𝑢,𝑣<𝑑𝑣Pr(𝑊𝑐=𝑤𝑢,𝑣,𝑊𝑐<𝑑𝑣|x𝑢,𝑣)/productdisplay.1
𝑤𝑢,𝑣=𝑑𝑣Pr(𝑊𝑐≥𝑑𝑣|x𝑢,𝑣),
(4)
where𝑊𝑐denotestherandomvariableofCWT.BasedonEq. (1),
wecanreplaceall 𝑤𝑐𝑢,𝑣by𝑤𝑢,𝑣inthesecondline.Eq (4)contains
two parts: when 𝑤𝑢,𝑣<𝑑𝑣, the likelihood function equals the joint
probabilitythatthecounterfactualdurationvariableisequalto 𝑤𝑢,𝑣andCWTvariableisnottruncated.When 𝑤𝑐𝑢,𝑣≥𝑑𝑣,thelikelihood
function equals the probability that the CWT variable is truncated.
As discussed in Theorem 1, we cannot find a transform function
for indicating user interest from observed watch time. What we
knowis only 𝑤𝑐𝑢,𝑣≥𝑑𝑣,so weincorporatethispriorin likelihood
function, allowing the models to determine the extent to which
𝑤𝑐𝑢,𝑣should exceed 𝑑𝑣.
MaximizingEq. (4)canreducethedurationbiascausedbythe
truncation of CWT. To estimate the user interest, we then equally
transformEq. (4)intothelikelihoodfunctionofuserinterest 𝑟𝑢,𝑣
via the transform function in Eq. (3):
𝑙=/productdisplay.1
𝑤𝑢,𝑣<𝑑𝑣Pr(𝑅=𝑔−1(𝑤𝑢,𝑣;𝑐),𝑅<𝑔−1(𝑑𝑣;𝑐)|x𝑢,𝑣)
×/productdisplay.1
𝑤𝑢,𝑣=𝑑𝑣Pr(𝑅≥𝑔−1(𝑑𝑣;𝑐)|x𝑢,𝑣)
=/productdisplay.1
𝑤𝑢,𝑣<𝑑𝑣Pr(𝑅=𝑔−1(𝑤𝑢,𝑣;𝑐)|x𝑢,𝑣)/productdisplay.1
𝑤𝑢,𝑣=𝑑𝑣Pr(𝑅≥𝑔−1(𝑑𝑣;𝑐)|x𝑢,𝑣),
(5)
where𝑅denotestherandomvariableofuserinterestprobability.
Next, we will parameterize this likelihood function.
4.2.2 Parameterizeandoptimizethelikelihoodfunction. According
totheresultin[ 23],Eq.(5)canbeparameterizedwithatheoretical
guarantee if the random variable 𝑅obeys Gaussian distribution.
Forconverting 𝑅intoaGaussian-distributedrandomvariable,we
employaninversefunctionofthestandardGaussian-distributed
cumulative distribution function:
𝑔′(·)=Φ−1/bracketleftbig
𝑔−1(·)/bracketrightbig
.
ThenwecanparameterizeEq. (5)intoourcounterfactuallikelihood
function:
L𝑐=/productdisplay.1
𝑤𝑢,𝑣<𝑑𝑣𝜙/bracketleftbigg𝑔′(𝑤𝑢,𝑣;𝑐)−𝑓𝜃(x𝑢,𝑣)
𝜎/bracketrightbigg
×/productdisplay.1
𝑤𝑢
,𝑣=𝑑𝑣/parenleftbigg
1−Φ/bracketleftbigg𝑔′(𝑑𝑣;𝑐)−𝑓𝜃(x𝑢,𝑣)
𝜎/bracketrightbigg
/parenrightbigg
,(6)
where𝜙(·)andΦ(·)4aretheprobabilitydensityfunctionandcu-
mulative distribution function of standard Gaussian distribution,
respectively. 𝜎is the standard deviation of the interest, which is
treated as a hyper-parameter in our method. And 𝑓𝜃(x𝑢,𝑣)is the
recommendationmodelforpredictinguserinterest,itsparameter
isdenotedas 𝜃.Thenthelog-likelihoodfunctionisutilizedinour
training:
log(L𝑐)=∑︁
𝑤𝑢,𝑣<𝑑𝑣−/parenleftbig𝑔′(𝑤𝑢,𝑣;𝑐)−𝑓𝜃(x𝑢,𝑣)/parenrightbig2
2𝜎2
+∑︁
𝑤𝑢
,𝑣=𝑑𝑣logΦ/bracketleftbigg𝑓𝜃(x𝑢,𝑣)−𝑔′(𝑑𝑣;𝑐)
𝜎/bracketrightbigg
.(7)
Remark. Eq.(7)isderivedfrommaximumlikelihoodestimation
(MLE):Theoptimalparametersarethosethatbestdescribethecur-
rentlyobserveddata.FortheCWT,weobservethatwhenthevideo
is not fully watched, the CWT equals to the actual watch time, this
isthe MSEpart ofEq. (7). However, forthe videois fullywatched,
4Inpractice, we approximate Φ(·)via Sigmoid function follow [55].
4460Counteracting Duration Bias in Video Recommendation via Counterfactual Watch Time KDD ’24, August 25–29, 2024, Barcelona, Spain
Table 1: Statistics of the datasets adopted in this study
Dataset #Users #Videos #Interactions Mean Complete Ratio(%)
KuaiRand 26,988 6,598 1,266,560 17.5%
W
eChat 20,000 96,418 7,310,108 45.5%
Product 2,000,000 1,011,007 36,366,437 32.8%
theobservation weonlyknow isCWT maylargerthan theactual
watch time, this led to the amplification part of Eq. (7). This ap-
proach to modelling truncated data is also common in endogenous
problems [ 3] and survival analysis [ 40]. Although simply amplifies
predictionsforfullywatchedvideoscannotpreciselymodelinter-
est,itcanstillenhanceourinterestpredictionsinalargemargin,
which is verified in our experimental results.
The detailed derivation from Eq. (5)to Eq.(7)can be found in
our appendix. Finally, a duration-debiased recommendation model
can be obtained through maximizing Eq. (7):
𝜃∗←argmax
𝜃log(L𝑐).
4.3 Online inference
In the inference stage, given a user-video pair (𝑢,𝑣), the predicted
interestandwatchtimecanbecalculatedbytheunbiasedrecom-
mendation model 𝑓𝜃∗parameterized by the learned parameter 𝜃∗:
ˆ𝑟𝑢,𝑣=Φ/parenleftbig𝑓𝜃∗(x𝑢,𝑣)/parenrightbig;
ˆ𝑤𝑢,𝑣=clip/parenleftbigg1
−𝑐logˆ𝑟𝑢 ,𝑣−1,0,𝑑𝑣/parenrightbigg
,
where𝑐𝑙𝑖𝑝(𝑥,𝑎,𝑏)functionmeansclippingthevalueof 𝑥into[𝑎,𝑏].
5 Experiments and Results
5.1 Experimental setting
We conducted experiments to verify the effectiveness of CWM
on two large-scale publicly available benchmarks and a dataset
collectedfromanindustrialvideoproduct.Moreimplementation
details can be found in Appendix B. More experimental results can
be found in Appendix D. The source code and dataset are available
athttps://github.com/hyz20/CWM.git.
5.1.1 Datasets. The experiments were conducted on two public
real-worlddatasets:WeChatandKuaiRand.Theyarerespectively
collected from two large micro-video platforms, Wechat Channels
andKuaishou.Wealsoconductourevaluationinalarge-scaleprod-
uctdatasetfromourvideoplatform,whichhastensofbillionsof
dailyactiveusers.WelisttheirstatisticinformationinTable1.Note
thatwepresenteachdataset’scompletelyplayedrecordpercent-
age in the last column of Table 1. Since the duration bias usually
occurs on those completely played records, their percentages in all
recordsrepresenttheseverityofthedurationbiasofeachdataset.
Accordingtothestatistics,WeChathasthemostseriousbias,while
KuaiRand has the least bias.
5.1.2 Evaluation. Inthispaper,wenotonlyadoptourCWMfor
ranking videos by user interest (i.e., relevance ranking) but also for
predicting users’ watch time. Both tasks are of great importance in
realvideorecommendationscenarios.Asforthetaskofwatchtime
prediction,we utilizeusers’actualwatchtime 𝑤𝑢,𝑣asthe groundtruth,MAE(MeanAbsoluteError)and XAUC[49]wereusedasthe
evaluation measures. Note that XAUC evaluates if the predictions
of two samples are in the same order as their actual watch time.
Such pairs are uniformly sampled, and the percentile of samples
that are correctly ordered by predictions is XAUC. A larger XAUC
suggests better watch time prediction performance.
Asforevaluatingthetaskofrelevancerankingaccordingtouser
interest, considering that the user interest labels are unobserved in
real-worlddatasets,wedefineduserinterestsbasedonCWT.Given
a(𝑢,𝑣)pair, the user interest label is defined as:
𝑟𝑢,𝑣=/braceleftbigg
1if(𝑑𝑣≤𝑤0.7∧𝑤𝑢,𝑣=𝑑𝑣)∨(𝑑𝑣>𝑤0.7∧𝑤𝑢,𝑣>𝑤0.7)
0otherwise.(8)
The𝑤0.7indicatesthe70%percentileofobservedwatchtime,which
is considered as the threshold for CWT. When a user watches
beyondthistime,weconsidertheusertobeinterested.Thesimilar
user interestdefinition isalso adoptedin [ 18,51].Wewill discuss
the unbiasedness of 𝑟𝑢,𝑣in Appendix C. The 𝑟𝑢,𝑣is used as the
ground truthforevaluating therelevance rankingtask, AUCand
nDCG@k are utilized as the evaluation metrics.
5.1.3 Baselines. In the experiments, we compared the proposed
methodwiththefollowingbaselines:Threedurationdebiasedbase-
lines:PCR,WTG[53],D2Q[49],D2Co[51] ; Two watch time-
weightedbaselines: WLR[12]andNDT[47];Andanaivebaseline:
VR(valueregression)whichdirectlyfittheobservedwatchtime.
Forrelevancerankingtask,wealsoprovidetheresultof Oracle,
which is trained directly with the label defined in Eq. (8)and de-
notetheupperboundperformanceofrelevanceranking.Mostof
thesemethodsaredesignedinitiallyforrelevancerankingorwatch
timepredictionviaatransformfunction.Fortherelevanceranking
task, we directly rank the candidate videos via the predicted scores
outputbytherecommendationmodelstrainedbythesemethods.
Forthewatchtimepredictiontask,wefirsttransformthepredic-
tion of recommendation models into the interval of watch time
via the inverse transform function of each method. Then we clip
the estimated watch time into 0 to 𝑑𝑣as what we did in CWM.
Two exceptions are WLR and NDT, which are implemented by a
two-towermodelandhavenoinversetransformfunctionavailable.
Therefore, WLR is only used in watch time prediction, and NDT is
used only in relevance ranking.
To investigate the generalization of our method and the base-
lines,weintegratethemwithdifferentbackbonemodels.Specifi-
cally,weuserecommendationmodelsof FM[31],DCN[41]and
AutoInt [34] as the backbone models. These three backbone mod-
els respectively represent three types of feature interactions: inner
product, outer product, and attention mechanisms.
5.2 Overall performance
We compared our CWM with other baselines in the three datasets’
watchtimepredictiontaskandrelevancerankingtask,asshown
inTable2andTable3,respectively.ItcanbeseenthatourCWM
obtains the best performance on almost all three datasets, all back-
bonesandbothtaskssignificantly.WealsonotethatonWeChat,
thosemethodsequippedwithdurationdebiasing(e.g.,WTGand
D2Q)performevenworsethanthenaiveVRmethod.Thereasonis
that the WeChat dataset has much more completely played records
4461KDD ’24, August 25–29, 2024, Barcelona, Spain Haiyuan Zhao et al.
Table2:ThewatchtimepredictionperformanceofCWMandotherbaselinesinKuaiRand,WeChatandProduct.Boldface
means the best-performed methods, while underline means the second best-performed methods, superscripts †means the
significance compared to the second best-performed methods with 𝑝<0.05of one-tailed 𝑡-test. ‘↓’ denotes that lower is better
for MAE, while higher is better for XAUC.
DatasetBackbone FM DCN AutoInt
Method VR PCR WLR D2Q WTG D2Co CWM VR PCR WLR D2Q WTG D2Co CWM VR PCR WLR D2Q WTG D2Co CWM
KuaiRandMAE↓22.100 20.974 24.279 18.271 23.044 22.262 17.738†21.698 21.910 21.044 18.131 21.318 21.564 17.420†21.726 21.465 23.202 18.213 22.771 21.826 17.462†
XAUC 0.6830.697 0.668 0.646 0.666 0.662 0.714†0.6920.696 0.680 0.649 0.695 0.693 0.715†0.6850.699 0.668 0.646 0.673 0.667 0.713†
WeChatMAE↓9.404 8.920 9.653 8.778 9.637 10.200 8.001†9.317 8.709 9.149 7.987 8.727 8.667 7.902 9.405 8.910 9.815 8.815 9.623 10.031 7.969†
XAUC 0.696 0.692 0.667 0.682 0.653 0.627 0.713†0.703 0.717 0.684 0.721 0.718 0.718 0.717 0.700 0.693 0.661 0.679 0.653 0.634 0.714†
ProductMAE↓9.411 7.395 8.913 7.383 7.420 7.511 6.785†9.3847.320 8.887 7.374 7.398 7.443 6.648†9.1927.073 8.668 7.169 7.125 7.293 6.591†
XAUC 0.808 0.801 0.816 0.817 0.816 0.812 0.833†0.808 0.803 0.817 0.823 0.820 0.817 0.841†0.810 0.801 0.810 0.819 0.820 0.818 0.835†
Table 3: The relevance ranking performance of CWM and other baselines in KuaiRand, WeChat and Product.
DatasetBackbone FM DCN AutoInt
Method Oracle VR PCR D2Q WTG NDT D2Co CWMOracle VR PCR D2Q WTG NDT D2Co CWMOracle VR PCR D2Q WTG NDT D2Co CWM
KuaiRandAUC 0.7380.661 0.686 0.679 0.684 0.668 0.6880.735†0.7450.665 0.693 0.684 0.718 0.679 0.7300.735 0.7370.655 0.691 0.679 0.692 0.669 0.688 0.734†
nDCG@3 0.4890.4420.469 0.464 0.462 0.461 0.464 0.486†0.4970.448 0.469 0.466 0.471 0.464 0.4800.484 0.4900.4440.469 0.466 0.466 0.459 0.464 0.484†
WeChatAUC 0.7110.6390.651 0.645 0.602 0.629 0.573 0.703†0.7120.641 0.699 0.696 0.703 0.672 0.702 0.707 0.7140.6370.652 0.642 0.603 0.636 0.575 0.704†
nDCG@3 0.5880.5200.540 0.540 0.528 0.510 0.527 0.581†0.5890.5170.581 0.577 0.576 0.527 0.570 0.584 0.5900.5190.542 0.540 0.534 0.512 0.532 0.583†
ProductAUC 0.6690.605 0.593 0.623 0.624 0.640 0.629 0.660†0.6780.608 0.593 0.625 0.626 0.649 0.636 0.663†0.6720.610 0.593 0.629 0.631 0.644 0.634 0.663†
nDCG@3 0.5890.556 0.472 0.513 0.523 0.553 0.531 0.582†0.5950.564 0.475 0.516 0.533 0.563 0.540 0.591†0.5910.558 0.479 0.514 0.527 0.559 0.533 0.585†
(5s,13s](13s,21s] (21s,32s] (32s,48s] (48s,69s] (69s,95s](95s,125s](125s,175s] (175s,250s] (250s,400s]
Duration Bins6420246 Imp_XAUC(%)KuaiRand
CWM
WTG
D2Q
D2Co
PCR
(a) watch time prediction(5s,13s](13s,21s] (21s,32s] (32s,48s] (48s,69s] (69s,95s](95s,125s](125s,175s] (175s,250s] (250s,400s]
Duration Bins7.55.02.50.02.55.07.5 Imp_AUC(%)KuaiRand
CWM
WTG
D2Q
D2Co
PCR
(b) relevance ranking
Figure8:TherelativeimprovementofeachmethodstoVR
on different duration bins of KuaiRand.
(45.5%) than that of KuaiRand (17.5%), showing that increasing
completely played records make current debiasing methods get
ineffective. In contrast, CWMimproved more on WeChat than on
otherdatasets.Theresultsalsoverifiedthemotivationofthispaper:
Current methods regard all completely played records as the same
high interest, violating real interest distribution in real data. There-
fore, when the dataset contains many completely played records
(i.e., records with truncated CWT), the performance of these meth-
ods gets worse. Instead, CWM can model users’ truncated CWT to
estimate user interest better and predict users’ actual watch time.
5.3 Effectiveness on duration debiasing
To investigate why our CWM is more effective on duration debi-
asingthanotherbaselines,wedividedtheKuaiRanddatasetinto
tenequalpartswithdifferentdurationranges.Thenweevaluate
eachmodelonthesubsetofKuaiRand.Theresultispresentedin
Fig. 8. Note that the evaluation metric has different value scales
among different subsets, so we report the relative improvement
ofeachmethodtoVRtoshowtheextenttowhichthesemethods
address duration bias. The relative improvement is Δ𝐼𝑚𝑝=𝑣𝑚−𝑣0
𝑣0,
where𝑣0is the metric value of VR and 𝑣𝑚is the metric value of
each method.CWM-C CWM-L CWM0.660.680.700.72XAUCKuaiRand
FM
DCN
AutoInt
CWM-C CWM-L CWM0.6500.6750.7000.725XAUCWeChat
FM
DCN
AutoInt
CWM-C CWM-L CWM0.450.460.470.480.49nDCG@3KuaiRand
FM
DCN
AutoInt
CWM-C CWM-L CWM0.5000.5250.5500.5750.600nDCG@3WeChat
FM
DCN
AutoInt
Figure 9: Ablation study on CWM in both KuaiRand and
WeChat.Toptwo:watchtimepredictiontask.Bottomtwo:
relevance ranking task.
Fig8(a)illustratestheperformanceofeachmethodonthewatch
time prediction task, measured by Δ𝐼𝑚𝑝on XAUC. Fig 8(b) illus-
trates the performance of each method on the relevance ranking
task,measuredby Δ𝐼𝑚𝑝onAUC.Inbothtasks,mostbaselinesper-
form better than VR in short videos (i.e., duration<30s), indicating
their effectiveness on duration debiasing to some extent. However,
sincetheysimplyregardcompletelyplayedrecordsasequallyhigh
interest, CWM performed better than them. We can find that these
baselinesperformworseinlongervideosonbothtasks.Thisisalso
becausetheyregardshort,completelyplayedvideorecordingsas
highinterest,leadingtounderestimatinguserinterestandwatch
time prediction for longer videos. In contrast, CWM can model
the CWT and assign fairer interest estimates to videos of different
durations.
5.4 Comparison with more baselines
We have compared our CWM with other label-correction methods
before, but the superiority of CWM compared with other state-
of-the-artmethodsremainsunclear.Therefore,wefurtherimple-
mentedCVRDD[ 36],DCR[20],andVLDRec[ 30].CVRDDtreats
4462Counteracting Duration Bias in Video Recommendation via Counterfactual Watch Time KDD ’24, August 25–29, 2024, Barcelona, Spain
Table4:TherankingperformanceofCWMandmorestate-
of-the-art baselines in KuaiRand, WeChat and Product.
Dataset KuaiRand WeChat Product
Backbone Method AUC nDCG@3 AUC nDCG@3 AUC nDCG@3
FMOracle 0.738 0.489 0.711 0.588 0.669 0.589
VLDRec 0.689 0.463 0.655 0.540 0.633 0.543
DCR 0.695 0.469 0.659 0.542 0.639 0.540
CVRDD 0.682 0.462 0.662 0.545 0.629 0.535
CWM 0.735†0.486†0.703†0.581†0.660†0.582†
DCNOracle 0.745 0.497 0.712 0.589 0.678 0.595
VLDRec 0.701 0.468 0.679 0.547 0.647 0.543
DCR 0.716 0.480 0.681 0.559 0.649 0.554
CVRDD 0.684 0.473 0.687 0.556 0.630 0.535
CWM 0.735†0.484 0.707†0.584†0.663†0.591†
AutoIntOracle 0.737 0.490 0.714 0.590 0.672 0.591
VLDRec 0.698 0.472 0.661 0.546 0.638 0.550
DCR 0.699 0.475 0.662 0.547 0.643 0.546
CVRDD 0.683 0.470 0.664 0.555 0.639 0.536
CWM 0.734†0.484 0.704†0.583†0.663†0.585†
videodurationasamediationfactor,DCRconsidersvideoduration
asaconfounder,andVLDRecemploys PCRasthelabel withpair-
wiselearning,allprimarilyfeature-basedordata-basedapproaches.
Incontrast,ourlabel-correctionmethod,CWM,consistentlyout-
performsthesebaselinesintermsofAUCandnDCG@3metrics,
asshowninTable4.ThesuperiorityofCWMisconsistentacross
alldatasetsandbackbonemodels.Inconclusion,ourCWMmethod
demonstrates superior performance in mitigating duration bias
by modeling counterfactual watch time (CWT), highlighting its
effectiveness in delivering more accurate and unbiased recommen-
dations in short video recommendation systems.
5.5 Ablation study
WealsoinvestigatehowCWM’stwocomponentsbenefittheCWM,
i.e.,the cost-basedtransform functionand thecounterfactuallikeli-
hood functions.The cost-based transform function estimatesuser
interest from the CWT, and the counterfactual likelihood function
optimizes the model unbiasedly using the observed watch time.
Specifically,weproducetwovariantsforCWM.Thefirstisdenoted
asCWM-C, which removes the cost-based transform function
anddirectlyappliestheoriginalwatchtimetothecounterfactual
likelihood function. The second one is denoted as CWM-L, which
replacesthecounterfactuallikelihoodfunctionwithameansquared
error loss function.
Fig.9demonstratestheperformancecomparisonbetweenCWM
anditsvariantsontwodatasetsandtwotasks.OnKuaiRand,CWM-
L obtains similar performances to CWM, while CWM-C has a sig-
nificantperformancedroptoCWM.WearguethatwhenCWTis
less truncated (e.g., KuaiRand has only 17.5% completely played
records), how it is converted into an interest estimation can pri-
marilyaffectperformance.OnWeChat,CWM-Cobtainsasimilar
performancetoCWM,whileCWM-Lhasasignificantperformance
drop to CWM. We argue that when CWT is heavily truncated (e.g.,
WeChathas45.5%completelyplayedrecords),howtheobserved
watchtimeisusedtoapproximatethelearningofCWTbecomes
the performance bottleneck.Table 5: Relative improvement of CWM to product baseline
for one-week online A/B testing.
MWT VV CTR
Product - - -
CWM
+2.9% +2.5% +0.3%
5.6 Online A/B Testing
To verify the effectiveness of CWM in real-world recommendation
scenarios,weconductedonlineexperimentsinourcommercialsys-
tem, a popular platform with tens of millions of active users every
day. The baseline is a highly-optimized multi-task model deployed
fortheproduct.BoththebaselineandCWMweretrainedincremen-
tally on the same anonymous logging data, and each one serves
5%traffics, randomly selected from the same user group. As for
short video recommendations, improving customers’ mean watch
time (MWT) is the main target. Other metrics, such as average
validviewingvolume(VV)andclick-throughrate(CTR),arealso
adopted. Accordingto the onlineA/B testing resultsshown in Ta-
ble5,wecanseethatCWMdoeshelpuserstoentertainthemselves
and spend more time watching the short videos.
6 Conclusion
Inthisstudy,weaimtocounteractthedurationbiasinvideorec-
ommendation.Weproposecounterfactualwatchtime(CWT)for
interpreting the duration bias in video recommendation and point
out that the duration bias is caused by the truncation of the user’s
CWT by video duration. A Counterfactual Watch Model (CWM) is
then developed, revealing that the CWT equals the time users get
the maximum benefit from video recommender systems. A cost-
based correction function is defined to transform the CWT into
the user interest, and the unbiased recommendation model can be
learned by optimizing a counterfactual likelihood function defined
over observed user watch times. Experimental results on threeof-
flinerealdatasetsandonlineA/Btestingindicatethesuperiority
of the proposed CWM.
Acknowledgments
This work was funded by the National Key R&D Program of China
(2023YFA1008704), the National Natural Science Foundation of
China (No. 62377044), Beijing Key Laboratory of Big Data Manage-
mentandAnalysisMethods,MajorInnovation&PlanningInterdis-
ciplinary Platform for the łDouble-First Classž Initiative, funds for
buildingworld-classuniversities(disciplines)ofRenminUniversity
of China, and PCC@RUC.
References
[1]QingyaoAi,KepingBi,ChengLuo,JiafengGuo,andW.BruceCroft.2018. Un-
biased Learning to Rank with Unbiased Propensity Estimation. In The 41st In-
ternational ACM SIGIR Conference on Research Development in Information Re-
trieval(Ann Arbor, MI, USA) (SIGIR ’18). ACM, New York, NY, USA, 385ś394.
https://doi.org/10.1145/3209978.3209986
[2]Fuad Aleskerov, Denis Bouyssou, and Bernard Monjardet. 2007. Utility maxi-
mization, choice and preference. Vol. 16. Springer Science & Business Media.
[3]Takeshi Amemiya. 1984. Tobit models: A survey. Journal of econometrics 24, 1-2
(1984), 3ś61.
[4]AlexeyBorisov,IlyaMarkov,MaartendeRijke,andPavelSerdyukov.2016. ANeu-
ralClickModelforWebSearch.In Proceedingsofthe25thInternationalConference
onWorldWideWeb (Montréal,Québec,Canada) (WWW’16).InternationalWorld
4463KDD ’24, August 25–29, 2024, Barcelona, Spain Haiyuan Zhao et al.
Wide Web Conferences Steering Committee, Republic and Canton of Geneva,
CHE, 531ś541. https://doi.org/10.1145/2872427.2883033
[5]Qingpeng Cai, Zhenghai Xue, Chi Zhang, Wanqi Xue, Shuchang Liu, Ruohan
Zhan, Xueliang Wang, Tianyou Zuo, Wentao Xie, Dong Zheng, Peng Jiang, and
Kun Gai. 2023. Two-Stage Constrained Actor-Critic for Short Video Recommen-
dation. In Proceedings of the ACM Web Conference 2023, WWW 2023, Austin, TX,
USA, 30 April 2023 - 4 May 2023. ACM, 865ś875.
[6]Jianxin Chang, Chenbin Zhang, Yiqun Hui, Dewei Leng, Yanan Niu, Yang Song,
andKunGai.2023. PEPNet:ParameterandEmbeddingPersonalizedNetwork
for Infusing with Personalized Prior Information. CoRRabs/2302.01115 (2023).
[7]OlivierChapelleandYaZhang.2009. ADynamicBayesianNetworkClickModel
for Web Search Ranking. In Proceedings of the 18th International Conference
on World Wide Web (Madrid, Spain) (WWW ’09). Association for Computing
Machinery, New York, NY, USA, 1ś10. https://doi.org/10.1145/1526709.1526711
[8]Jia Chen, Jiaxin Mao, Yiqun Liu, Min Zhang, and Shaoping Ma. 2020. A
Context-Aware Click Model for Web Search. In Proceedings of the 13th In-
ternational Conference on Web Search and Data Mining (Houston, TX, USA)
(WSDM ’20). Association for Computing Machinery, New York, NY, USA, 88ś96.
https://doi.org/10.1145/3336191.3371819
[9]Mouxiang Chen, Chenghao Liu, Jianling Sun, and Steven C.H. Hoi. 2021. Adapt-
ing InteractionalObservation Embeddingfor CounterfactualLearning toRank.
InProceedingsofthe44thInternationalACMSIGIRConferenceonResearchand
Development in Information Retrieval (Virtual Event, Canada) (SIGIR ’21). As-
sociation for Computing Machinery, New York, NY, USA, 285ś294. https:
//doi.org/10.1145/3404835.3462901
[10]Kyung-JaeCho,Yeon-ChangLee,KyungsikHan,JaehoChoi,andSang-WookKim.
2019. No,that’snotmyfeedback:TVshowrecommendationusingwatchable
interval. In 2019 IEEE35th International Conference onData Engineering (ICDE).
IEEE, 316ś327.
[11]AleksandrChuklin,IlyaMarkov,andMaartendeRijke.2016. ClickModelsfor
WebSearchandTheirApplicationstoIR:WSDM2016Tutorial.In Proceedings
of the Ninth ACM International Conference on Web Search and Data Mining (San
Francisco, California, USA) (WSDM ’16). Association for Computing Machinery,
New York, NY, USA, 689ś690. https://doi.org/10.1145/2835776.2855113
[12]Paul Covington, Jay Adams, and Emre Sargin. 2016. Deep Neural Networks
for YouTube Recommendations. In Proceedings of the 10th ACM Conference on
Recommender Systems (Boston, Massachusetts, USA) (RecSys ’16). Association for
ComputingMachinery,NewYork,NY,USA,191ś198. https://doi.org/10.1145/
2959100.2959190
[13]Paul Covington, Jay Adams, and Emre Sargin. 2016. Deep Neural Networks
for YouTube Recommendations. In Proceedings of the 10th ACM Conference on
RecommenderSystems,Boston,MA, USA,September15-19,2016.ACM,191ś198.
[14]NickCraswell,OnnoZoeter,MichaelTaylor,andBillRamsey.2008. AnExper-
imental Comparison of Click Position-Bias Models. In Proceedings of the 2008
InternationalConferenceonWebSearchandDataMining (PaloAlto,California,
USA)(WSDM’08).AssociationforComputingMachinery,NewYork,NY,USA,
87ś94. https://doi.org/10.1145/1341531.1341545
[15]JamesDavidson,BenjaminLiebald,JunningLiu,PalashNandy,TaylorVanVleet,
Ullas Gargi, Sujoy Gupta, Yu He, Mike Lambert, Blake Livingston, and Dasarathi
Sampath. 2010. The YouTube Video Recommendation System. In Proceedings of
theFourth ACMConferenceon RecommenderSystems (Barcelona,Spain) (RecSys
’10).AssociationforComputingMachinery,NewYork,NY,USA,293ś296. https:
//doi.org/10.1145/1864708.1864770
[16] Georges E. Dupret and Benjamin Piwowarski. 2008. A User Browsing Model to
PredictSearchEngineClickDatafromPastObservations..In Proceedingsofthe
31st Annual International ACM SIGIR Conference on Research and Development in
InformationRetrieval (Singapore,Singapore) (SIGIR’08).AssociationforComput-
ingMachinery,NewYork,NY,USA,331ś338. https://doi.org/10.1145/1390334.
1390392
[17]LingyueFu,JianghaoLin,WeiwenLiu,RuimingTang,WeinanZhang,RuiZhang,
and Yong Yu. 2023. An F-Shape Click Model for Information Retrieval on Multi-
Block Mobile Pages. In Proceedings of the Sixteenth ACM International Conference
on Web Search and Data Mining (Singapore, Singapore) (WSDM ’23). Association
forComputingMachinery,NewYork,NY,USA,1057ś1065. https://doi.org/10.
1145/3539597.3570365
[18]Chongming Gao, Shijun Li, Yuan Zhang, Jiawei Chen, Biao Li, Wenqiang Lei,
Peng Jiang, and Xiangnan He. 2022. KuaiRand: An Unbiased Sequential Rec-
ommendation Dataset with Randomly Exposed Videos. In Proceedings of the
31stACMInternationalConferenceonInformationandKnowledgeManagement
(Atlanta, GA, USA) (CIKM ’22). 5 pages. https://doi.org/10.1145/3511808.3557624
[19]YunjunGao,YuntaoDu,YujiaHu,LuChen,XinjunZhu,ZiquanFang,andBaihua
Zheng.2022. Self-GuidedLearningtoDenoiseforRobustRecommendation.In
Proceedings of the 45th International ACM SIGIR Conference on Research and
Development in Information Retrieval (Madrid, Spain) (SIGIR ’22) . Association for
ComputingMachinery,NewYork,NY,USA,1412ś1422. https://doi.org/10.1145/
3477495.3532059
[20]XiangnanHe,YangZhang,FuliFeng,ChonggangSong,LinglingYi,GuohuiLing,
andYongdongZhang.2023. AddressingConfoundingFeatureIssueforCausalRecommendation. ACM Trans. Inf. Syst. 41, 3, Article 53 (feb 2023), 23 pages.
https://doi.org/10.1145/3559757
[21]RobertA.Jacobs,MichaelI.Jordan,StevenJ.Nowlan,andGeoffreyE.Hinton.
1991. Adaptive Mixtures of Local Experts. Neural Comput. 3, 1 (1991), 79ś87.
[22]ThorstenJoachims,AdithSwaminathan,andTobiasSchnabel.2017. Unbiased
Learning-to-RankwithBiasedFeedback.In ProceedingsoftheTenthACMInterna-
tional Conference on Web Search and Data Mining (Cambridge, United Kingdom)
(WSDM’17).ACM,NewYork,NY,USA,781ś789. https://doi.org/10.1145/3018661.
3018699
[23]Yan Li, Kevin S. Xu, and Chandan K. Reddy. 2016. Regularized Parametric
Regression for High-dimensional Survival Analysis. In Proceedings of the 2016
SIAM International Conference on Data Mining, Miami, Florida, USA, May 5-7,
2016, Sanjay Chawla Venkatasubramanian and Wagner Meira Jr. (Eds.). SIAM,
765ś773. https://doi.org/10.1137/1.9781611974348.86
[24]Shang Liu, Zhenzhong Chen, Hongyi Liu, and Xinghai Hu. 2019. User-Video
Co-AttentionNetworkforPersonalizedMicro-VideoRecommendation.In The
WorldWideWebConference (SanFrancisco,CA,USA) (WWW’19).Association
forComputingMachinery,NewYork,NY,USA,3020ś3026. https://doi.org/10.
1145/3308558.3313513
[25]Yiyu Liu, Qian Liu, Yu Tian, Changping Wang, Yanan Niu, Yang Song, and Chen-
liangLi.2021. Concept-AwareDenoisingGraphNeuralNetworkforMicro-Video
Recommendation. In Proceedings of the 30th ACM International Conference on In-
formation Knowledge Management (Virtual Event, Queensland, Australia) (CIKM
’21). Association for Computing Machinery, New York, NY, USA, 1099ś1108.
https://doi.org/10.1145/3459637.3482417
[26]JiaqiMa,ZheZhao,XinyangYi,JilinChen,LichanHong,andEdH.Chi.2018.
Modeling Task Relationships in Multi-task Learning with Multi-gate Mixture-
of-Experts.In Proceedingsofthe24thACMSIGKDDInternationalConferenceon
Knowledge Discovery& Data Mining,KDD 2018,London, UK, August19-23, 2018.
ACM, 1930ś1939.
[27]Jiaxin Mao, Cheng Luo, Min Zhang, and Shaoping Ma. 2018. Constructing Click
Models for Mobile Search. In The 41st International ACM SIGIR Conference on
Research & Development in Information Retrieval (Ann Arbor, MI, USA) (SIGIR
’18).AssociationforComputingMachinery,NewYork,NY,USA,775ś784. https:
//doi.org/10.1145/3209978.3210060
[28]Yoojin Park, Jinoh Oh, and Hwanjo Yu. 2017. RecTime: Real-time recommender
system for online broadcasting. Information Sciences 409 (2017), 1ś16.
[29]JiaruiQin,JiachenZhu,YankaiLiu,JunchaoGao,JianjieYing,ChaoxiongLiu,
Ding Wang, Junlan Feng, Chao Deng, Xiaozheng Wang, et al .2023. Learning to
distinguishmulti-usercouplingbehaviorsfortvrecommendation.In Proceedings
oftheSixteenthACMInternationalConferenceonWebSearchandDataMining.
204ś212.
[30]YuhanQuan,JingtaoDing,ChenGao,NianLi,LinglingYi,DepengJin,andYong
Li.2023. AlleviatingVideo-lengthEffectforMicro-videoRecommendation. ACM
Trans. Inf. Syst. 42, 2, Article 44 (nov 2023), 24 pages. https://doi.org/10.1145/
3617826
[31]SteffenRendle.2012. FactorizationMachineswithLibFM. ACMTrans.Intell.Syst.
Technol.3,3,Article57(may2012),22pages. https://doi.org/10.1145/2168752.
2168771
[32]YutaSaito,SuguruYaginuma,YutaNishino,HayatoSakata,andKazuhideNakata.
2020. UnbiasedRecommenderLearningfromMissing-Not-At-RandomImplicit
Feedback.In Proceedingsofthe13thInternationalConferenceonWebSearchand
DataMining (Houston,TX,USA) (WSDM’20).AssociationforComputingMa-
chinery, New York, NY, USA, 501ś509. https://doi.org/10.1145/3336191.3371783
[33]Tobias Schnabel, Adith Swaminathan, Ashudeep Singh, Navin Chandak, and
ThorstenJoachims.2016. Recommendationsastreatments:Debiasinglearning
and evaluation. In international conference on machine learning. PMLR, 1670ś
1679.
[34]Weiping Song, Chence Shi, Zhiping Xiao, Zhijian Duan, Yewen Xu, Ming Zhang,
and Jian Tang. 2019. AutoInt: Automatic Feature Interaction Learning via
Self-Attentive Neural Networks. In Proceedings of the 28th ACM International
ConferenceonInformationandKnowledgeManagement (Beijing,China) (CIKM
’19). Association for Computing Machinery, New York, NY, USA, 1161ś1170.
https://doi.org/10.1145/3357384.3357925
[35]Hongyan Tang, Junning Liu, Ming Zhao, and Xudong Gong. 2020. Progres-
sive Layered Extraction (PLE): A Novel Multi-Task Learning (MTL) Model for
PersonalizedRecommendations.In RecSys2020:FourteenthACMConferenceon
RecommenderSystems,VirtualEvent,Brazil,September22-26,2020.ACM,269ś278.
[36]Shisong Tang, Qing Li, Dingmin Wang, Ci Gao, Wentao Xiao, Dan Zhao,
Yong Jiang, Qian Ma, and Aoyang Zhang. 2023. Counterfactual Video Rec-
ommendationforDurationDebiasing.In Proceedingsofthe29thACMSIGKDD
Conference on Knowledge Discovery and Data Mining (<conf-loc>, <city>Long
Beach</city>, <state>CA</state>, <country>USA</country>, </conf-loc>) (KDD
’23). Association for Computing Machinery, New York, NY, USA, 4894ś4903.
https://doi.org/10.1145/3580305.3599797
[37]ShisongTang,QingLi,DingminWang,CiGao,WentaoXiao,DanZhao,Yong
Jiang,QianMa,andAoyangZhang.2023. CounterfactualVideoRecommendation
for Duration Debiasing. In Proceedings of the 29th ACM SIGKDD Conference
4464Counteracting Duration Bias in Video Recommendation via Counterfactual Watch Time KDD ’24, August 25–29, 2024, Barcelona, Spain
on Knowledge Discovery and Data Mining (Long Beach, CA, USA) (KDD ’23).
AssociationforComputingMachinery,NewYork,NY,USA,4894ś4903. https:
//doi.org/10.1145/3580305.3599797
[38]RichardFThompsonandWilliamASpencer.1966. Habituation:amodelphe-
nomenon for thestudy of neuronal substratesof behavior. Psychological review
73, 1 (1966), 16.
[39]Nicolaas J Vriend. 1996. Rational behavior and economic theory. Journal of
Economic Behavior & Organization 29, 2 (1996), 263ś285.
[40]Ping Wang, YanLi, and ChandanK Reddy. 2019. Machine learningfor survival
analysis: A survey. ACM Computing Surveys (CSUR) 51, 6 (2019), 1ś36.
[41]RuoxiWang,BinFu,GangFu,andMingliangWang.2017. Deep&CrossNetwork
for Ad Click Predictions. In Proceedings of the ADKDD’17 (Halifax, NS, Canada)
(ADKDD’17).AssociationforComputingMachinery,NewYork,NY,USA,Article
12, 7 pages. https://doi.org/10.1145/3124749.3124754
[42]Wenjie Wang, Fuli Feng, Xiangnan He, Liqiang Nie, and Tat-Seng Chua. 2021.
Denoising Implicit Feedback for Recommendation. In Proceedings of the 14th
ACM International Conference on Web Search and Data Mining (Virtual Event,
Israel)(WSDM ’21). Association for Computing Machinery, New York, NY, USA,
373ś381. https://doi.org/10.1145/3437963.3441800
[43]Xuanhui Wang, Michael Bendersky, Donald Metzler, and Marc Najork. 2016.
LearningtoRankwithSelectionBiasinPersonalSearch.In Proceedingsofthe39th
International ACM SIGIR Conference on Research and Development in Information
Retrieval (Pisa, Italy) (SIGIR ’16). ACM, New York, NY, USA, 115ś124.
[44]Yu Wang, Xin Xin, Zaiqiao Meng, Joemon M Jose, Fuli Feng, and Xiangnan
He. 2022. Learning Robust Recommenders through Cross-Model Agreement. In
ProceedingsoftheACMWebConference2022 (VirtualEvent,Lyon,France) (WWW
’22). Association for Computing Machinery, New York, NY, USA, 2015ś2025.
https://doi.org/10.1145/3485447.3512202
[45]Tianxin Wei, Fuli Feng, Jiawei Chen, Ziwei Wu, Jinfeng Yi, and Xiangnan He.
2021. Model-Agnostic Counterfactual Reasoning for Eliminating Popularity
Bias in Recommender System. In Proceedings of the 27th ACM SIGKDD Con-
ference on Knowledge Discovery Data Mining (Virtual Event, Singapore) (KDD
’21). Association for Computing Machinery, New York, NY, USA, 1791ś1800.
https://doi.org/10.1145/3447548.3467289
[46]Peng Wu, Haoxuan Li, Yuhao Deng, Wenjie Hu, Quanyu Dai, Zhenhua Dong,
Jie Sun, Rui Zhang, and Xiao-Hua Zhou. 2022. On the Opportunity of Causal
Learning inRecommendation Systems:Foundation, Estimation,Prediction and
Challenges. In Proceedings of the Thirty-First International Joint Conference on
Artificial Intelligence, IJCAI-22. 5646ś5653. Survey Track.
[47]RuobingXie,LinMa,ShaoliangZhang,FengXia,andLeyuLin.2023.Reweighting
Clickswith DwellTime inRecommendation.In CompanionProceedingsof the
ACMWebConference2023 (Austin,TX,USA) (WWW’23Companion).Association
for Computing Machinery, New York, NY, USA, 341ś345. https://doi.org/10.
1145/3543873.3584624
[48]BowenYuan,YaxuLiu,Jui-YangHsia,ZhenhuaDong,andChih-JenLin.2020. Un-
biasedAdClickPredictionforPosition-AwareAdvertisingSystems.In Fourteenth
ACM Conference on Recommender Systems (Virtual Event, Brazil) (RecSys ’20).
ACM, New York, NY, USA, 368ś377. https://doi.org/10.1145/3383313.3412241
[49]Ruohan Zhan, Changhua Pei, Qiang Su, Jianfeng Wen, Xueliang Wang, Guanyu
Mu, Dong Zheng, Peng Jiang, and Kun Gai. 2022. Deconfounding Duration Bias
in Watch-Time Prediction for Video Recommendation. In Proceedings of the 28th
ACM SIGKDD Conference on Knowledge Discovery and Data Mining (Washington
DC,USA) (KDD’22).AssociationforComputingMachinery,NewYork,NY,USA,
4472ś4481. https://doi.org/10.1145/3534678.3539092
[50]Yang Zhang, Fuli Feng, Xiangnan He, Tianxin Wei, Chonggang Song, Guohui
Ling, and Yongdong Zhang. 2021. Causal Intervention for Leveraging Popularity
Bias in Recommendation. In Proceedings of the 44th International ACM SIGIR
Conference on Research and Development in Information Retrieval (Virtual Event,
Canada)(SIGIR ’21). ACM, New York, NY, USA, 11ś20. https://doi.org/10.1145/
3404835.3462875
[51]HaiyuanZhao,LeiZhang,JunXu,GuohaoCai,ZhenhuaDong,andJi-RongWen.
2023. Uncovering User Interest from Biased and Noised Watch Time in Video
Recommendation.In Proceedingsofthe17thACMConferenceonRecommenderSys-
tems(Singapore, Singapore) (RecSys ’23). Association for Computing Machinery,
New York, NY, USA, 528ś539. https://doi.org/10.1145/3604915.3608797
[52]Zhe Zhao, Lichan Hong, Li Wei, Jilin Chen, Aniruddh Nath, Shawn Andrews,
Aditee Kumthekar, Maheswaran Sathiamoorthy, Xinyang Yi, and Ed H. Chi.
2019. Recommending what video to watch next: a multitask ranking system. In
Proceedingsofthe13thACMConferenceonRecommenderSystems,RecSys2019,
Copenhagen, Denmark, September 16-20, 2019. ACM, 43ś51.
[53] Yu Zheng,ChenGao,JingtaoDing, LinglingYi,DepengJin,YongLi, andMeng
Wang. 2022. DVR: Micro-Video Recommendation Optimizing Watch-Time-Gain
under Duration Bias. In Proceedings of the 30th ACM International Conference on
Multimedia (Lisboa, Portugal) (MM ’22). Association for Computing Machinery,
New York, NY, USA, 334ś345. https://doi.org/10.1145/3503161.3548428
[54]YuZheng,ChenGao,XiangLi,XiangnanHe,YongLi,andDepengJin.2021.Disen-
tangling User Interest and Conformity for Recommendation with Causal Embed-
ding. InProceedings of the Web Conference 2021 (Ljubljana, Slovenia) (WWW ’21).ACM, New York, NY, USA, 2980ś2991. https://doi.org/10.1145/3442381.3449788
[55]TengfeiZhou,HuiQian,ZebangShen,ChaoZhang,ChengweiWang,Shichen
Liu, and Wenwu Ou. 2018. JUMP: a joint predictor for user click and dwell time.
InProceedingsofthe27thInternationalJointConferenceonArtificialIntelligence.
AAAI Press. 3704ś3710.
A Proof of theorem 1
Proof.Aswehaveanalyzedbefore,theCWT 𝑤𝑐𝑢,𝑣corresponds
to user interests 𝑟𝑢,𝑣, i.e.,𝑤𝑐𝑢,𝑣=𝑔(𝑟𝑢,𝑣). Based on Eq. (1), we can
obtain the functions of 𝑤𝑢,𝑣on𝑟𝑢,𝑣:
𝑤𝑢,𝑣=min(𝑔(𝑟𝑢,𝑣),𝑑𝑣), 𝑟𝑢,𝑣∈R, 𝑤𝑢,𝑣∈W
Next,weneedtoprovethattheabovefunctiondoesnotalwayshave
an inverse function, w.r.t any 𝑤𝑢,𝑣. Similar to Eq. (1), we rewrite
the above function as a segmented function:
𝑟𝑢,𝑣=𝑔−1(𝑤𝑢,𝑣),if𝑤𝑢,𝑣<𝑑𝑣;
𝑟𝑢,𝑣≥𝑔−1(𝑤𝑢,𝑣),if𝑤𝑢,𝑣=𝑑𝑣;
Note that when 𝑤𝑢,𝑣=𝑑𝑣(i.e., completely play a video), we can
only obtain an inequality between 𝑤𝑢,𝑣and𝑟𝑢,𝑣, thus proving that
there is no such an inverse function 𝑟𝑢,𝑣=𝑔−1(𝑤𝑢,𝑣)for all𝑤𝑢,𝑣∈
W. □
B Detailed Experimental Setting
In our paper, we briefly described the dataset used in our papers
and the baselines due to the limitation of pages. Now, we put a
more detailed experimental setting in this appendix.
WeChat.ThisdatasetisreleasedbyWeChatBigDataChallenge
2021, containing the WeChat Channels logs within two weeks. Fol-
lowing thepractice in[ 53], wesplit thedata intothe first10 days,
themiddle2days,andthelast2daysastraining,validation,and
testset.Wenoticedthatthereisanunusuallyhighproportionof
60svideosamongthedataset(17.3%),soourexperimentswerecon-
ductedonasubsetof60svideosthatwereexcluded(i.e.,theduration
range is [5s,59s] in the subset). The adopted input features include
userid,feedid,device,authorid,bgm_song_id,bgm_singer_id,user_type.
KuaiRand [18].KuaiRandisanewlyreleasedsequentialrecom-
mendationdataset collectedfromKuaiShou. Assuggestedin [ 18],
we utilized one of the subsets KuaiRand-pure in this study. To
mitigate the sparsity problem, we selected data from which the
video duration is up to 400s. We split the data into the first 14
days, the middle 7 days, and the last 10 days as training, validation,
andtestset.Theadoptedinputfeaturesinclude user_id,video_id,
author_id, music_id, follow_user_num_range,register_days_range,
fans_user_num_range, friend_user_num_range, user_active_degree,
most_popular_tag, video_type,upload_type,tab.
Product.Wecollecttheproductdatasetfromtheserverlogof
our video platform, which samples the log data from June 19, 2023
to June 25, 2023. Due to the data imbalance, we intercepted the
recordsbelow42secondsasthefinaltrainingset.Wetrainedour
modelonthisdatasetandtestedtheminthelasttwohoursofserver
log data. The pretrained ID embedding and side information are
used as feature inputs for all methods.
Inthisstudy,weimplementWLRfollowingthedetailsin[ 49].
For D2Q, the group number is set to 60 in KuaiRand, 30 in WeChat,
and10inourProductdataset.ForNDT,wesetitshyper-parameters
as the author suggested in their paper [ 47]. For D2Co, the window
size and sensitivity-controlled term are set as suggested in their
4465KDD ’24, August 25–29, 2024, Barcelona, Spain Haiyuan Zhao et al.
0.1 1.0 2.0 5.0 10.01/10 1/20 1/40 1/60 1/80c0.714 0.722 0.721 0.715 0.702
0.716 0.723 0.723 0.719 0.712
0.716 0.724 0.724 0.719 0.713
0.712 0.722 0.722 0.717 0.710
0.706 0.720 0.720 0.715 0.708XAUC
0.7050.7100.7150.720
(a) watch time prediction0.1 1.0 2.0 5.0 10.01/10 1/20 1/40 1/60 1/80c0.475 0.493 0.494 0.490 0.484
0.476 0.492 0.495 0.492 0.486
0.477 0.492 0.495 0.494 0.489
0.478 0.493 0.496 0.496 0.491
0.479 0.494 0.498 0.498 0.493nDCG@3
0.4750.4800.4850.4900.495
(b) relevance ranking
Figure 11: The parameter sensitivity of CWM on KuaiRand
dataset where the backbone model is FM.
0 20 40 60 80 100
Watch Time(s)0.000.020.040.060.080.10ProportionKuaiRand (duration<100s)
True
PCR
CWM
(a) Duration≤100s
0 5 10 15 20 25 30
Watch Time(s)0.000.020.040.060.080.100.12ProportionKuaiRand (duration=30s)
True
PCR
CWM (b) Duration=30s
Figure 12: The true and estimated watch time distribution
on KuaiRand dataset.
50 100 150 200
Duration(s)0.00.51.01.52.02.53.03.5Proportion (× 1e1)1e 1 proportion of ru,v
50 100 150 200
Duration(s)0.00.51.01.52.0Proportion (× 1e1)1e 1 explicit feedback proportion (when ru,v=1)
(a) KuaiRand
20 25 30 35 40 45 50 55 60
Duration(s)2.02.53.03.54.04.5Proportion (× 1e2)1e 2 explicit feedback proportion (when ru,v=1)
20 25 30 35 40 45 50 55 60
Duration(s)2.02.53.03.54.04.55.05.56.0Proportion (× 1e1)1e 1 proportion of ru,v
(b) WeChat
Figure 10: (Left) The proportion of user interest labels 𝑟𝑢,𝑣
and(Right)Theproportionofexplicitfeedbackwhen 𝑟𝑢,𝑣=1
grouped by video duration on (a) KuaiRand and (b) WeChat.
paper [51]. We utilize Adam as the optimizer and set the initial
learningrateas 5𝑒−4forallmethods.Thebatchsizeissetas512.For
all the backbone models, we set their latent embedding dimension
to10.Forallmethodswithneuralnetworks,thehiddenunitsare
setto64whilethedropoutratioissetto0.2.Thevalueofusercost
𝑐and𝜎in our CWM is set to (1/40,2)in the KuaiRand dataset,
(1/40,20)intheWeChatdataset,and (1/5,5)intheProductdataset.
Wetuneourhyperparametersonthevalidationsetwhileevaluating
the performance on the test set.
C The Unbiasedness of Interest Labels
Toevaluatetheperformanceofrelevancerankingtasksinthisstudy,
weneedanunbiasedindicatorofuserinterestfirst.However,theuserinterestlabelsareunobservedinreal-worlddatasets.Although
explicit feedback can reflect user interest and is not affected by
durationbias,itsuffersfromsevereselectionbiasandnoise[ 19,42,
44]: this indicates that users might not provide explicit feedback
forvideostheylikeandmightmistakenlyprovideexplicitfeedback
for videos they dislike. Therefore, using explicit feedback as a label
forevaluatingrelevancerankingtasksisinappropriate.Tothisend,
we defined user interests based on CWT in Eq. (8). However, the
unbiasedness of this interest label still needs to be discussed.
To achieve duration unbiased, the user interest indicator 𝑟𝑢,𝑣
needs to fulfill two characteristics: (1) it should be independent
of video duration, and (2) when 𝑟𝑢,𝑣=1, user explicit feedback
should be equivalent across all video duration (thus mitigating the
issuedescribedinFig1).Toverifywhetherourinterestindicator
definedinEq. (8)satisfiestheabovecharacteristics,wecalculatethe
proportionofuserinterestlabels 𝑟𝑢,𝑣andtheproportionofexplicit
feedback when 𝑟𝑢,𝑣=1grouped by video duration. Note that since
videosshorterthan 𝑤0.7cannotachieveawatchtimeof 𝑤0.7,we
excludethesevideosfromouranalysis.Theresultsarepresentedin
Fig10.Itisevidentthatourdefined 𝑟𝑢,𝑣roughlysatisfiestheabove
two characteristics on both the KuaiRand and WeChat datasets,
thus indicating its unbiasedness.
D More Experimental results
D.1 Parameter sensitivity
There are two hyper-parameters in the proposed CWM: one is the
userwatchcost 𝑐inthecost-basedtransformfunction(Eq. (3)).The
larger the 𝑐, the more sensitive users are to watch time; Another
is the variance term 𝜎of user interest in counterfactual likelihood
function (Eq (6)). The larger the value of 𝜎, the more dispersed the
user’s interest distribution is. Fig. 11 illustrates the performance
changesofrecommendationwithdifferentvaluesof 𝑐and𝜎.For
watch time prediction (Fig. 11(a)), the best hyper-parameter is 𝜎∈
(1.0,2.0)∧𝑐∈(1/40,1/20); For relevance ranking (Fig. 11(b)), the
besthyper-parametersis 𝜎∈(2.0,5.0)∧𝑐∈(1/80,1/60).Notethat
the best hyper-parameters of two tasks may not be the same. In
practice, it is necessary to adjust the hyper-parameters to make
CWM perform best.
D.2Betterfittothetruewatchtimedistribution
WeexaminewhetherCWMcanfitthetruewatchtimedistribution.
Asacomparison,wealsopresenttheestimatedwatchtimedistribu-
tionbyPCR,whichisrepresentativeofexistingdebiasingmethods.
Fig 12(a) shows the true and estimated watch time distribution on
videos with less than 100s duration on KuaiRand. We can find that
the estimated watch time distribution by PCR is more flattening
than the true distribution. It overestimates higher watch time (i.e.,
>10s).Incontrast,ourCWMcanfitthetruedistributionevenbetter.
Fig 12(b) shows the true and estimated watch time distribution on
videos with 30s duration on KuaiRand. It can be found that PCR
only estimates a single-peaked distribution which differs signifi-
cantly from the true bimodal distribution. In comparison, CWM
can estimate a similar bimodal distribution to the true distribution,
demonstrating CWM’s effectiveness in watch time prediction.
4466