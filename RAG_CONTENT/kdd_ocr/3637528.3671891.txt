A Uniformly Bounded Correlation Function
for Spatial Point Patterns
Evgenia Martynova
evgenia.martynova@radboudumc.nl
Radboud University Medical Center
Nijmegen, The NetherlandsJohannes Textor
johannes.textor@ru.nl
Radboud University
Nijmegen, The Netherlands
ABSTRACT
A point pattern is a dataset of coordinates, typically in 2D or 3D
space. Point patterns are ubiquitous in diverse applications includ-
ing Geographic Information Systems, Astronomy, Ecology, Biology
and Medicine. Among the statistics used to quantify point pat-
terns, most are based on Ripley’s 𝐾-function, which measures the
deviation of the observed pattern from a completely random ar-
rangement of points. This approach is useful for constructing null
hypothesis tests, but Ripley’s 𝐾and its variants are less suitable as
quantitative effect sizes because their ranges and expected values
generally depend on the scale or the size of the region in which
the pattern is observed. To address this, we propose a new function
that behaves like a correlation coefficient for point patterns: it is
tightly bounded by -1 and 1, with a value of -1 corresponding to a
maximally dispersed arrangement of points, 0 indicating complete
spatial randomness, and 1 representing maximal clustering. These
properties are independent of scale and observation window size
assuming appropriate edge correction. Evaluating our function on
simulated data, we show that it has comparable statistical calibra-
tion and power to 𝐾-based baselines. We hope that the ease of
interpretation of our bounded function will facilitate the analysis
of spatial data across multiple fields.
CCS CONCEPTS
•Mathematics of computing →Multivariate statistics; Cluster
analysis ; Exploratory data analysis.
KEYWORDS
spatial statistics, point pattern analysis, clustering
ACM Reference Format:
Evgenia Martynova and Johannes Textor. 2024. A Uniformly Bounded Cor-
relation Function for Spatial Point Patterns. In Proceedings of the 30th ACM
SIGKDD Conference on Knowledge Discovery and Data Mining (KDD ’24),
August 25–29, 2024, Barcelona, Spain. ACM, New York, NY, USA, 12 pages.
https://doi.org/10.1145/3637528.3671891
1 INTRODUCTION
Stars in the sky, buildings in cities, fishes in the sea, cells in tissues,
and molecules on cell membranes are just a few examples of ob-
jects whose spatial configuration can be represented and analyzed
This work is licensed under a Creative Commons Attribution
International 4.0 License.
KDD ’24, August 25–29, 2024, Barcelona, Spain
©2024 Copyright held by the owner/author(s).
ACM ISBN 979-8-4007-0490-1/24/08.
https://doi.org/10.1145/3637528.3671891aspoint patterns : sets of points in 2D or 3D space. Technological
advances like automated digital microscopy have increased the va-
riety and size of available point pattern datasets. Spatial statistics is
a mature field that has produced well-established methodology to
analyze point patterns. The most important and fundamental point
pattern statistic is perhaps Ripley’s 𝐾-function [ 24], which com-
pares the number of neighbors of a random point within distance 𝑟
to its expectation for a random spatial distribution. Higher values
of𝐾indicate clustering, whereas lower values indicate dispersion
between objects. Various statistical significance tests have been
developed for 𝐾and its variants [1].
Spatial statistics is widely used in some fields, such as Ecology [ 4]
and Epidemiology [ 12], but less so in others like Molecular Biology
[3] or Pathology [ 33]. For instance, although there are applications
of Ripley’s𝐾to cell positions in tumor samples [ 38], simpler region-
based [ 5,18] or nearest-neighbor [ 15] analyses are more common.
These methods are easier to interpret, but as pointed out by Wilson
et al. [38], they are affected by various artefacts such as border
effects, density-dependence, and spatial heterogeneity that Ripley’s
𝐾and its variants are designed to avoid.
This work is based on the hypothesis that the low adoption of
spatial statistics in some fields may be in part due to the lack of
a simple quantitative effect size. 𝐾is not an effect size because
its scale is proportional to the area of the region wherein a point
pattern is mapped, which makes it difficult to compare 𝐾values
across different samples and assess the scientific importance of
a statistically significant 𝐾. To address this issue, we propose a
statistic LCF(𝑟)that is based on Ripley’s 𝐾and has the following
properties:
(1) LCF(𝑟)is limited to the range [−1,1];
(2) For a random point pattern, LCF (𝑟)=0asymptotically;
(3)For a maximally clustered point pattern (i.e., all points over-
lap), LCF(r) =1.
(4)For a lattice, LCF(𝑟)=−1if𝑟is smaller than the distance
between nearest neighbors.
These properties are inspired by the linear correlation coeffi-
cients that most scientists are familiar with. This motivates us to
call our statistic a local correlation function, LCF. Like all 𝐾-based sta-
tistics, LCF is a function of the spatial scale 𝑟, which is an important
property because clustering and dispersion are not scale-invariant.
To our knowledge, there is no other 𝐾-based statistic that has simi-
lar properties to aid interpretation of the results. Moreover, as we
will show, naive centering and scaling of 𝐾do not result in a metric
that satisfies (1) - (4).
2177
KDD ’24, August 25–29, 2024, Barcelona, Spain Evgenia Martynova and Johannes Textor
This paper is structured as follows: first, we derive 𝐿𝐶𝐹(𝑟)based
on the above properties, discuss its relation to other 𝐾-based statis-
tics, and illustrate some of its fundamental properties using simu-
lated point patterns. Next, we empirically examine the calibration
and power of statistical tests constructed on LCF and show that
they are comparable to those of other 𝐾-based statistics. Finally, we
demonstrate how LCF(r) can be applied in practice by analyzing
the positions of immune cells in tumor biopsies and the locations
of air pollution and waste generation facilities.
2 BACKGROUND & RELATED WORK
2.1 Preliminaries and Definitions
Apoint pattern 𝑃={𝑝1,...,𝑝𝑛}with𝑝𝑖∈𝑊is a set of𝑛 𝑑-
dimensional points contained in an observation window 𝑊⊂R𝑑
with (hyper) volume |𝑊|. For instance, a forest could be described
as a point pattern, where 𝑊is the 2D region considered as the
forest and𝑝𝑖are the positions of the trees. A point processPis a
random element whose realizations are point patterns in 𝑊. For
example, complete spatial randomness (CSR) – or a Poisson point
process – is a point process where 𝑛follows a Poisson distribution
with parameter 𝜆|𝑊|and, conditioned on a given 𝑛, the𝑝𝑖are inde-
pendently drawn from the uniform distribution on 𝑊. The average
number of points per unit area 𝜆=E[𝑛]/|𝑊|is called the intensity
of a point process and it uniquely defines a Poisson point process.
Generally, intensity can be a function of spatial location, but in this
work we consider only homogeneous intensity. An important basic
statistic to characterize point processes is the expected number of
neighbours of a random point within radius 𝑟, which we denote as
𝑁(𝑟). More formally, for a given point process Pand point𝑝∗∈𝑊,
we define
𝑁(𝑝∗,𝑟)=E𝑃∈P[number of points in 𝑃at distance≤𝑟of𝑝∗]
(1)
and
𝑁(𝑟)=E𝑃∈P[E𝑝∗∈𝑃[𝑁(𝑝∗,𝑟)]]. (2)
Non-random point patterns can be characterized by comparison
to CSR. For example, clustering (perhaps caused by attraction be-
tween objects) can be defined as a local intensity of points that is
higher than expected from CSR; by contrast, dispersion (perhaps
caused by repulsion or inhibition) leads to a lower than expected
number of points near a reference point. Point patterns can exhibit
different characteristics at different spatial scales; e.g., a point pat-
tern consisting of dense clusters arranged on a 2D grid is clustered
at small scales and dispersed at the distance between clusters.
Various summary functions have been proposed to quantify and
test the non-randomness of point patterns at different spatial scales.
The influential Ripley’s𝐾-function is defined as:
𝐾(𝑟)=𝜆−1𝑁(𝑟) (3)
Normalization by 𝜆allows comparing patterns of different den-
sities. Formally, 𝐾is a property of the underlying point process
that gave rise to an observed pattern; for a given point pattern, it is
empirically estimated as follows:
ˆ𝐾(𝑟)=ˆ𝜆−1ˆ𝑁(𝑟)ˆ𝑁(𝑟)=1
𝑛𝑛∑︁
𝑖=1∑︁
𝑗≠𝑖1(𝑑𝑖𝑗<𝑟)𝑒𝑖𝑗(𝑟) (4)where 1is the indicator function and 𝑑𝑖𝑗is the Euclidean distance be-
tween points. The edge correction weight 𝑒𝑖𝑗(𝑟)accounts for points
near the boundary of 𝑊for which some neighbors within distance
𝑟might be unobserved. Many different edge correction methods
have been proposed [ 13,20,26]; throughout the paper, we assume
that the weights are chosen such that the monotonicity of 𝑁(𝑟)
is preserved, which is usually the case. The intensity 𝜆is often
assumed to be homogeneous and for convenience is estimated as
ˆ𝜆=(𝑛−1)/|𝑊|, since the number of neighbors is at most 𝑛−1.
For example, for CSR in two dimensions, 𝐾(𝑟)=𝜋𝑟2.
To facilitate interpretation and testing deviation from CSR, sev-
eral variants of 𝐾have been proposed; here we focus on two
important ones in the two-dimensional case. First, the function
𝐻(𝑟)=√︁
𝐾(𝑟)/𝜋−𝑟has expectation 0 and approximately constant
variance under CSR [ 6,25]. Since it is centered at 0 and depends on
𝑟linearly, visual assessment of 𝐻is much easier. Second, the pair
correlation function (PCF) defined by
𝑃𝐶𝐹(𝑟)=𝐾′(𝑟)
2𝜋𝑟
isnon-cumulative, i.e., its value refers only to interpoint distances
equal to𝑟, not all distances≤𝑟as for K and H. Thus, PCF is better
suited for accessing spatial dynamics at a given scale.
All𝐾-based functions can be extended to quantify the co-localization
of two types of objects; for example, for a point process Pwith
multiple types of objects, the cross-𝐾-function is defined as:
𝐾𝑖𝑗(𝑟)=𝜆−1
𝑗E[the number of neighbors of type 𝑗within
distance𝑟of a random point of type 𝑖]
which can be estimated by
ˆ𝐾𝑖𝑗(𝑟)=ˆ𝜆−1
𝑗ˆ𝑁𝑖𝑗(𝑟)ˆ𝑁𝑖𝑗(𝑟)=1
𝑛𝑖𝑛𝑖∑︁
𝑘=1𝑛𝑗∑︁
𝑙=11(𝑑𝑘𝑙<𝑟)𝑒𝑘𝑙(𝑟)(5)
Here𝑛𝑖(𝑛𝑗) is the number of points of type 𝑖(𝑗).
2.2 Related Work
Recent work in spatial statistics has focused on domain-specific
adaptations of the classical summary functions defined above. For
instance, cross-PCF extensions that account for the properties of
multi-channel microscopy data have been proposed: the neigh-
borhood correlation function distinguishes different types of co-
localization between 3 types of cells in tissue images [ 8], whereas
the weighted pair correlation function (wPCF) accounts for a pos-
sible uncertainty in cell type assignment [ 7]. Motivated by the
need in microbiology to analyze protein distribution on the cellu-
lar membrane of bacteria, Ward et al. proposed a generalized test
of CSR on arbitrary 3D convex shapes instead of Euclidean space
[36]. To address important spatial heterogeneities that arise in an-
imal ecology, Schiffers et al. investigated using the derivative of
the PCF as a new summary function [ 28]. Other relevant research
aims at estimating interaction distances from summary functions.
For example, Kiskowski et al. proposed using[𝐻𝑚𝑎𝑥]or[𝐻′
𝑚𝑖𝑛]to
estimate cluster diameters in a point pattern [16].
In contrast to these works, our research focuses on the require-
ment of a bounded and interpretable scale. The Hopkins statistic
of cluster tendency is bounded between 0and1and its expected
value for CSR is 0.5; however, it is a global index that aggregates
2178A Uniformly Bounded Correlation Function
for Spatial Point Patterns KDD ’24, August 25–29, 2024, Barcelona, Spain
information across all spatial scales [ 14]. The well-known nearest-
neighbor and empty-space summary functions are scale-specific
and bounded between 0and1[10]. However, their values are hard
to interpret as effect sizes because they are cumulative distribution
functions. A seemingly simple approach to obtaining a summary
function limited to [−1,1]and with an expected value of 0for CSR
is to normalize the H-function, the centered version of 𝐾, by its
maximum value [ 37]; we denote this normalized version as 𝐻1(𝑟).
As can be seen from Equation 4, 𝐾’s supremum is generally not
constant: sup ˆ𝐾(𝑟)=ˆ𝜆−1𝑛−1Í𝑛
𝑖=1Í
𝑗≠𝑖𝑒𝑖𝑗(𝑟). If we assume that
all points are observed, the expression simplifies to sup ˆ𝐾(𝑟)=|𝑊|
as𝑒𝑖𝑗(𝑟)=1. Then,𝐻1(𝑟)=𝐻(𝑟)/𝐻𝑚𝑎𝑥, 𝐻𝑚𝑎𝑥=√︁
|𝑊|/𝜋is
bounded between sup ˆ𝐻(𝑟)=1−𝑟/𝐻𝑚𝑎𝑥 andinfˆ𝐻(𝑟)=−𝑟/𝐻𝑚𝑎𝑥,
hence𝐻1(𝑟)∈[− 1,1]in the interval[0,𝐻𝑚𝑎𝑥]. However, as we
will see, the bounds of 𝐻1are not tight for all 𝑟, and the actually
achievable maximum and minimum values depend on the obser-
vation window size, meaning that our requirements (3) and (4) are
not fulfilled.
In summary, we are not aware of previous work in which a
summary function that meets the requirements stated in the intro-
duction has been designed and formally analyzed.
3 THE LOCAL CORRELATION FUNCTION
In this section, we will derive the local correlation function and
show that it satisfies the requirements outlined in the introduction.
We will continue to discuss its asymptotic properties and estimation
for a given point pattern.
3.1 Derivation and Properties
Our LCF will be based on Ripley’s 𝐾, or more precisely, on the
underlying summary function 𝑁(𝑟), the expected number of points
within distance 𝑟of a random point (Equation 2). We first define
notions of “maximal” dispersion and clustering of a point process
that will serve to calibrate the minimum and maximum values of
the LCF, respectively.
Definition 3.1. A point processPwith𝑁(𝑟)=0ismaximally
dispersed at distance 𝑟. If𝑁(𝑟)>0and𝑁(𝑟)=𝑁(ℎ𝑟)for some
ℎ>1, thenPismaximally clustered at distance𝑟.
For example, the regular 2D square integer lattice Z2is maxi-
mally dispersed at distances 𝑟<1; a point process with all points
contained in the unit circle is maximally clustered at 𝑟≥2.
Definition 3.1 suggests that a suitable building block for our LCF
is the ratio 𝑁(𝑟)/𝑁(ℎ𝑟)for “small”ℎ(Figure 1A). This quantity
is bounded between 0 and 1, with both bounds being attainable.
In addition, we want the “middle” of this range to correspond to
CSR. Since under CSR, the points are uniformly distributed in the
observation window, the expected number of points falling in any
region𝐴is proportional to its area, i.e. it is equal to 𝜆|𝐴|. Thus, the
following property holds:
Property 3.1. Take𝑟>0andℎ>1. Then for complete spatial
randomness, 𝑁(ℎ𝑟)=ℎ2𝑁(𝑟).
Property 3.1 motivates a transformation of the ratio 𝑁(𝑟)/𝑁(ℎ𝑟)
that maps the minimum value to -1, the maximum value to 1, and
the characteristic value 1/ℎ2to 0. With this, we arrive at the final
A
rhr
15 units
B
051015H-1.0-0.50.00.51.0LCF0153050100r0153050100rFigure 1: Design principle of LCF. A) LCF compares the
number of points within distances 𝑟andℎ𝑟(hereℎ=√
2)
from a random point in the given pattern. This is moti-
vated by how the number of neighbors of a reference point
𝑝∗changes depending on the pattern type. For a dispersed
pattern (left, inhibition distance 15), ˆ𝑁(𝑝∗,15)(inner circle)
is smaller than ˆ𝑁(𝑝∗,15√
2)(outer circle); for CSR (middle),
ˆ𝑁(𝑝∗,15√
2)≈ 2ˆ𝑁(𝑝∗,15); for a clustered pattern (right, clus-
ter radius 15), ˆ𝑁(𝑝∗,15√
2)≈ ˆ𝑁(𝑝∗,15)when𝑝∗is near the
cluster center. See Appendix A.1 for simulation details. B)
ˆ𝐻(𝑟)and ˆ𝐿𝐶𝐹(𝑟)for the patterns from panel A. Dashed lines
show inhibition distance anthe cluster diameter.
LCF formula:
𝐿𝐶𝐹(𝑟,ℎ)=(
2𝑁(𝑟)
𝑁(ℎ𝑟)𝑎
−1, 𝑎=ln 2
2 lnℎ, 𝑁(ℎ𝑟)>0
−1, 𝑁(ℎ𝑟)=0(6)
Note that although this function is specific to the 2D case, it can be
adapted to other dimensions.
Proposition 3.2. 𝐿𝐶𝐹(𝑟,ℎ)∈[− 1,1].
Proof. Forℎ,𝑟:𝑁(ℎ𝑟)=0, 𝐿𝐶𝐹(𝑟,ℎ)=−1by definition.
Since𝑁(𝑟)≤𝑁(ℎ𝑟),𝑁(𝑟)
𝑁(ℎ𝑟)∈[0,1]when𝑁(ℎ𝑟)>0, and therefore
2(𝑁(𝑟)/𝑁(ℎ𝑟))𝑎−1∈[−1,1]for any𝑎. □
Proposition 3.3. 𝐿𝐶𝐹(𝑟,ℎ)=−1for a maximally dispersed and
𝐿𝐶𝐹(𝑟,ℎ)=1for a maximally clustered point process.
Proof. First, we consider 𝐿𝐶𝐹(𝑟,ℎ)=−1. This value occurs
when𝑁(𝑟)=0, which is our definition of maximal dispersion at
distance𝑟, or when𝑁(ℎ𝑟)=0, which implies 𝑁(𝑟)=0.
For𝐿𝐶𝐹(𝑟,ℎ)=1𝑁(𝑟)
𝑁(ℎ𝑟)𝑎
=1⇒𝑁(𝑟)=𝑁(ℎ𝑟). According
to Definition 3.1, this means maximal clustering at 𝑟. □
2179KDD ’24, August 25–29, 2024, Barcelona, Spain Evgenia Martynova and Johannes Textor
Table 1: Properties of LCF compared to baselines
Metric∈[−1,1]→0for CSR =−1for MD =1for MC
𝐾 ✗ ✗ ✗ ✗
𝐻 ✗ ✓ ✗ ✗
𝐻1 ✓1✓ ✗ ✗
PCF ✗ ✗ ✗ ✗
LCF ✓2✓ ✓ ✓2
MC: maximal clustering, MD: maximal dispersion.
1Holds for𝑟∈[0,𝐻𝑚𝑎𝑥]and when edge correction is not necessary.
2Holds when monotonicity of 𝑁(𝑟)is preserved in the estimate ˆ𝑁(𝑟).
Although given for the “true” 𝐿𝐶𝐹 of a point process, Defini-
tion 3.1 and Propositions 3.2 and 3.3 also hold for ˆ𝐿𝐶𝐹 estimated
from a given point pattern under the assumption that ˆ𝑁(𝑟)is mono-
tonically non-decreasing. Figure 1 shows ˆ𝐿𝐶𝐹(𝑟)and ˆ𝐻(𝑟)for dis-
persed, random, and clustered point patterns.
Lastly, we characterize the behavior of LCF under CSR. Since
LCF is a nonlinear function of 𝑁(𝑟)and𝑁(ℎ𝑟), it is not trivial
to establish its expectation for a given 𝜆. However, its asymptotic
behavior is easy to derive from the asymptotic consistency of 𝐾.
Our experiments in this paper suggest that the asymptotic regime
is reached relatively quickly, at least for the data we analyze.
Proposition 3.4. Consider the random point process Pwith in-
tensity𝜆. As𝜆→∞, ˆ𝐿𝐶𝐹(𝑟,ℎ)→ 0in probability.
Proof. As𝜆→∞ ,ˆ𝐾(𝑟)→𝜋𝑟2and ˆ𝐾(ℎ𝑟)→𝜋ℎ2𝑟2in prob-
ability. Recall that ˆ𝑁(𝑟)=𝜆ˆ𝐾(𝑟). Since𝑔(𝑥,𝑦)=2(𝑥/𝑦)𝑎−1is
a continuous function, we get ˆ𝐿𝐶𝐹(𝑟,ℎ)→ 0by the continuous
mapping theorem. □
Hence, we have verified that LCF satisfies the properties (1) -
(4) stated in the introduction. Table 1 highlights that none of the
classical summary functions possess all these desiderata. Although
both LCF and 𝐻1are limited to[−1,1]under certain assumptions,
the assumption that guarantees the boundedness of LCF is much
milder. While, in practice, it is rare that all events occur inside of the
observation window, monotonicity of ˆ𝑁(𝑟)usually holds. Uniform
bounds, crucial for a straightforward interpretation of the function
value, are a unique property of LCF.
Since LCF is based on Ripley’s 𝐾, we can benefit from the theory
and extensions developed for 𝐾. For example, a “cross-LCF” can
be obtained by simply substituting 𝑁(𝑟)with𝑁𝑖𝑗(𝑟)as defined in
Equation 5:
𝐿𝐶𝐹𝑖𝑗(𝑟)=(
2𝑁𝑖𝑗(𝑟)
𝑁𝑖𝑗(ℎ𝑟)𝑎
−1𝑁𝑖𝑗(ℎ𝑟)>0
−1, 𝑁𝑖𝑗(ℎ𝑟)=0
We now investigate asymptotic properties of a simplified version
of LCF to gain insight into how to choose the bandwidth parameter
ℎ.
3.2 Asymptotic Properties of LCF
Deriving asymptotic distributions of summary functions in spa-
tial statistics is challenging even for CSR due to the dependence
between point pairs and edge effects. Therefore, statistical testsconstructed around the 𝐾-function typically rely on Monte Carlo
simulations. For instance, Lang et al. [17] obtained an exact asymp-
totic distribution for 𝐾evaluated in a square observation window
under CSR. Even in this seemingly simple scenario, the derivations
are complex and no closed form can be obtained. Given these diffi-
culties, we instead choose to consider the asymptotic distribution
of a pointwise version of LCF centered at a given reference point
𝑝∗, which we assume to be well within 𝑊so that we can ignore
edge effects. We define
𝐿𝐶𝐹(𝑝∗,𝑟,ℎ)=2𝑁(𝑝∗,𝑟)
𝑁(𝑝∗,ℎ𝑟)𝑎
−1, 𝑁(𝑝∗,ℎ𝑟)>0
Proposition 3.5. Let𝑊be an arbitrary observation window. If
𝑝∗,𝑟andℎare chosen such that the circle {𝑥|∥𝑥−𝑝∗∥≤ℎ𝑟}lies
fully within 𝑊, then asymptotically:
𝐿𝐶𝐹(𝑝∗,𝑟,ℎ,𝑛)∼N
0,1
𝑛|𝑊|
𝜋𝑟2(ln 2)2
22(ℎ2−1)
(lnℎ)2ℎ2
The proof based on the Delta method is given in Appendix A.2.
This result provides two important insights. First, since the variance
is inversely proportional to 𝑟2, the uncertainty of the estimate is
higher for lower 𝑟. Second, even for this simplified LCF, the variance
diverges asℎ→1:limℎ→1ℎ2−1
(lnℎ)2ℎ2=limℎ→12
lnℎ=∞.
3.3 A Bandwidth-Free LCF
Proposition 3.5 implies that choosing a bandwidth parameter ℎ
empirically is not trivial: too large ℎwill lead to dilution across spa-
tial scales, whereas too small ℎwill lead to potentially unbounded
estimation error. Therefore, we suggest an approach to remove ℎ
from the definition of LCF.
Proposition 3.6. limℎ→1𝑁(𝑟)
𝑁(ℎ𝑟)𝑎
=exp
−ln 2
2𝑟𝑁′(𝑟)
𝑁(𝑟)
.
The proof is given in Appendix A.2. Thus, our revised bandwidth-
free definition of LCF is:
𝐿𝐶𝐹(𝑟)=(
2 exp
−ln 2
2𝑟𝑁′(𝑟)
𝑁(𝑟)
−1, 𝑁(𝑟)>0
−1, 𝑁(𝑟)=0(7)
The requirements stated in the introduction still hold for (7):
Proposition 3.7. 𝐿𝐶𝐹(𝑟)∈[−1,1].
Proposition 3.8. 𝐿𝐶𝐹(𝑟)=−1for a maximally dispersed and
𝐿𝐶𝐹(𝑟)=1for a maximally clustered point process.
Proofs are in Appendix A.2.
The appearance of the derivative 𝑁′(𝑟)in our bandwidth-free
LCF is reminiscent of the pair correlation function (PCF), and there
is indeed a relation between the two. Equation 7 can be rewritten
as follows:
𝐿𝐶𝐹(𝑟)=2 exp
−ln 2
2𝑟𝐾′(𝑟)
𝐾(𝑟)
−1=2 exp
𝜋𝑟2𝑃𝐶𝐹(𝑟)
𝐾(𝑟)
(8)
This reveals that LCF can be interpreted as a version of PCF normal-
ized by the ratio 𝐾(𝑟)/𝜋𝑟2(i.e.,𝐾divided by its expectation under
CSR) and mapped to the interval [−1,1]. For the same PCF value,
LCF increases when 𝐾(𝑟)/𝜋𝑟2>1(indicating clustering), and de-
creases in the opposite case (indicating dispersion). An important
2180A Uniformly Bounded Correlation Function
for Spatial Point Patterns KDD ’24, August 25–29, 2024, Barcelona, Spain
conceptual difference between LCF and PCF is that PCF is does not
behave like a statistical correlation because it is unbounded from
above, while LCF is designed to behave like a correlation coefficient.
Instead of setting a bandwidth parameter ℎ, Equation 8 requires
estimation of the derivative 𝑁′(𝑟). Estimating function derivatives
is a well-studied problem, and a wide array of techniques is available.
Given the monotonicity of ˆ𝑁(𝑟), we chose to obtain a smooth
approximation using the shape constraint additive models (SCAM)
framework proposed by Pya et al. [22]. SCAM imposes constraints
on B-spline coefficients to achieve various shape properties, such
as monotonicity. As for all splines, the analytical computation of a
derivative is straightforward after the fit has been performed.
The key smoothing parameter of SCAM is the number of B-spline
basis functions 𝑞, which should be chosen so that the model can
approximate ˆ𝑁(𝑟)well while avoiding overfitting. Unless stated
differently, throughout the paper we use a simple rule of thumb 𝑞=√𝑛, which we have found to work reasonably well empirically. The
parameter𝑞can also be tuned as described in [ 9], which we leave
for future work. Implementation details are given in Appendix A.3.
4 EMPIRICAL ANALYSIS
In this section, we first compare LCF to other summary functions
on the reference point processes: maximally dispersed, CSR, and
maximally clustered (Figure 2A). Next, we investigate simulated
point patterns to check whether LCF is able to detect characteris-
tic distances. Lastly, we perform calibration and power analyses
in comparison to 𝐾-based baselines. All summary functions are
estimated using isotropic edge correction.
Until now, we explicitly distinguished the population value of a
summary function from its estimate. Since we use only empirical
estimates in further analysis, we drop this distinction for brevity,
and all functions refer to empirical estimates. Detailed information
about the used point processes and significance testing is provided
in the Appendix.
4.1 LCF for Reference Point Patterns
The core idea of our work is that for a summary function to be
interpretable and suitable for comparing multiple samples, it is
essential to have a bounded scale with limits corresponding to
“extreme” spatial arrangements. Here we demonstrate this visually
by comparing the plots of 𝐾,𝐻1,𝑃𝐶𝐹, and𝐿𝐶𝐹 for realizations
of the reference point processes depicted in Figure 2A. The point
patterns are sampled in a squared observation window, and we vary
the window area as 1, 2, and 4. Since the spatial structure of our
reference point patterns is the same regardless of the observation
window, we would hope to see that the spatial statistics are not
affected by changing |𝑊|.
Figure 2B shows that LCF indeed behaves in the most consistent
manner across the different window sizes. For all other summary
functions, the maximum value depends on |𝑊|; this includes 𝐻1,
which does have an upper bound of 1, but the actually attainable
value changes with 𝑊. The differences in the behavior of the sum-
mary functions become most clear on the lattice, which exhibits
clustering and dispersion intermittently for 𝑟>𝑟𝑑, since𝑁(𝑟)is a
stepwise function for this pattern. According to our Definition 3.1,
the lattice is maximally clustered in intervals where the number of
A
0.1 units
0.01.02.04.0K0.00.51.0H1
0.02.04.0PCF
-1.00.01.0LCF|W|= 1|W|= 2|W|= 4
00.500.500.51r
BFigure 2: LCF compared to baselines for reference point pat-
terns. A) Left: a triangular lattice of side length 0.15; center:
CSR; right: a dense cluster of radius 0.05. B) Summary func-
tions for the reference point patterns (colors correspond to
A) observed in windows of different sizes. The functions are
estimated for 𝑟∈[0,√︁
|𝑊|/𝜋], since𝐻1(𝑟)∈[− 1,1]in this in-
terval. Note that PCF diverges for small 𝑟for the maximally
clustered pattern.
neighbors is constant. LCF is indeed 1there, emphasizing that the
clustered and dispersed patterns have similar spatial structure in
these intervals. These sharp changes in spatial arrangement can be
noticed with other summary functions too, as their plots for the
dispersed pattern fluctuate around CSR. However, the difference
between dispersion and CSR appears insignificant for 𝐾and𝐻1
considering the range. PCF captures the difference between disper-
sion and CSR much better, and rapidly drops to 0for the clustered
pattern. This behaviour is consistent with the inverse relationship
between PCF and LCF suggested by the Formula 8. However, inter-
pretation of PCF >1is not straightforward due to the lack of an
upper bound.
2181KDD ’24, August 25–29, 2024, Barcelona, Spain Evgenia Martynova and Johannes Textor
4.2 LCF Extrema and Characteristic Distances
A
50 units
B
-101LCF
0100200300400H
0100200300PCF50    7012017050r
Figure 3: Identifying characteristic distances. A) Left: three
clusters with centroids located 120 units apart. Right: a real-
ization of the Matern process that produces randomly located
clusters. In both patterns, the clusters are circular with a ra-
dius of 25, and the points are uniformly distributed inside the
clusters. Simulations are performed in a 1000x1000 square,
from which a centered subregion is shown. B) Corresponding
plots of LCF, 𝐻, and PCF. Dashed lines show the characteris-
tic distances.
Figure 3 compares LCF, 𝐻, and PCF for two simulated point pat-
terns with known characteristic distances. Although we designed
the two patterns to have the same total intensity, the difference in
function magnitude is about 10-fold for both 𝐻and PCF. This is
because, in addition to the dependence on |𝑊|, the magnitude of
𝐻and PCF depends on the local density of the points. By contrast,
since LCF essentially compares the arrangement of points at differ-
ent scales, its value is much less dependent on the local density. As
a result, the spatial structure of two different patterns is easier to
compare.
The point pattern with three clusters has four characteristic
distances: the cluster diameter (50), the distance between cluster
centers (120), and the minimal and maximal distances between
points in clusters (70 and 170). By contrast, the Matern process is
characterised only by the cluster diameter (50). The 𝐻function
does reflect the characteristic distances to some extent – two local
maxima and one local minimum indicate attraction and repulsion
in the three-cluster pattern, while 𝐻has a global maximum for theMatern process. However, due to the cumulative nature of 𝐻and
its dependence on|𝑊|, the positions of the extrema do not exactly
coincide with the interaction distances. By contrast, the extrema of
LCF and PCF do indicate the characteristic distances well, but as
pointed our in the previous section, the meaning of their extrema
is the opposite.
4.3 Statistical Analysis
To more formally investigate the capacity of LCF to detect devia-
tion from randomness in point patterns, we constructed statistical
tests based on LCF, 𝐻, and PCF and compared their calibration and
power.𝐻was chosen due to its popularity in applied analysis and
stabilized variance [ 1]. The comparison to PCF is natural because of
its close relation to LCF discussed above. Since the distributions of
the summary functions are not known in the general case, we use
Monte Carlo tests that approximate the null distribution by sam-
pling from the null hypothesis (in this case, CSR). For simplicity, we
perform the test at a single, fixed distance 𝑟∗, which we hypothesize
to be an interaction distance. That is, 𝐻(𝑟∗),𝑃𝐶𝐹(𝑟∗), and𝐿𝐶𝐹(𝑟∗)
are the test statistics. As explained in [ 1], such a pointwise test is
valid when𝑟∗is chosen in advance.
4.3.1 Calibration. A perfectly calibrated statistical test produces
uniformly distributed p-values for samples from 𝐻0, hence, the
fraction of samples for which 𝐻0is rejected should be equal to
the significance level. The Monte Carlo test is set up as follows:
to approximate the null distribution, we draw 5000 point patterns
from the Poisson process and calculate their test statistics for all
considered functions. Then, 𝑚=1000 more Poisson process realiza-
tions are tested for CSR; the corresponding two-sided p-values are
computed and used to calculate the Type I error at different signifi-
cance levels. Point patterns are simulated in a square observation
window, and the hypothesized interaction distance is set to 𝑟∗=5.
We vary the sample size 𝑛and the observation window area |𝑊|.
Uncertainty is quantified by generating simulated null distributions
for the test statistics of 𝑚point patterns assuming CSR. 95% BCa
confidence intervals are computed [11].
Figure 4 shows the results of this analysis on a log10-log10
scale to emphasize the calibration for significance levels commonly
used in hypothesis testing. PCF is relatively well calibrated even
for small sample sizes, whereas LCF requires a larger sample size
than𝐻to achieve good calibration. At low intensities, LCF is overly
conservative at realistic significance levels <0.05. On the other hand,
𝐻and PCF show a “stepwise” calibration curve in almost all cases.
Regardless, all functions achieve good calibration when the sample
size is 100 and the observation window area is ≤2·104.
4.3.2 Power. To test the power of the different summary functions
to detect non-random point patterns, we used a Monte Carlo test
similar to the one described above but with the 𝑀different point
patterns drawn from one of three non-random point processes.
Specifically, we used the Hardcore andStrauss processes to generate
dispersed point patterns; for clustering, we again used the Matern
cluster process. We performed a one-sided test for non-random
clustering (e.g., 𝐻0:𝐿𝐶𝐹=0vs.𝐻𝑎:𝐿𝐶𝐹>0) at the 0.05signifi-
cance level. All point patterns were simulated in a 200x200 square.
2182A Uniformly Bounded Correlation Function
for Spatial Point Patterns KDD ’24, August 25–29, 2024, Barcelona, Spain
1.250.6250.31252.51.250.62552.51.2525 points50 points100 points|W|2|W|4|W|-3-2-10-3-2-10-3-2-10-3-2-10
-3-2-10
-3-2-10log10 Significance levellog10 Type I errorHPCFLCF
Figure 4: Calibration of LCF, 𝐻, and PCF for different sample
sizes and observation window areas. |𝑊|=2·104. The inten-
sity of the corresponding point process (units 10-4) is shown
in the top left corner of each panel. Shading: 95% confidence
intervals.
Uncertainty was quantified in the same way as in the calibration
analysis.
The Hardcore process inhibits the occurrence of point pairs
closer than a “hardcore distance” 𝑅. In the Strauss process, a close
pair is accepted with the probability 𝛾. The motivation for including
both Hardcore and Strauss processes is that for many real-world
objects, the Hardcore process is a realistic representation of random
spatial distribution because of spatial exclusion at distances resem-
bling the sizes of the objects. However, we expected the hardcore
inhibition to be straightforward to detect and additionally test the
summary functions on the more challenging Strauss process. The
Matern cluster process is characterised by the average number of
clusters𝑛𝑝, the cluster radius 𝑅𝑐and the intensity of the points
within clusters.
We conducted the power analysis for different effect sizes. The
Hardcore process with 𝑅=0is equivalent to CSR, and a higher 𝑅
corresponds to a stronger non-randomness. Similarly, by varying 𝛾,
we can interpolate the Strauss process between CSR ( 𝛾=1) and the
Hardcore process ( 𝛾=0). In the Matern process, a smaller cluster
radius corresponds to a higher degree of clustering, and a very large
𝑅𝑐produces a random arrangement of points.
For Hardcore and Strauss patterns, we set the inhibition distance
to𝑟∗=5. For the Matern process, we set the cluster radius to
𝑟∗=5. However, for a fair comparison of the summary functions,
the choice of 𝑟∗should account for the difference in their behavior.
For true𝑅𝑐=5, LCF is designed to reach its maximum at 𝑟=10,
whereas PCF drops to its expected value for CSR at 𝑟=10. Therefore,
we test each function at the scale 𝑟where its power is maximal.
Specifically, although 𝐻’s maximum does not correspond well to
H PCF LCF
A
0.00.51.0R = 5n = 60n = 120n = 240506070n013501350135R
B
0.00.51.0PowerR = 5, γ = 0.25n = 60n = 120n = 24040120200n00.5100.5100.511 - γ
C
0.00.51.0Rc = 5 , np = 50n = 25n = 50n = 100203040506070n020406002040600204060RcFigure 5: Power analysis for LCF, 𝐻, and PCF. In each row,
the first panel varies the sample size at a fixed effect size,
while the others vary the effect size for fixed sample sizes.
Throughout, 𝑛=number of points. A) Hardcore process, 𝑅-
hardcore distance. B) Strauss process, 𝑅- inhibition distance,
𝛾- probability of accepting a close pair. 𝑅=5in all exper-
iments. C) Matern cluster process. 𝑛𝑝- average number of
clusters,𝑅𝑐- cluster radius. 𝑛𝑝=50in all experiments. Shad-
ing: 95% confidence intervals (these are narrow and barely
thicker than the lines).
the domain size, we choose 𝑟∗=10since𝐻is cumulative. PCF’s
maximum is expected to occur around 𝑟=0, hence it is more
appropriate to take 𝑟∗=5because at this distance PCF should still
significantly deviate from 1.
Figure 5 shows the results of our power analysis. For the in-
hibitory processes, PCF has lower power than 𝐻and LCF, which
perform similarly for large samples, although 𝐻has an edge for
intermediate sample sizes. However, for the average sample size
𝑛=120, LCF is more powerful than 𝐻for detecting the Hardcore
process. For clustering, PCF and 𝐻have almost identical power
curves and outperform LCF, especially for small effect sizes. This
can be explained by the fact that LCF reaches its maximum at the
cluster diameter, and its growth at smaller distances is slower than
𝐻’s, hence, the effect of increasing radius on its shape is stronger
than for other functions. Overall, in this analysis, detecting cluster-
ing appeared to be easier than detecting inhibition: even for a very
small𝑛=30, all functions had more than 50% power.
2183KDD ’24, August 25–29, 2024, Barcelona, Spain Evgenia Martynova and Johannes Textor
A
-101
0100200300400500r, µmLCF B
-101
0255075r, kmLCF
cDC2 pDC B cell Myeloid
C
0.190.330.300.070.050.050.030.030.550.540.74
0.260.00.20.40.60.8
n=71n=32n=63n=78AUC D
r = -0.62r = -0.74r = -0.33r = -0.761021031041021031040.00.20.40.6
0.00.20.40.6Number of cellsAUCAir Waste
E
0.260.360.140.150.510.75
0.20.40.60.8
n=45n=41AUC F
r = -0.21r = -0.291021030.20.40.6
0.20.40.6Number of facilitiesAUC
Figure 6: Example applications of LCF. A) Immune cells in tumor microarray biopsies (light blue - tumor, white - background,
brighter color corresponds to higher cell density) with corresponding LCF for each cell type. cDC2: conventional dendritic
cell, type 2; pDC: plasmacytoid dendritic cell. B) Air pollution and waste generation facilities in the state of Ohio and LCF per
facility type. C, E) Standardized AUCs for LCF plots for multiple tumor biopsies (C) or states (E). The x-axis shows how many
biopsies/states had sufficiently many cells/facilities for analysis. D, F) Relationships between LCF AUC and the number of cells
(D) or facilities (F) with Pearson correlation and loess regression line.
5 APPLICATIONS
In this section, we demonstrate how LCF can be used for exploratory
data analysis, both to analyze individual samples and for compar-
ing multiple, possibly heterogeneous, point patterns. We use two
publicly available datasets that contain multiple samples with com-
parable region sizes and objects of multiple types.
The first dataset consists of tumor biopsy images that show
different types of immune cells, namely conventional dendritic
cells of type 2 (cDC2), plasmacytoid dendritic cells (pDCs), myeloid
cells, and B cells [ 34]. Quantifying the spatial distribution of such
cells is important to understand how the cells interact with each
other, which can lead to biomarkers for therapy response [ 35].
Upon manual quality control (requiring at least half of the tissue
to be intact), we selected 78 images for analysis. To detect the
positions of the immune cells and identify their types, we used
the ImmuNet pipeline [ 32,34]. Tissue boundaries were found by a
segmentation algorithm implemented in the “inForm” software (v
2.4.8, PerkinElmer). A representative sample is shown in Figure 6A.
The LCF plots reflect clear differences between the cell types: theLCF values are highest for B cells, which are indeed noticeably
clustered, and barely deviate from 0for the scattered myeloid cells.
A pronounced peak in LCF for cDC2s suggests that they could
interact at short distances (inset).
The second dataset contains coordinates of air pollution and
waste generation facilities in the USA [ 19]. Monogan et al. reported
significant differences between the spatial distributions of these
types of facilities. One may wonder whether the degree of cluster-
ing also differs. States with very small or large areas were removed
from the analysis, leaving us with 46 states. State boundaries were
obtained with the USA.state.boundaries R package (ver. 1.0.1).
Facility locations and the corresponding LCF plot for the state of
Ohio are shown in Figure 6B. LCF reflects the visually obvious fact
that waste generators are more clustered than air polluters, espe-
cially at large distances. Additionally, it reveals that air polluters
are more clustered at smaller distances (inset), which is harder to
see directly in the plots.
2184A Uniformly Bounded Correlation Function
for Spatial Point Patterns KDD ’24, August 25–29, 2024, Barcelona, Spain
To compare multiple samples, we extract a “global degree of
clustering” by taking the area under the LCF curve between pre-
specified values 𝑟minand𝑟maxand dividing it by 𝑟max−𝑟min, result-
ing in a possible range from −1to1as for LCF itself. Small 𝑟<𝑟min
are excluded due to the large variance of LCF, whereas overly large
𝑟>𝑟maxare less meaningful to analyze due to the edge effects.
For tumor images we set 𝑟𝑚𝑖𝑛=50𝜇𝑚and𝑟𝑚𝑎𝑥=500𝜇𝑚and for
industrial facilities 𝑟𝑚𝑖𝑛=7.5𝑘𝑚and𝑟𝑚𝑎𝑥=75𝑘𝑚. Point patterns
with less than 40 objects were excluded from the analysis.
The AUC analysis reveals that pDCs and B cells are the most
clustered immune cells in this dataset, while myeloid cells show
very little clustering (Figure 6C). These results are consistent with
the fact that tertiary lymphoid structures, which can form at the
site of infection and are hypothesized to boost the local immune
response, have a B cell follicle at their core [ 27,29,30]. In contrast,
the primary role of myeloid cells is to patrol tissues for pathogens,
which they then engulf and digest. They are, therefore, more likely
to be scattered. The difference in the degree of clustering of cDC2s
and pDCs is interesting since they have different origins and roles
in the immune response. There are no samples showing evidence of
repulsion between cells. Figure 6D shows that the number of cells
in a sample is negatively correlated with the LCF AUC for all cell
types. A possible explanation is that due to the spatial exclusion
between cells, clusters are less likely to form at high densities.
Figure 6E demonstrates that waste generators are more clustered
than air polluters. This effect might occur because if many air pol-
luters are placed close to each other, the maximum permitted level
of toxic substances in that area might be exceeded. This problem
does not have to be addressed when placing waste generation facil-
ities. The correlation between the number of facilities and LCF’s
AUC is negative as well, but the correlation coefficients are lower
than for immune cells (Figure 6F).
6 CONCLUSION
Here, we have proposed the local correlation function (LCF), a new
summary function for point patterns with a bounded and inter-
pretable scale. LCF is based on Ripley’s 𝐾, and its closest relative
among𝐾-based statistics is the pair correlation function (PCF). The
crucial difference between LCF and other summary functions is
that its extreme values, -1 and 1, are identical and attainable for
all observation window sizes |𝑊|and all scales 𝑟. This means that
LCF(𝑟)can be interpreted as the degree of clustering at distance
𝑟, and facilitates comparisons between multiple samples. As with
other𝐾-based spatial statistics, researchers can analyze the entire
function graph of LCF for a single or a few patterns or construct
summary measures such as the area under the curve for joint anal-
ysis of many point patterns.
In our experiments, we estimated LCF based on a monotone
spline approximation of 𝑁(𝑟), the average number of neighbors
within distance 𝑟of a typical point, and its derivative. A simpler
plug-in estimator can also be used, but it requires tuning a band-
width parameter ℎ. We found that LCF’s power and calibration
are more sensitive to sample size than those of 𝐾-based baselines,
although they become comparable at relatively small sample sizes.
We have limited this investigation to testing for deviation from
complete spatial randomness at a single distance 𝑟; simultaneoustesting of multiple spatial scales [ 1] will be interesting to explore
in future work.
Some limitations of the LCF are inherited from Ripley’s 𝐾. It is
asymptotically consistent but generally not an unbiased estimator
of its population value, although the bias for complete spatial ran-
domness appeared to be small in our experiments. The complex
dependence structure of the input data (pairwise distances between
points) makes it difficult to establish exact or asymptotic results
on its distribution, and we provide only preliminary theory in this
paper. While it may appear that the use of monotone splines to
estimate LCF adds computational overhead, our initial tests showed
no major difference between the computational requirements for
LCF and𝐾, and we therefore did not to include empirical measure-
ments of runtime in this paper. We used the SCAM framework as a
“plug-in” method to estimate 𝑁(𝑟)and𝑁′(𝑟)and chose the number
of basis functions as√𝑛, a somewhat ad hoc decision that can be
improved in future work. Finally, LCF is bounded under the as-
sumption that the estimated ˆ𝑁(𝑟)is monotonically non-decreasing.
Although this is typically the case, it is important to further inves-
tigate the interactions with different edge correction strategies in
future work.
We found promising correspondences between LCF extrema
and the characteristic distances of simulated point patterns, but
did not investigate this in detail. Further research on the use of
LCF extrema to infer point process parameters is of interest, es-
pecially for a wider variety of cluster shapes and arrangements.
Additionally, it would be useful to determine the robustness of the
LCF extrema to increasing noise and decreasing sample size. Other
promising directions for future work include the investigation of
the pointwise LCF introduced in Section 3.2. This could be use-
ful for the exploratory data analysis of digital pathology images
containing tens of thousands of cells, e.g., to find regions of partic-
ularly clustered or dispersed cell arrangement. Using LCF to detect
and quantify clustering (dispersion) in high-dimensional data may
also be an interesting avenue; however, one would need to find an
approach to circumvent the curse of dimensionality.
In summary, we hope that the LCF will encourage the adoption
of spatial statistics in research communities where we think it is
currently underutilized, such as Biology. We have shown examples
of exploratory data analysis with LCF for two real datasets from
very different domains. For ease of use, we have implemented 𝐿𝐶𝐹
in an R package that follows the conventions and interfaces of the
popular package spatstat [2]. The R package is provided as online
material accompanying this manuscript, see Appendix B.
ACKNOWLEDGMENTS
This work was supported by a grant from the Hanarth Foundation to
JT. We thank Mihaela Mihaylova for proofreading this manuscript.
REFERENCES
[1]Adrian Baddeley, Peter J Diggle, Andrew Hardegen, Thomas Lawrence, Robin K
Milne, and Gopalan Nair. 2014. On tests of spatial pattern based on simulation
envelopes. Ecological Monographs 84, 3 (2014), 477–489.
[2]Turner R Baddeley A, Rubak E. 2015. Spatial Point Patterns: Methodology
and Applications with R (1st ed.). Number ISBN 9781482210200. Chap-
man and Hall/CRC Press, London. https://www.routledge.com/Spatial-
Point-Patterns-Methodology-and-Applications-with-R/Baddeley-Rubak-
Turner/p/book/9781482210200/
2185KDD ’24, August 25–29, 2024, Barcelona, Spain Evgenia Martynova and Johannes Textor
[3]Andrea Behanova, Anna Klemm, and Carolina Wählby. 2022. Spatial Statistics
for Understanding Tissue Organization. Frontiers in Physiology 13 (Jan. 2022).
https://doi.org/10.3389/fphys.2022.832417
[4]Mariem Ben-Said. 2021. Spatial point-pattern analysis as a powerful tool in
identifying pattern-process relationships in plant ecology: an updated review.
Ecological Processes 10, 1 (2021), 1–23.
[5]Sneha Berry, Nicolas A. Giraldo, Benjamin F. Green, Tricia R. Cottrell, Julie E.
Stein, Elizabeth L. Engle, Haiying Xu, Aleksandra Ogurtsova, Charles Roberts,
Daphne Wang, Peter Nguyen, Qingfeng Zhu, Sigfredo Soto-Diaz, Jose Loy-
ola, Inbal B. Sander, Pok Fai Wong, Shlomit Jessel, Joshua Doyle, Danielle
Signer, Richard Wilton, Jeffrey S. Roskes, Margaret Eminizer, Seyoun Park,
Joel C. Sunshine, Elizabeth M. Jaffee, Alexander Baras, Angelo M. De Marzo,
Suzanne L. Topalian, Harriet Kluger, Leslie Cope, Evan J. Lipson, Ludmila
Danilova, Robert A. Anders, David L. Rimm, Drew M. Pardoll, Alexander S.
Szalay, and Janis M. Taube. 2021. Analysis of multispectral imaging with the
AstroPath platform informs efficacy of PD-1 blockade. Science 372, 6547 (June
2021). https://doi.org/10.1126/science.aba2609
[6]JE Besag. 1977. Comments on Ripley’s paper: Royal Statistical Society. Journal
39 (1977), 193–195.
[7]Joshua A Bull and Helen M Byrne. 2023. Quantification of spatial and phenotypic
heterogeneity in an agent-based model of tumour-macrophage interactions. PLOS
Computational Biology 19, 3 (2023), e1010994.
[8]Joshua A Bull, Eoghan J Mulholland, Simon J Leedham, and Helen M Byrne. 2024.
Extended correlation functions for spatial analysis of multiplex imaging data.
Biological Imaging 4 (2024), e2.
[9] Alan Y Chiang. 2007. Generalized additive models: an introduction with R.
[10] Peter J Diggle. 1979. On parameter estimation and goodness-of-fit testing for
spatial point patterns. Biometrics (1979), 87–101.
[11] Bradley Efron. 1987. Better bootstrap confidence intervals. Journal of the Ameri-
can statistical Association 82, 397 (1987), 171–185.
[12] Anthony C Gatrell, Trevor C Bailey, Peter J Diggle, and Barry S Rowlingson. 1996.
Spatial point pattern analysis and its application in geographical epidemiology.
Transactions of the Institute of British geographers (1996), 256–274.
[13] KH Hanisch. 2007. Some remarks on estimators of the distribution function of
nearest neighbour distance in stationary spatial point processes. Series Statistics
(2007).
[14] Brian Hopkins and John Gordon Skellam. 1954. A new method for determining
the type of distribution of plant individuals. Annals of Botany 18, 2 (1954), 213–
227.
[15] Amanda Janesick, Robert Shelansky, Andrew D. Gottscho, Florian Wagner,
Stephen R. Williams, Morgane Rouault, Ghezal Beliakoff, Carolyn A. Morrison,
Michelli F. Oliveira, Jordan T. Sicherman, Andrew Kohlway, Jawad Abousoud,
Tingsheng Yu Drennon, Seayar H. Mohabbat, and Sarah E. B. Taylor. 2023. High
resolution mapping of the tumor microenvironment using integrated single-
cell, spatial and in situ analysis. Nature Communications 14, 1 (Dec. 2023).
https://doi.org/10.1038/s41467-023-43458-x
[16] Maria A Kiskowski, John F Hancock, and Anne K Kenworthy. 2009. On the use
of Ripley’s K-function and its derivatives to analyze domain size. Biophysical
journal 97, 4 (2009), 1095–1103.
[17] Gabriel Lang and Eric Marcon. 2013. Testing randomness of spatial point patterns
with the Ripley statistic. ESAIM: Probability and Statistics 17 (2013), 767–788.
[18] Carlo C Maley, Konrad Koelble, Rachael Natrajan, Athena Aktipis, and Yinyin
Yuan. 2015. An ecological measure of immune-cancer colocalization as a prog-
nostic factor for breast cancer. Breast Cancer Research 17, 1 (2015), 1–13.
[19] James E Monogan III, David M Konisky, and Neal D Woods. 2017. Gone with the
wind: Federalism and the strategic location of air polluters. American Journal of
Political Science 61, 2 (2017), 257–270.
[20] J Ohser and D Stoyan. 1981. On the second-order and orientation analysis of
planar stationary point processes. Biometrical Journal 23, 6 (1981), 523–533.
[21] Natalya Pya. 2023. scam: Shape Constrained Additive Models. https://CRAN.R-
project.org/package=scam R package version 1.2-14.
[22] Natalya Pya and Simon N Wood. 2015. Shape constrained additive models.
Statistics and computing 25 (2015), 543–559.
[23] R Core Team. 2023. R: A Language and Environment for Statistical Computing. R
Foundation for Statistical Computing, Vienna, Austria. https://www.R-project.
org/
[24] Brian D Ripley. 1977. Modelling spatial patterns. Journal of the Royal Statistical
Society: Series B (Methodological) 39, 2 (1977), 172–192.
[25] Brian D Ripley. 1979. Tests of’randomness’ for spatial point patterns. Journal of
the Royal Statistical Society Series B: Statistical Methodology 41, 3 (1979), 368–374.
[26] Brian D Ripley. 1982. Edge effects in spatial stochastic processes. Statistics in
theory and practice. Essays in honour of Bertil Matern (1982).
[27] Catherine Sautès-Fridman, Florent Petitprez, Julien Calderaro, and Wolf Herman
Fridman. 2019. Tertiary lymphoid structures in the era of cancer immunotherapy.
Nature Reviews Cancer 19, 6 (2019), 307–325.
[28] Katja Schiffers, Frank M Schurr, Katja Tielbörger, Carsten Urbach, Kirk Moloney,
and Florian Jeltsch. 2008. Dealing with virtual aggregation–a new index foranalysing heterogeneous point patterns. Ecography 31, 5 (2008), 545–555.
[29] Ton N Schumacher and Daniela S Thommen. 2022. Tertiary lymphoid structures
in cancer. Science 375, 6576 (2022), eabf9419.
[30] Kar¯ına Sili n,a, Alex Soltermann, Farkhondeh Movahedian Attar, Ruben Casanova,
Zina M Uckeley, Helen Thut, Muriel Wandres, Sergejs Isajevs, Phil Cheng,
Alessandra Curioni-Fontecedro, et al .2018. Germinal centers determine the
prognostic relevance of tertiary lymphoid structures and are impaired by cor-
ticosteroids in lung squamous cell carcinoma. Cancer research 78, 5 (2018),
1308–1320.
[31] Leonard A Stefanski and Dennis D Boos. 2002. The Calculus of M-Estimation.
The American Statistician 56, 1 (Feb. 2002), 29–38. https://doi.org/10.1198/
000313002753631330
[32] Shabaz Sultan, Mark AJ Gorris, Lieke L van der Woude, Franka Buytenhuijs,
Evgenia Martynova, Sandra van Wilpe, Kiek Verrijp, Carl G Figdor, I Jolanda M
de Vries, and Johannes Textor. 2021. A Segmentation-Free machine learning
architecture for immune Land-scape phenotyping in solid tumors by multichannel
imaging. BioRxiv (2021), 2021–10.
[33] Huw D. Summers, John W. Wills, and Paul Rees. 2022. Spatial statistics is a
comprehensive tool for quantifying cell neighbor relationships and biological
processes via tissue image analysis. Cell Reports Methods 2, 11 (Nov. 2022), 100348.
https://doi.org/10.1016/j.crmeth.2022.100348
[34] Iris AE van der Hoorn, Evgenia Martynova, Beatriz Subtil, Jelena Meek, Kiek
Verrijp, Johannes Textor, Georgina Flórez-Grau, Berber Piet, Michel M van den
Heuvel, I Jolanda M de Vries, et al .2023. Detection of dendritic cell subsets in
the tumor microenvironment by multiplex immunohistochemistry. European
Journal of Immunology (2023), 2350616.
[35] Lieke L. van der Woude, Mark A.J. Gorris, Altuna Halilovic, Carl G. Figdor, and
I. Jolanda M. de Vries. 2017. Migrating into the Tumor: a Roadmap for T Cells.
Trends in Cancer 3, 11 (Nov. 2017), 797–808. https://doi.org/10.1016/j.trecan.2017.
09.006
[36] Scott Ward, Edward AK Cohen, and Niall Adams. 2021. Testing for complete spa-
tial randomness on three dimensional bounded convex shapes. Spatial Statistics
41 (2021), 100489.
[37] Angela C White, Carlo F Barenghi, and Nick P Proukakis. 2012. Creation and
characterization of vortex clusters in atomic Bose-Einstein condensates. Physical
Review A 86, 1 (2012), 013635.
[38] Christopher Wilson, Alex C. Soupir, Ram Thapa, Jordan Creed, Jonathan Nguyen,
Carlos Moran Segura, Travis Gerke, Joellen M. Schildkraut, Lauren C. Peres, and
Brooke L. Fridley. 2022. Tumor immune cell clustering and its association with sur-
vival in African American women with ovarian cancer. PLOS Computational Bi-
ology 18, 3 (March 2022), e1009900. https://doi.org/10.1371/journal.pcbi.1009900
A RESEARCH METHODS
A.1 Simulation Details
Figure 1. All point patterns are generated in a 400x400 square
with total intensity 3/(23·10). The Strauss process is used to gen-
erate point patterns with inhibition. In the Strauss process, a pair
of points that lie closer than the inhibition distance 𝑅is accepted
with probability 𝛾. We set𝑅=15and𝛾=0.4. The clustered point
pattern is drawn from a Thomas cluster process, which first ob-
tains the parent points by sampling a realization of the Poisson
process with intensity 𝜅and then replaces every parent point with
a Poisson distributed number of offspring with isotropic Gaussian
displacement from the parent point. We set the parent intensity
𝜅to5/(24·103), the average number of offspring per cluster to
120and the standard deviation of the Gaussian to 7.5. This way on
average 95%of offspring are within 15units from the cluster centre.
Figure 2. The lattice is generated by creating a triangular grid
with a distance of 𝑟𝑑=0.15between points covering the observa-
tion window; the outcome of this point process is deterministic.
CSR is generated with intensity 𝜆=200for all observation window
sizes. The points in the dense cluster are uniformly distributed
within a disk of radius 𝑟𝑐=0.5located at the center of the ob-
servation window. The number of points per disk is drawn from
a Poisson distribution with parameter 200/𝜋𝑟2𝑐; the intensity and
cluster radius are kept the same for all observation window sizes.
2186A Uniformly Bounded Correlation Function
for Spatial Point Patterns KDD ’24, August 25–29, 2024, Barcelona, Spain
Figure 3. Point patterns are generated in a 1000x1000 square with
total intensity 2/103. To generate the pattern with three clusters, we
define three parent points as the vertices of an equilateral triangle
with side length 120and draw a Poisson process realization with
intensity 2/(3·103)in a disk with radius 25centered on each parent
point. The Matern process generates clusters by first drawing the
parent points from a Poisson process with intensity 𝜅and then
replacing every parent point with circular clusters with uniformly
distributed points. We set 𝜅=75/106, cluster radius to 25and the
average number of points per cluster to 2000/75. The central region
of size 365x300 is cropped for visualisation of both point patterns.
A.2 Proofs
Proof of Proposition 3.5. We consider a point pattern of 𝑛+1
points𝑝1,...,𝑝𝑛+1in the observation window 𝑊. A point𝑝∗, dis-
tance𝑟and a scalar ℎare chosen in such a way that the circle
𝑏(𝑝∗,ℎ𝑟)∩𝑊=𝑏(𝑝∗,ℎ𝑟), i.e. the circle centered at the point 𝑝∗
lies fully within 𝑊. Define𝑑∗
𝑗:=∥𝑝∗−𝑝𝑗∥.
We start with investigating the ratio:
𝑍𝑛=𝑁(𝑝∗,𝑟)
𝑁(𝑝∗,𝑟ℎ)=Í
𝑗1(𝑑∗
𝑗<𝑟)
Í
𝑗1(𝑑∗
𝑗<𝑟ℎ)=1
𝑛Í
𝑗1(𝑑∗
𝑗<𝑟)
1
𝑛Í
𝑗1(𝑑∗
𝑗<𝑟ℎ)=𝑋𝑛
𝑌𝑛
𝑋𝑗=1(𝑑∗
𝑗<𝑟)represents a Bernoulli trial of whether 𝑝𝑗∈
𝑏(𝑝∗,𝑟). For CSR, the probability of success is 𝑝=𝜋𝑟2
|𝑊|(the fraction
of area within the circle 𝑏(𝑥,𝑟)) and𝜇𝑋𝑗=𝑝,𝜎2
𝑋𝑗=𝑝(1−𝑝).
Similarly, for 𝑌𝑗=1(𝑑∗
𝑗<𝑟ℎ),𝜇𝑌𝑗=𝑞,𝜎2
𝑌𝑗=𝑞(1−𝑞)and𝑞=𝜋𝑟2ℎ2
|𝑊|.
Since𝑏(𝑥,𝑟)⊂𝑏(𝑥,ℎ𝑟),𝑋𝑗and𝑌𝑗are correlated. Their covariance
is:
𝜎𝑋𝑗𝑌𝑗=E[𝑋𝑗𝑌𝑗]−E[𝑋𝑗]E[𝑌𝑗]
=1
𝑛∑︁
𝑗1(𝑑∗
𝑗<𝑟)1(𝑑∗
𝑗<ℎ𝑟)−𝑝𝑞
=1
𝑛∑︁
𝑗1(𝑑∗
𝑗<𝑟)−𝑝𝑞=𝑝(1−𝑞)
Therefore for a random vector 𝑈𝑈𝑈𝑗=[𝑋𝑗,𝑌𝑗],𝜇𝜇𝜇𝑈𝑈𝑈𝑗=[𝑝,𝑞]
andΣΣΣ𝑈𝑈𝑈𝑗=𝑝(1−𝑝)𝑝(1−𝑞)
𝑝(1−𝑞)𝑞(1−𝑞). Its average is 𝑈𝑈𝑈𝑛=1
𝑛Í
𝑗𝑈𝑈𝑈𝑗=
[1
𝑛Í
𝑗𝑋𝑗,1
𝑛Í
𝑗𝑌𝑗]. According to the central limit theorem:
√𝑛(𝑈𝑈𝑈𝑛−𝜇𝜇𝜇𝑈𝑈𝑈𝑗)→N 2(0,ΣΣΣ𝑈𝑈𝑈𝑗)
This leads to the asymptotic approximation 𝑈𝑈𝑈𝑛∼N 2(𝜇𝜇𝜇𝑈𝑈𝑈𝑗,1
𝑛ΣΣΣ𝑈𝑈𝑈𝑗)
andΣΣΣ𝑈𝑈𝑈𝑛=1
𝑛𝑝(1−𝑝)𝑝(1−𝑞)
𝑝(1−𝑞)𝑞(1−𝑞).
The asymptotic distribution of a ratio of sample averages 𝑍𝑛=
𝑋𝑛
𝑌𝑛is [31]:
𝑍𝑛∼N𝜇𝑋𝑛
𝜇𝑌𝑛,1
𝜇2
𝑌𝑛
𝜎2
𝑌𝑛𝜇𝑋𝑛
𝜇𝑌𝑛2
−2𝜎𝑋𝑛𝑌𝑛𝜇𝑋𝑛
𝜇𝑌𝑛+𝜎2
𝑋𝑛
.
Now, we simplify the asymptotic expresion for 𝜎2
𝑍𝑛using the
expressions of 𝜎2
𝑋𝑛,𝜎2
𝑌𝑛,𝜇𝑋𝑛and𝜇𝑌𝑛derived above. Note that
𝑝
𝑞=1
ℎ2.𝜎2
𝑍𝑛=1
𝑞2𝑞(1−𝑞)
𝑛𝑝2
𝑞2−2𝑝(1−𝑞)
𝑛𝑝
𝑞+𝑝(1−𝑝)
𝑛
=1
𝑛1
𝑞1
ℎ2
1−1
ℎ2
=1
𝑛1
𝑝1
ℎ4
1−1
ℎ2
Thus, asymptotically 𝑍𝑛∼N
1
ℎ2,1
𝑛1
𝑝1
ℎ4
1−1
ℎ2
.
LCF transforms the ratio𝑁(𝑟)
𝑁(ℎ𝑟)so that its expectation is 1/2for
CSR using the transformation 𝑔(𝑥)=𝑥𝑎,𝑎=ln 2
2 lnℎ, therefore we
need to apply the same transformation 𝑔to the distribution of 𝑍𝑛
to obtain the distribution of 𝐿𝐶𝐹(𝑝∗,𝑟,ℎ,𝑛). The Delta method can
be applied for this since 𝑍𝑛satisfies:
√𝑛(𝑍𝑛−𝜇)→N( 0,𝜎2)
with finite𝜇=1
ℎ2and𝜎2=1
𝑝1
ℎ4
1−1
ℎ2
. Then:
√𝑛(𝑔(𝑍𝑛)−𝑔(𝜇))→N( 0,𝜎2𝑔′(𝜇𝑧)2) (9)
Since𝑔′(𝑥)=ln 2
2 lnℎ1
𝑥𝑥ln 2
2 lnℎwe get:
𝑔′(𝜇𝑧)=1
22ln 2
lnℎℎ2
Plugging this, 𝜎2and𝑝=𝜋𝑟2
|𝑊|into Equation 9 we obtain:
√𝑛(𝑔(𝑍𝑛)−0.5)→N
0,|𝑊|
𝜋𝑟2(ln 2)2
24(ℎ2−1)
(lnℎ)2ℎ2
Therefore(𝑍𝑛)𝑎∼N
0.5,1
𝑛|𝑊|
𝜋𝑟2(ln 2)2
24(ℎ2−1)
(lnℎ)2ℎ2
. Lastly, we scale
this expression by 2 and subtract 1 to arrive at the distribution for
LCF proper (Equation 6):
𝐿𝐶𝐹(𝑝∗,𝑟,ℎ,𝑛)∼N
0,1
𝑛|𝑊|
𝜋𝑟2(ln 2)2
22(ℎ2−1)
(lnℎ)2ℎ2
□
Proof of Proposition 3.6.
lim
ℎ→1𝑁(𝑟)
𝑁(ℎ𝑟)𝑎
=lim
ℎ→1exp
ln𝑁(𝑟)
𝑁(ℎ𝑟)𝑎
=
lim
ℎ→1exp 
−ln 2
2 lnℎ
ln𝑁(ℎ𝑟)−𝑙𝑛𝑁(𝑟)!
Changing variables as 𝑟+𝜖:=ℎ𝑟, we continue:
lim
𝜖→0exp
−ln 2
2 ln 1+𝜖
𝑟(ln𝑁(𝑟+𝜖)−𝑙𝑛𝑁(𝑟))
=
lim
𝜖→0exp
−ln 2
2𝜖
ln 1+𝜖
𝑟ln𝑁(𝑟+𝜖)−𝑙𝑛𝑁(𝑟)
𝜖
=
lim
𝜖→0exp
−ln 2
2𝜖
ln 1+𝜖
𝑟𝜕ln𝑁(𝑟)
𝜕𝑟
=
lim
𝜖→0exp
−ln 2
2𝜖
ln 1+𝜖
𝑟𝑁′(𝑟)
𝑁(𝑟)
Substituting 𝜖=𝑟𝑧, we get:
lim
𝑧→0exp
−ln 2
2𝑧
ln 1+𝑧𝑟𝑁′(𝑟)
𝑁(𝑟)
=exp
−ln 2
2𝑟𝑁′(𝑟)
𝑁(𝑟)
2187KDD ’24, August 25–29, 2024, Barcelona, Spain Evgenia Martynova and Johannes Textor
□
Proof of Proposition 3.7. For𝑟:𝑁(𝑟)=0, 𝐿𝐶𝐹(𝑟)=−1
by definition. When 𝑁(𝑟)>0,𝑁′(𝑟)≥0since𝑁(𝑟)is monoton-
ically non-decreasing and 𝑟>0as well. Thereforeln 2
2𝑟𝑁′(𝑟)
𝑁(𝑟)≥0. It
follows that exp
−ln 2
2𝑟𝑁′(𝑟)
𝑁(𝑟)
∈[0,1], therefore∀𝑟≥0𝐿𝐶𝐹(𝑟)∈
[−1,1].
□
Proof of Proposition 3.8. First, we consider 𝐿𝐶𝐹(𝑟)=−1. This
value occurs when 𝑁(𝑟)=0, which means maximum dispersion at
distance𝑟. Alternatively, this means exp
−ln 2
2𝑟𝑁′(𝑟)
𝑁(𝑟)
=0, which
would occur if the exponent argument is −∞. For finite observation
windows,𝑟cannot approach infinity and since a smooth estimate
of𝑁(𝑟)is used,𝑁′(𝑟)is finite as well. Hence, 𝐿𝐶𝐹(𝑟)=−1only
for maximally regular patterns.
𝐿𝐶𝐹(𝑟)=1yields exp
−ln 2
2𝑟𝑁′(𝑟)
𝑁(𝑟)
=1⇒𝑁′(𝑟)=0, hence
𝑁(𝑟)=𝑐. In essence, this means lim𝜖→0𝑁(𝑟+𝜖)−𝑁(𝑟)
𝜖=0⇒and
𝑁(ℎ𝑟)=𝑁(𝑟)if we takeℎ𝑟=𝑟+𝜖.𝑁(ℎ𝑟)=𝑁(𝑟)is our definition
of maximal clustering at 𝑟.
□
A.3 Implementation Details
A.3.1 Approximation of ˆ𝑁(𝑟)with SCAM. To obtain a better fit
we treat ˆ𝑁(𝑟)as a piece-wise function and only use the spline
approximation 𝑚(𝑟)when ˆ𝑁(𝑟𝑖)>0:
˜𝑁(𝑟)=(
0,ˆ𝑁(𝑟)=0
𝑚(𝑟),ˆ𝑁(𝑟)>0(10)
Otherwise, the zero values of ˆ𝑁(𝑟)would influence the SCAM
model too strongly, which would result in a poor fit for small dis-
tances. This is especially the case for patterns with low intensity
or repulsion. In addition, this ensures that 𝐿𝐶𝐹(𝑟)=−1when
𝑁(𝑟)=0, as per definition.A.3.2 Implementation in R. ˆ𝑁(𝑟)estimate is extracted from Rip-
ley’s𝐾estimates obtained with the spatstat package (ver. 3.0-6)
[2]. This allows for out-of-the-box use of optimised implementa-
tions and standard edge correction methods. The scam package
(ver. 1.2-14) [ 21] is used to fit a monotonically increasing spline
approximation of ˆ𝑁(𝑟)and the derivative is computed using the
splineDesign function from the splines package [23].
Estimates of 𝐻PCF are obtained with the spatstat package
(ver. 3.0-6) as well.
A.4 Statistical Analysis Details
In all statistical analyses, we compare simulated point patterns with
fixed numbers of points by using a slightly increased intensity of a
Poisson process and then randomly subsampling the drawn point
patterns. It is a property of the Poisson process that its randomly
subsampled realization has a Poisson distribution as well [ 2]. Formal
descriptions of the Strauss and Matern cluster processes used in
simulations are given above.
A.4.1 Calibration. Let𝑡𝑙be the test statistic that corresponds to
the𝑙’th point pattern drawn to simulate the null distribution in
the calibration analysis, 𝑡𝑚- test statistic of 𝑚’th point pattern
drawn to test for CSR and 𝑡𝑒- expected value of test statistics. In a
two-sided significance test, the p-value for the point pattern with
𝑡𝑚<𝑡𝑒, is computed as 𝑝𝑚=1
𝐿Í𝐿
𝑙=11(𝑡𝑙≤𝑡𝑚or𝑡𝑙≥𝑡′𝑚),
where𝑡′𝑚is the value at the same distance from 𝑡𝑒as𝑡𝑚on the right
(similarly for the case when 𝑡𝑚>𝑡𝑒). Then, the rejection ratio at the
significance level 𝑠is𝑅=1
𝑀Í𝑀
𝑚=11(𝑝𝑚≤𝑠). For a one-sided test,
the p-value is 𝑝𝑚=1
𝐿Í𝐿
𝑙=11(𝑡𝑙≤𝑡𝑚)or𝑝𝑚=1
𝐿Í𝐿
𝑙=11(𝑡𝑙≥𝑡′𝑚)
B ONLINE RESOURCES
An R package implementing the local correlation function is avail-
able on GitHub at https://github.com/EvgeniyaMartynova/lcfstat.
Code for reproducing all analyses and figures is available on GitHub
at https://github.com/EvgeniyaMartynova/lcf_paper_figures. The
required data to reproduce Figure 6 can be downloaded from Zen-
odo at https://zenodo.org/records/11507398.
2188